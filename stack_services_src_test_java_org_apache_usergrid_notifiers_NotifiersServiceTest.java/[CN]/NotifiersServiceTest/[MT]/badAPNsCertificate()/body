{
  ns.providerAdapters.put("apple",new MockSuccessfulProviderAdapter(){
    @Override public void testConnection(    Notifier notifier) throws ConnectionException {
      Exception e=new SocketException("Connection closed by remote host");
      throw new ConnectionException(e.getMessage(),e);
    }
  }
);
  app.clear();
  app.put("provider","apple");
  app.put("environment","development");
  InputStream fis=getClass().getClassLoader().getResourceAsStream("pushtest_prod.p12");
  byte[] certBytes=IOUtils.toByteArray(fis);
  app.put("p12Certificate",certBytes);
  fis.close();
  try {
    app.testRequest(ServiceAction.POST,1,"notifiers");
    fail("notifier creation should have failed with a bad connection test");
  }
 catch (  ConnectionException e) {
  }
}
