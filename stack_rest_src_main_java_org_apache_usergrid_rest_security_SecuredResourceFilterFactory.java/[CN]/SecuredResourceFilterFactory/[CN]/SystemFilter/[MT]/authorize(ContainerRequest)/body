{
  logger.debug("SystemFilter.authorize");
  try {
    if (!request.isUserInRole(ROLE_SERVICE_ADMIN)) {
      logger.debug("You are not the system admin.");
      throw mappableSecurityException("unauthorized","No system access authorized",SecurityException.REALM);
    }
  }
 catch (  IllegalStateException e) {
    logger.debug("This is an invalid state",e);
    if ((request.getUserPrincipal() == null) || !ROLE_SERVICE_ADMIN.equals(request.getUserPrincipal().getName())) {
      throw mappableSecurityException("unauthorized","No system access authorized",SecurityException.REALM);
    }
  }
}
