{
  if (logger.isTraceEnabled()) {
    logger.trace("SystemFilter.authorize");
  }
  try {
    if (!request.getSecurityContext().isUserInRole(ROLE_SERVICE_ADMIN)) {
      if (logger.isTraceEnabled()) {
        logger.trace("You are not the system admin.");
      }
      throw mappableSecurityException("unauthorized","No system access authorized",SecurityException.REALM);
    }
  }
 catch (  IllegalStateException e) {
    if (logger.isDebugEnabled()) {
      logger.debug("This is an invalid state",e);
    }
    if ((request.getSecurityContext().getUserPrincipal() == null) || !ROLE_SERVICE_ADMIN.equals(request.getSecurityContext().getUserPrincipal().getName())) {
      throw mappableSecurityException("unauthorized","No system access authorized",SecurityException.REALM);
    }
  }
}
