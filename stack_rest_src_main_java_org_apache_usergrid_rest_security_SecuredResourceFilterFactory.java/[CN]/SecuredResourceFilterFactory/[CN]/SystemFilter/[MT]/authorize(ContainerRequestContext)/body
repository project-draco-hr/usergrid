{
  logger.debug("SystemFilter.authorize");
  try {
    if (!request.getSecurityContext().isUserInRole("sysadmin")) {
      logger.debug("You are not the system admin.");
      throw mappableSecurityException("unauthorized","No system access authorized",SecurityException.REALM);
    }
  }
 catch (  IllegalStateException e) {
    logger.debug("This is an invalid state",e);
    if ((request.getSecurityContext().getUserPrincipal() == null) || !"sysadmin".equals(request.getSecurityContext().getUserPrincipal().getName())) {
      throw mappableSecurityException("unauthorized","No system access authorized",SecurityException.REALM);
    }
  }
}
