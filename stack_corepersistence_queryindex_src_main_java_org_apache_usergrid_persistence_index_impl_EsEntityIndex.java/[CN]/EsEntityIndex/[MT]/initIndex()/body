{
  AdminClient admin=client.admin();
  try {
    admin.indices().prepareCreate(indexName).execute().actionGet();
    log.debug("Created new index: " + indexName);
  }
 catch (  Exception e) {
    if (log.isDebugEnabled()) {
      log.debug("Exception creating index, already exists?",e);
    }
 else {
      log.info(e.getMessage());
    }
  }
  if (!admin.indices().typesExists(new TypesExistsRequest(new String[]{indexName},getTypeName())).actionGet().isExists()) {
    try {
      XContentBuilder mxcb=EsEntityIndex.createDoubleStringIndexMapping(jsonBuilder(),getTypeName());
      PutMappingResponse pmr=admin.indices().preparePutMapping(indexName).setType(getTypeName()).setSource(mxcb).execute().actionGet();
      if (!admin.indices().typesExists(new TypesExistsRequest(new String[]{indexName},getTypeName())).actionGet().isExists()) {
        throw new RuntimeException("Type does not exist in index: " + getTypeName());
      }
      GetMappingsResponse gmr=admin.indices().prepareGetMappings(indexName).addTypes(getTypeName()).execute().actionGet();
      if (gmr.getMappings().isEmpty()) {
        throw new RuntimeException("Zero mappings exist for type: " + getTypeName());
      }
      log.debug("Created new type mapping");
      log.debug("   Scope organization: " + orgScope.getOrganization());
      log.debug("   Scope application: " + appScope.getOwner());
      log.debug("   Type name: " + getTypeName());
    }
 catch (    IOException ex) {
      throw new RuntimeException("Error adding mapping for type " + getTypeName(),ex);
    }
  }
}
