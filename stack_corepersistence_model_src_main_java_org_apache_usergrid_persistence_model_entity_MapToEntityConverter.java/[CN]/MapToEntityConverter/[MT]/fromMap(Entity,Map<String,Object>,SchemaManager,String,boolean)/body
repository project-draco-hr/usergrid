{
  for (  String fieldName : map.keySet()) {
    Object value=map.get(fieldName);
    boolean unique=schemaManager == null ? topLevel : topLevel && schemaManager.isPropertyUnique(entityType,fieldName);
    if (value instanceof String) {
      String stringValue=(String)value;
      entity.setField(new StringField(fieldName,stringValue,unique));
    }
 else     if (value instanceof Boolean) {
      entity.setField(new BooleanField(fieldName,(Boolean)value,unique));
    }
 else     if (value instanceof Integer) {
      entity.setField(new IntegerField(fieldName,(Integer)value,unique));
    }
 else     if (value instanceof Double) {
      entity.setField(new DoubleField(fieldName,(Double)value,unique));
    }
 else     if (value instanceof Float) {
      entity.setField(new FloatField(fieldName,(Float)value,unique));
    }
 else     if (value instanceof Long) {
      entity.setField(new LongField(fieldName,(Long)value,unique));
    }
 else     if (value instanceof List) {
      Field field=listToListField(fieldName,(List)value);
      if (field == null) {
        entity.setField(new NullField(fieldName,unique));
      }
 else {
        entity.setField(listToListField(fieldName,(List)value));
      }
    }
 else     if (value instanceof UUID) {
      entity.setField(new UUIDField(fieldName,(UUID)value,unique));
    }
 else     if (value instanceof Map) {
      processMapValue(value,fieldName,entity);
    }
 else     if (value instanceof Enum) {
      entity.setField(new StringField(fieldName,value.toString(),unique));
    }
 else     if (value == null) {
      entity.setField(new NullField(fieldName,unique));
    }
 else {
      byte[] valueSerialized;
      try {
        valueSerialized=objectMapper.writeValueAsBytes(value);
      }
 catch (      JsonProcessingException e) {
        throw new RuntimeException("Can't serialize object ",e);
      }
      ByteBuffer byteBuffer=ByteBuffer.wrap(valueSerialized);
      ByteArrayField bf=new ByteArrayField(fieldName,byteBuffer.array(),value.getClass());
      entity.setField(bf);
    }
  }
  return entity;
}
