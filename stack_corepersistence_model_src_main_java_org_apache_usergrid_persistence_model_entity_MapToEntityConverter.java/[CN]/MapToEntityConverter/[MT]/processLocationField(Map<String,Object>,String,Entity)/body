{
  Map<String,Object> origMap=value;
  Map<String,Object> m=new HashMap<String,Object>();
  for (  String key : origMap.keySet()) {
    m.put(key.toLowerCase(),origMap.get(key));
  }
  if (m.size() >= 2 && ((m.containsKey("latitude") && m.containsKey("longitude")) || (m.containsKey("lat") && m.containsKey("lon")))) {
    Double lat, lon;
    if (m.containsKey("latitude") && m.containsKey("longitude")) {
      try {
        lat=Double.parseDouble(m.get("latitude").toString());
        lon=Double.parseDouble(m.get("longitude").toString());
      }
 catch (      NumberFormatException ignored) {
        throw new IllegalArgumentException("Latitude and longitude must be doubles (e.g. 32.1234).");
      }
    }
 else     if (m.containsKey("lat") && m.containsKey("lon")) {
      try {
        lat=Double.parseDouble(m.get("lat").toString());
        lon=Double.parseDouble(m.get("lon").toString());
      }
 catch (      NumberFormatException ignored) {
        throw new IllegalArgumentException("" + "Latitude and longitude must be doubles (e.g. 32.1234).");
      }
    }
 else {
      throw new IllegalArgumentException("Location properties require two fields - " + "latitude and longitude, or lat and lon");
    }
    entity.setField(new LocationField(fieldName,new Location(lat,lon)));
  }
 else {
    entity.setField(new EntityObjectField(fieldName,fromMap(value,false)));
  }
}
