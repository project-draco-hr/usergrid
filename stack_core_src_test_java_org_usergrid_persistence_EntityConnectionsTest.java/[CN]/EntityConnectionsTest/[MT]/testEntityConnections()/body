{
  logger.info("\n\nEntityConnectionsTest.testEntityConnections\n");
  UUID applicationId=createApplication("testEntityConnections");
  assertNotNull(applicationId);
  EntityManager em=emf.getEntityManager(applicationId);
  assertNotNull(em);
  logger.info("\n\nCreating Cat entity A with name of Dylan\n");
  Map<String,Object> properties=new LinkedHashMap<String,Object>();
  properties.put("name","Dylan");
  Entity catA=em.create("cat",properties);
  assertNotNull(catA);
  logger.info("\n\nEntity A created with id " + catA.getUuid() + "\n");
  logger.info("\n\nLooking up cat with id " + catA.getUuid() + "\n");
  Entity cat=em.get(catA);
  assertNotNull(cat);
  logger.info("\n\nFound entity " + cat.getUuid() + " of type "+ cat.getType()+ " with name "+ cat.getProperty("name")+ "\n");
  logger.info("\n\nCreating cat entity B with name of Nico\n");
  properties=new LinkedHashMap<String,Object>();
  properties.put("name","Nico");
  Entity catB=em.create("cat",properties);
  assertNotNull(catB);
  logger.info("\n\nEntity B created with id " + catB.getUuid() + "\n");
  logger.info("\n\nCreating award entity with name of 'best cat'\n");
  properties=new LinkedHashMap<String,Object>();
  properties.put("name","Best Cat Ever");
  Entity awardA=em.create("award",properties);
  assertNotNull(awardA);
  logger.info("\n\nEntity created with id " + awardA.getUuid() + "\n");
  logger.info("\n\nConnecting " + catA.getUuid() + " \"likes\" "+ catB.getUuid()+ "\n");
  em.createConnection(catA,"likes",catB);
  logger.info("\n\nConnecting " + awardA.getUuid() + " \"awarded\" "+ catB.getUuid()+ "\n");
  em.createConnection(awardA,"awarded",catB);
  logger.info("Find all connections for cat A: " + catA.getUuid());
  testEntityConnections(applicationId,catA.getUuid(),1);
  logger.info("Find all connections for award A: " + awardA.getUuid());
  testEntityConnections(applicationId,awardA.getUuid(),1);
  logger.info("\n\nConnecting " + awardA.getUuid() + " \"awarded\" "+ catA.getUuid()+ "\n");
  em.createConnection(awardA,"awarded",catA);
  testEntityConnections(applicationId,catA.getUuid(),1);
  testEntityConnections(applicationId,awardA.getUuid(),2);
  testApplicationCollections(applicationId,"cats",2);
  testApplicationCollections(applicationId,"awards",1);
  logger.info("\n\nSearching Award A for recipients with the name Dylan\n");
  Results found_entities=em.searchConnectedEntitiesForProperty(awardA,"awarded","cat","name","Dylan",null,null,1,false,Results.Level.IDS);
  assertNotNull(found_entities);
  assertEquals("Wrong number of results found",1,found_entities.size());
  UUID found_cat_id=found_entities.getId();
  assertNotNull(found_cat_id);
  Entity found_cat=em.get(found_cat_id);
  logger.info("Found cat id: " + found_cat.getUuid());
  logger.info("Found cat name: " + found_cat.getProperty("name"));
  logger.info("\n\nSetting 'foo'='bar' for found recipient (Dylan)\n");
  em.setProperty(found_cat,"foo","bar");
  logger.info("\n\nSearching Group A for members with 'foo'='bar'\n");
  found_entities=em.searchConnectedEntitiesForProperty(awardA,"awarded","cat","foo","bar",null,null,1,false,Results.Level.IDS);
  assertNotNull(found_entities);
  assertEquals("Wrong number of results found",1,found_entities.size());
  logger.info("\n\nSetting 'foo'='baz' for found member (Dylan)\n");
  em.setProperty(found_cat,"foo","baz");
  logger.info("\n\nSearching award A for members with 'foo'='bar', expecting to get no results\n");
  found_entities=em.searchConnectedEntitiesForProperty(awardA,"awarded","cat","foo","bar",null,null,1,false,Results.Level.IDS);
  assertNotNull(found_entities);
  assertEquals("Wrong number of results found",0,found_entities.size());
  logger.info("\n\nSearching Group A for members with 'foo'='baz'\n");
  found_entities=em.searchConnectedEntitiesForProperty(awardA,"awarded","cat","foo","baz",null,null,1,false,Results.Level.IDS);
  assertNotNull(found_entities);
  assertEquals("Wrong number of results found",1,found_entities.size());
  em.deleteConnection(em.connectionRef(awardA,"awarded",catA));
  found_entities=em.searchConnectedEntitiesForProperty(awardA,"awarded","cat","foo","baz",null,null,1,false,Results.Level.IDS);
  assertNotNull(found_entities);
  assertEquals("Wrong number of results found",0,found_entities.size());
}
