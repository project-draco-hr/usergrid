{
  QueryBuilder queryBuilder=null;
  if (getRootOperand() != null) {
    QueryVisitor v=new EsQueryVistor();
    try {
      getRootOperand().visit(v);
    }
 catch (    IndexException ex) {
      throw new RuntimeException("Error building ElasticSearch query",ex);
    }
    queryBuilder=v.getQueryBuilder();
  }
  BoolQueryBuilder boolQueryBuilder=QueryBuilders.boolQuery();
  for (  String context : contexts) {
    boolQueryBuilder=boolQueryBuilder.should(QueryBuilders.termQuery(IndexingUtils.ENTITY_CONTEXT_FIELDNAME,context));
  }
  boolQueryBuilder=boolQueryBuilder.minimumNumberShouldMatch(1);
  if (queryBuilder != null) {
    queryBuilder=boolQueryBuilder.must(queryBuilder);
  }
 else {
    queryBuilder=boolQueryBuilder;
  }
  return queryBuilder;
}
