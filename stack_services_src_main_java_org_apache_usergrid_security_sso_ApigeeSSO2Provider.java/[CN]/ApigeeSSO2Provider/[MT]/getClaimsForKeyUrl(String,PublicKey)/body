{
  Jws<Claims> claims=null;
  if (ssoPublicKey == null) {
    throw new IllegalArgumentException("Public key must be provided with Apigee " + "token in order to verify signature.");
  }
  try {
    claims=Jwts.parser().setSigningKey(ssoPublicKey).parseClaimsJws(token);
  }
 catch (  SignatureException se) {
    if (logger.isDebugEnabled()) {
      logger.debug("Signature was invalid for Apigee JWT: {} and key: {}",token,ssoPublicKey);
    }
    throw new BadTokenException("Invalid Apigee SSO token signature");
  }
catch (  MalformedJwtException me) {
    if (logger.isDebugEnabled()) {
      logger.debug("Beginning JSON object section of Apigee JWT invalid for token: {}",token);
    }
    throw new BadTokenException("Malformed Apigee JWT");
  }
catch (  ArrayIndexOutOfBoundsException aio) {
    if (logger.isDebugEnabled()) {
      logger.debug("Signature section of Apigee JWT invalid for token: {}",token);
    }
    throw new BadTokenException("Malformed Apigee JWT");
  }
catch (  ExpiredJwtException e) {
    final long expiry=Long.valueOf(e.getClaims().get("exp").toString());
    final long expirationDelta=((System.currentTimeMillis() / 1000) - expiry) * 1000;
    throw new ExpiredTokenException(String.format("Token expired %d milliseconds ago.",expirationDelta));
  }
  return claims;
}
