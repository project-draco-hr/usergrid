{
  final UUID now=UUIDGenerator.newTimeUUID(timeService.getCurrentTime());
  final Iterator<UUID> maxShards=getShards(scope,nodeId,MAX_UUID,1,edgeType);
  if (!maxShards.hasNext()) {
    return false;
  }
  final UUID maxShard=maxShards.next();
  if (UUIDComparator.staticCompare(maxShard,now) > 0) {
    return false;
  }
  final long count=edgeSeriesCounterSerialization.getCount(scope,nodeId,maxShard,edgeType);
  if (count < graphFig.getShardSize()) {
    return false;
  }
  final long newShardTime=timeService.getCurrentTime() + graphFig.getShardCacheTimeout() * 2;
  final UUID futureUUID=UUIDGenerator.newTimeUUID(newShardTime);
  try {
    this.edgeSeriesSerialization.writeEdgeMeta(scope,nodeId,futureUUID,edgeType).execute();
  }
 catch (  ConnectionException e) {
    throw new RuntimeException("Unable to write the new edge metadata");
  }
  return true;
}
