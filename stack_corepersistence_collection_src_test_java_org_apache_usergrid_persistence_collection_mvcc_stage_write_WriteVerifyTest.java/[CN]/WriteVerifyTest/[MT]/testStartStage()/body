{
  final EntityCollection entityCollection=mock(EntityCollection.class);
  final Entity entity=generateEntity();
  final MvccEntity mvccEntity=fromEntity(entity);
  WriteVerify newStage=new WriteVerify();
  Observable<IoEvent<MvccEntity>> observable=newStage.call(new IoEvent<MvccEntity>(entityCollection,mvccEntity));
  IoEvent<MvccEntity> result=observable.toBlockingObservable().single();
  assertSame("Context was correct",entityCollection,result.getEntityCollection());
  MvccEntity entry=result.getEvent();
  assertSame("id correct",entity.getId(),entry.getId());
  assertSame("version did not not match entityId",entity.getVersion(),entry.getVersion());
  assertSame("Entity correct",entity,entry.getEntity().get());
}
