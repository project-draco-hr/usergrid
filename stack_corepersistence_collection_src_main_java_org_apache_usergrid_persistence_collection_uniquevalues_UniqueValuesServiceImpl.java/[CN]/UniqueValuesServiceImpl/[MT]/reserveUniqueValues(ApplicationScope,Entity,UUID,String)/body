{
  if (!actorSystemManager.isReady()) {
    throw new RuntimeException("Unique values service not initialized, no request actors ready");
  }
  try {
    for (    Field field : entity.getFields()) {
      if (field.isUnique()) {
        reserveUniqueField(scope,entity,version,field,region);
      }
    }
  }
 catch (  UniqueValueException e) {
    for (    Field field : entity.getFields()) {
      if (field.isUnique()) {
        try {
          cancelUniqueField(scope,entity,version,field,region);
        }
 catch (        Throwable ignored) {
          logger.debug("Error canceling unique field",ignored);
        }
      }
    }
    throw e;
  }
}
