{
  try {
    for (    Field field : entity.getFields()) {
      if (field.isUnique()) {
        confirmUniqueField(entity,field.getName(),field.getValue().toString());
      }
    }
  }
 catch (  UniqueValueException e) {
    for (    Field field : entity.getFields()) {
      try {
        cancelUniqueField(entity,field.getName(),field.getValue().toString());
      }
 catch (      Throwable ignored) {
        logger.debug("Error canceling unique field",ignored);
      }
    }
    throw e;
  }
}
