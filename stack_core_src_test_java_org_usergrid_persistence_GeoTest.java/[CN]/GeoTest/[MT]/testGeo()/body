{
  logger.info("GeoTest.testGeo");
  UUID applicationId=createApplication("testGeo");
  assertNotNull(applicationId);
  EntityManager em=emf.getEntityManager(applicationId);
  assertNotNull(em);
  Map<String,Object> properties=new LinkedHashMap<String,Object>();
  properties.put("username","edanuff");
  properties.put("email","ed@anuff.com");
  Entity user=em.create("user",properties);
  assertNotNull(user);
  EntityLocationRef loc=new EntityLocationRef(user,37.776753,-122.407846);
  GeoIndexManager geo=((EntityManagerImpl)em).getGeoIndexManager();
  geo.storeLocationInCollectionIndex(em.getApplicationRef(),"users","location.coordinates",loc);
  Point center=new Point(37.774277,-122.404744);
  Results results=geo.proximitySearchCollection(em.getApplicationRef(),"users","location.coordinates",center,200,null,10,false,ALL_PROPERTIES);
  assertEquals(0,results.size());
  results=geo.proximitySearchCollection(em.getApplicationRef(),"users","location.coordinates",center,400,null,10,false,ALL_PROPERTIES);
  this.dump(results.getEntities());
  assertEquals(1,results.size());
  geo.removeLocationFromCollectionIndex(em.getApplicationRef(),"users","location.coordinates",loc);
  results=geo.proximitySearchCollection(em.getApplicationRef(),"users","location.coordinates",center,400,null,10,false,ALL_PROPERTIES);
  this.dump(results.getEntities());
  assertEquals(0,results.size());
  Map<String,Object> latlong=new LinkedHashMap<String,Object>();
  latlong.put("latitude",37.426373);
  latlong.put("longitude",-122.14108);
  em.setProperty(user,"location",latlong);
  center=new Point(37.774277,-122.404744);
  results=geo.proximitySearchCollection(em.getApplicationRef(),"users","location.coordinates",center,200,null,10,false,ALL_PROPERTIES);
  assertEquals(0,results.size());
  latlong=new LinkedHashMap<String,Object>();
  latlong.put("latitude",37.774277);
  latlong.put("longitude",-122.404744);
  em.setProperty(user,"location",latlong);
  center=new Point(37.428526,-122.140916);
  results=geo.proximitySearchCollection(em.getApplicationRef(),"users","location.coordinates",center,1000,null,10,false,ALL_PROPERTIES);
  assertEquals(1,results.size());
}
