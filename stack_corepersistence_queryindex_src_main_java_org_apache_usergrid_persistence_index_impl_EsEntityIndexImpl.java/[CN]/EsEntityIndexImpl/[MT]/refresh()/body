{
  refreshIndexMeter.mark();
  final Timer.Context timeRefreshIndex=refreshTimer.time();
  BetterFuture future=indexBatchBufferProducer.put(new IndexOperationMessage());
  future.get();
  final RetryOperation retryOperation=new RetryOperation(){
    @Override public boolean doOp(){
      try {
        String[] indexes=ArrayUtils.addAll(getIndexes(AliasType.Read),getIndexes(AliasType.Write));
        if (indexes.length == 0) {
          logger.debug("Not refreshing indexes. none found");
          return true;
        }
        esProvider.getClient().admin().indices().prepareRefresh(indexes).execute().actionGet();
        timeRefreshIndex.stop();
        logger.debug("Refreshed indexes: {}",StringUtils.join(indexes,", "));
        return true;
      }
 catch (      IndexMissingException e) {
        logger.error("Unable to refresh index. Waiting before sleeping.",e);
        throw e;
      }
    }
  }
;
  doInRetry(retryOperation);
}
