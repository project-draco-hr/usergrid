{
  try {
    if (!mappingsCreated.getAndSet(true)) {
      createMappings();
    }
    AdminClient admin=client.admin();
    CreateIndexResponse cir=admin.indices().prepareCreate(indexName).execute().actionGet();
    log.debug("Created new Index Name [{}] ACK=[{}]",indexName,cir.isAcknowledged());
    RefreshResponse response;
    do {
      response=admin.indices().prepareRefresh(indexName).execute().actionGet();
    }
 while (response.getFailedShards() != 0);
    for (int i=0; i < MAX_WAITS; i++) {
      try {
        refresh();
        break;
      }
 catch (      Exception e) {
        log.error("Unable to refresh index after create. Waiting before sleeping.",e);
      }
      try {
        Thread.sleep(WAIT_TIME);
      }
 catch (      InterruptedException e) {
      }
    }
  }
 catch (  IndexAlreadyExistsException expected) {
  }
catch (  IOException e) {
    throw new RuntimeException("Unable to initialize index",e);
  }
}
