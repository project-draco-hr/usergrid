{
  EdgeUtils.validateEdge(edge);
  return HystrixGraphObservable.user(Observable.from(edge).subscribeOn(Schedulers.io()).map(new Func1<Edge,Edge>(){
    @Override public Edge call(    final Edge edge){
      final AsynchronousMessage<EdgeEvent<Edge>> event=edgeWriteAsyncProcessor.setVerification(new EdgeEvent<>(scope,edge.getVersion(),edge),getTimeout());
      final MutationBatch mutation=edgeMetadataSerialization.writeEdge(scope,edge);
      final MutationBatch edgeMutation=commitLogSerialization.writeEdge(scope,edge);
      mutation.mergeShallow(edgeMutation);
      try {
        LOG.debug("Writing edge {} to metadata and commit log",edge);
        mutation.execute();
      }
 catch (      ConnectionException e) {
        throw new RuntimeException("Unable to connect to cassandra",e);
      }
      edgeWriteAsyncProcessor.start(event);
      return edge;
    }
  }
));
}
