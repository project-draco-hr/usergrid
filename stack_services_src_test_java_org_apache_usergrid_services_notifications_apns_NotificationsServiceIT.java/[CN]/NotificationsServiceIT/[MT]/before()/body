{
  super.before();
  NotificationsQueueManager.IS_TEST=true;
  app.clear();
  app.put("name","apns");
  app.put("provider",PROVIDER);
  app.put("environment",USE_REAL_CONNECTIONS ? "development" : "mock");
  InputStream fis=getClass().getClassLoader().getResourceAsStream("pushtest_dev_recent.p12");
  byte[] certBytes=IOUtils.toByteArray(fis);
  app.put("p12Certificate",certBytes);
  fis.close();
  Entity e=app.testRequest(ServiceAction.POST,1,"notifiers").getEntity();
  notifier=app.getEm().get(e.getUuid(),Notifier.class);
  final String notifierKey=notifier.getName() + NOTIFIER_ID_POSTFIX;
  app.clear();
  app.put(notifierKey,PUSH_TOKEN);
  app.put("name","device1");
  e=app.testRequest(ServiceAction.POST,1,"devices").getEntity();
  app.testRequest(ServiceAction.GET,1,"devices",e.getUuid());
  device1=app.getEm().get(e.getUuid(),Device.class);
  assertEquals(device1.getProperty(notifierKey),PUSH_TOKEN);
  app.clear();
  app.put(notifierKey,PUSH_TOKEN);
  app.put("name","device2");
  e=app.testRequest(ServiceAction.POST,1,"devices").getEntity();
  device2=app.getEm().get(e.getUuid(),Device.class);
  app.put("username","edanuff");
  app.put("email","ed@anuff.com");
  app.put("path","path");
  app.put("title","group");
  group1=(Group)app.testRequest(ServiceAction.POST,1,"groups").getEntity();
  ns=getNotificationService();
}
