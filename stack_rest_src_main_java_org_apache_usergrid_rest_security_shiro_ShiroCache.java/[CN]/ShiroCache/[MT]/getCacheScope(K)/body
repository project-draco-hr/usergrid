{
  if (key instanceof SimplePrincipalCollection) {
    SimplePrincipalCollection spc=(SimplePrincipalCollection)key;
    if (spc.getPrimaryPrincipal() instanceof AdminUserPrincipal) {
      AdminUserPrincipal p=(AdminUserPrincipal)spc.getPrimaryPrincipal();
      CacheScope scope=new CacheScope(new SimpleId(p.getApplicationId(),"application"));
      ScopedCache<String,V> scopedCache=cacheFactory.getScopedCache(scope);
      return scopedCache;
    }
 else {
      throw new RuntimeException("Cannot determine application ID for cache scope");
    }
  }
 else   if (key instanceof AdminUserPrincipal) {
    AdminUserPrincipal p=(AdminUserPrincipal)key;
    CacheScope scope=new CacheScope(new SimpleId(p.getApplicationId(),"application"));
    ScopedCache<String,V> scopedCache=cacheFactory.getScopedCache(scope);
    return scopedCache;
  }
 else {
    throw new RuntimeException("Cannot determine application ID for cache scope");
  }
}
