{
  this.metricsFactory=metricsFactory;
  this.flushTimer=metricsFactory.getTimer(IndexBatchBuffer.class,"index.buffer.flush");
  this.indexSizeCounter=metricsFactory.getCounter(IndexBatchBuffer.class,"index.buffer.size");
  this.config=config;
  this.blockingQueue=new ArrayBlockingQueue<>(config.getIndexBatchSize());
  this.failureMonitor=new FailureMonitorImpl(config,provider);
  this.producer=new Producer();
  this.client=provider.getClient();
  bufferCounter=metricsFactory.getCounter(IndexBatchBuffer.class,"index.buffer.size");
  consumer();
}
