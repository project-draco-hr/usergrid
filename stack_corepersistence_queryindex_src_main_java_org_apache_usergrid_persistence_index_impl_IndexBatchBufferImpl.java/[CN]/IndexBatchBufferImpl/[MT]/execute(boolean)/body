{
  if (blockingQueue.size() == 0) {
    return;
  }
  BulkRequestBuilder bulkRequest=initRequest(refresh);
  Collection<RequestBuilderContainer> containerCollection=new ArrayList<>(config.getIndexBatchSize());
  blockingQueue.drainTo(containerCollection);
  int count=0;
  for (  RequestBuilderContainer container : containerCollection) {
    ShardReplicationOperationRequestBuilder builder=container.getBuilder();
    if (builder instanceof IndexRequestBuilder) {
      bulkRequest.add((IndexRequestBuilder)builder);
    }
    if (builder instanceof DeleteRequestBuilder) {
      bulkRequest.add((DeleteRequestBuilder)builder);
    }
    if (count++ == config.getIndexBatchSize()) {
      sendRequest(bulkRequest);
      bulkRequest=initRequest(refresh);
    }
  }
  sendRequest(bulkRequest);
  for (  RequestBuilderContainer container : containerCollection) {
    container.done();
  }
}
