{
  CustomCollection things=context.application().collection("test3things");
  int size=40;
  List<Map<String,String>> created=new ArrayList<Map<String,String>>(size);
  for (int i=0; i < size; i++) {
    Map<String,String> entity=hashMap("name",String.valueOf(i));
    things.create(entity);
    created.add(entity);
  }
  refreshIndex(context.getOrgName(),context.getAppName());
  ApiResponse response;
  int deletePageSize=10;
  things=things.withLimit(deletePageSize);
  for (int i=0; i < size / deletePageSize; i++) {
    response=parse(things.delete());
    refreshIndex(context.getOrgName(),context.getAppName());
    assertEquals("Only 10 entities should have been deleted",10,response.getEntityCount());
  }
  response=parse(things.get());
  assertEquals("All entities should have been removed",0,response.getEntityCount());
  response=parse(things.delete());
  assertEquals("No more entities deleted",0,response.getEntityCount());
}
