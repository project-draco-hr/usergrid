{
  try {
    JSONObject json;
    json=new JSONObject().put("event","message");
    JSONObject jsondata=new JSONObject();
    Iterator<String> it=extras.keySet().iterator();
    while (it.hasNext()) {
      String key=it.next();
      Object value=extras.get(key);
      if (key.equals("from") || key.equals("collapse_key")) {
        json.put(key,value);
      }
 else       if (key.equals("foreground")) {
        json.put(key,extras.getBoolean("foreground"));
      }
 else       if (key.equals("coldstart")) {
        json.put(key,extras.getBoolean("coldstart"));
      }
 else {
        if (key.equals("message") || key.equals("msgcnt") || key.equals("soundname")) {
          json.put(key,value);
        }
        if (value instanceof String) {
          String strValue=(String)value;
          if (strValue.startsWith("{")) {
            try {
              JSONObject json2=new JSONObject(strValue);
              jsondata.put(key,json2);
            }
 catch (            Exception e) {
              jsondata.put(key,value);
            }
          }
 else           if (strValue.startsWith("[")) {
            try {
              JSONArray json2=new JSONArray(strValue);
              jsondata.put(key,json2);
            }
 catch (            Exception e) {
              jsondata.put(key,value);
            }
          }
 else {
            jsondata.put(key,value);
          }
        }
      }
    }
    json.put("payload",jsondata);
    Log.v(TAG,"extrasToJSON: " + json.toString());
    return json;
  }
 catch (  JSONException e) {
    Log.e(TAG,"extrasToJSON: JSON exception");
  }
  return null;
}
