{
  IndexValidationUtils.validateIndexScope(indexScope);
  final String indexType=createCollectionScopeTypeName(indexScope);
  if (logger.isDebugEnabled()) {
    logger.debug("Indexing entity {}:{} in scope\n   app {}\n   " + "owner {}\n   name {}\n   type {}",new Object[]{entity.getId().getType(),entity.getId().getUuid(),applicationScope.getApplication(),indexScope.getOwner(),indexScope.getName(),indexType});
  }
  ValidationUtils.verifyEntityWrite(entity);
  Map<String,Object> entityAsMap=entityToMap(entity);
  entityAsMap.put(STRING_PREFIX + ENTITYID_FIELDNAME,entity.getId().getUuid().toString().toLowerCase());
  entityAsMap.put(ENTITYVERSION_FIELDNAME,entity.getVersion().timestamp());
  String indexId=createIndexDocId(entity);
  logger.debug("Indexing entity id {} data {} ",indexId,entityAsMap);
  bulkRequest.add(client.prepareIndex(indexName,indexType,indexId).setSource(entityAsMap));
  maybeFlush();
  return this;
}
