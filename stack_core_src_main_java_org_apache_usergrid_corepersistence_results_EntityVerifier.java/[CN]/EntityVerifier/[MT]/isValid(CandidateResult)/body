{
  final Id entityId=candidateResult.getId();
  final MvccEntity savedEntity=ids.getEntity(entityId);
  if (savedEntity == null) {
    logger.warn("Version for Entity {}:{} not found",entityId.getType(),entityId.getUuid());
    return false;
  }
  final UUID candidateVersion=candidateResult.getVersion();
  final UUID savedVersion=savedEntity.getVersion();
  if (UUIDComparator.staticCompare(savedVersion,candidateVersion) > 0) {
    logger.debug("Stale version of Entity uuid:{} type:{}, stale v:{}, latest v:{}",new Object[]{entityId.getUuid(),entityId.getType(),candidateVersion,savedEntity});
    return false;
  }
  final Optional<org.apache.usergrid.persistence.model.entity.Entity> entity=savedEntity.getEntity();
  if (!entity.isPresent()) {
    logger.warn("Entity uuid:{} version v:{} is deleted but indexed, this is a bug ",entityId.getUuid(),savedEntity.getEntity());
    return false;
  }
  entityMapping.put(entityId,entity.get());
  return true;
}
