{
  if (slice.operator == FilterOperator.WITHIN) {
    Object v=slice.getValue();
    if ((v instanceof List) && (((List)v).size() >= 3)) {
      double maxDistance=getDouble(((List)v).get(0));
      double latitude=getDouble(((List)v).get(1));
      double longitude=getDouble(((List)v).get(2));
      Results r=em.getGeoIndexManager().proximitySearchCollection(getHeadEntity(),collectionName,slice.getPropertyName(),new Point(latitude,longitude),maxDistance,null,count,false,level);
      return r;
    }
    return new Results();
  }
  Object indexKey=key(headEntity.getUuid(),collectionName);
  if (subkeyProperties != null) {
    if (subkey_key == null) {
      String collectionType=em.getEntityType(headEntity.getUuid());
      CollectionInfo collection=getDefaultSchema().getCollection(collectionType,collectionName);
      subkey_key=getCFKeyForSubkey(collection,subkeyProperties,null);
    }
    if (subkey_key != null) {
      indexKey=key(headEntity.getUuid(),collectionName,subkey_key);
    }
  }
  List<HColumn<ByteBuffer,ByteBuffer>> results=searchIndex(indexKey,slice,count);
  return getIndexResults(results,true,null,itemType,level);
}
