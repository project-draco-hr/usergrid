{
  if (query == null) {
    query=new Query();
  }
  String connectedEntityType=query.getEntityType();
  String connectionType=query.getConnectionType();
  headEntity=em.validate(headEntity);
  ConnectionRefImpl connectionRef=new ConnectionRefImpl(headEntity,new ConnectedEntityRefImpl(connectionType,connectedEntityType,null));
  QueryProcessor qp=new QueryProcessor(query,null);
  SearchConnectionVisitor visitor=new SearchConnectionVisitor(query,qp,em,connectionRef);
  return qp.getResults(visitor,getResultsLoader(query));
}
