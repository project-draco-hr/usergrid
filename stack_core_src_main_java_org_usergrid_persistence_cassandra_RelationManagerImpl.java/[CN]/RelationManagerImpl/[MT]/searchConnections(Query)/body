{
  if (query == null) {
    return null;
  }
  headEntity=em.validate(headEntity);
  Results results=null;
  if (!query.hasQueryPredicates()) {
    return null;
  }
  QueryProcessor qp=new QueryProcessor(query);
  ConnectionRefImpl connectionRef=new ConnectionRefImpl(headEntity,new ConnectedEntityRefImpl(ConnectionRefImpl.CONNECTION_ENTITY_CONNECTION_TYPE,ConnectionRefImpl.CONNECTION_ENTITY_TYPE,null));
  SearchConnectionVisitor visitor=new SearchConnectionVisitor(query,qp,connectionRef);
  qp.getFirstNode().visit(visitor);
  results=visitor.getResults();
  return (List)getConnections(results.getIds());
}
