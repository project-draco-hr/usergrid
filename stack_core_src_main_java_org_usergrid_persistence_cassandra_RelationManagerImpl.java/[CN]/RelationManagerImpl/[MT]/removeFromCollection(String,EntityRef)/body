{
  if (headEntity.getUuid().equals(applicationId)) {
    if (collectionName.equals(COLLECTION_ROLES)) {
      Entity itemEntity=em.get(itemRef);
      if (itemEntity != null) {
        RoleRef roleRef=SimpleRoleRef.forRoleEntity(itemEntity);
        em.deleteRole(roleRef.getApplicationRoleName());
        return;
      }
      em.delete(itemEntity);
      return;
    }
    em.delete(itemRef);
    return;
  }
  Entity entity=getHeadEntity();
  Entity itemEntity=em.get(itemRef);
  if (itemEntity == null) {
    return;
  }
  UUID timestampUuid=newTimeUUID();
  Mutator<ByteBuffer> batch=createMutator(cass.getApplicationKeyspace(applicationId),be);
  batchRemoveFromCollection(batch,collectionName,itemEntity,timestampUuid);
  CollectionInfo collection=getDefaultSchema().getCollection(entity.getType(),collectionName);
  if ((collection != null) && (collection.getLinkedCollection() != null)) {
    getRelationManager(itemEntity).batchRemoveFromCollection(batch,collection.getLinkedCollection(),entity,timestampUuid);
  }
  batchExecute(batch,CassandraService.RETRY_COUNT);
  if (headEntity.getType().equals(Group.ENTITY_TYPE)) {
    if (collectionName.equals(COLLECTION_ROLES)) {
      String path=(String)((DynamicEntity)itemRef).getMetadata("path");
      if (path.startsWith("/roles/")) {
        RoleRef roleRef=SimpleRoleRef.forRoleEntity(itemEntity);
        em.deleteRole(roleRef.getApplicationRoleName());
      }
    }
  }
}
