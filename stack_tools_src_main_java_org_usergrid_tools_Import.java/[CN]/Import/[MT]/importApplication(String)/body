{
  File applicationFile=new File(importDir,applicationName);
  logger.info("Loading application file: " + applicationFile.getAbsolutePath());
  JsonParser jp=getJsonParserForFile(applicationFile);
  JsonToken token=jp.nextToken();
  validateStartArray(token);
  token=jp.nextValue();
  Application application=jp.readValueAs(Application.class);
  @SuppressWarnings("unchecked") String orgName=((Map<String,String>)application.getMetadata("organization")).get("value");
  OrganizationInfo info=managementService.getOrganizationByName(orgName);
  if (info == null) {
    logger.error("Unable to import application '{}' for organisation with name '{}'",application.getName(),orgName);
    return;
  }
  UUID appId=managementService.importApplication(info.getUuid(),application);
  echo(application);
  EntityManager em=emf.getEntityManager(appId);
  for (  Entry<String,String> entry : em.getRoles().entrySet()) {
    em.deleteRole(entry.getKey());
  }
  while (jp.nextValue() != JsonToken.END_ARRAY) {
    @SuppressWarnings("unchecked") Map<String,Object> entityProps=jp.readValueAs(HashMap.class);
    UUID uuid=getId(entityProps);
    String type=getType(entityProps);
    try {
      em.create(uuid,type,entityProps);
    }
 catch (    DuplicateUniquePropertyExistsException de) {
      logger.error("Unable to create entity.  It appears to be a duplicate",de);
    }
catch (    Exception e) {
      logger.error("Unable to create entity " + uuid + " of type "+ type+ ", skipping but this may indicate a bad import...",e);
    }
    echo(entityProps);
  }
  logger.info("----- End of application:" + application.getName());
  jp.close();
}
