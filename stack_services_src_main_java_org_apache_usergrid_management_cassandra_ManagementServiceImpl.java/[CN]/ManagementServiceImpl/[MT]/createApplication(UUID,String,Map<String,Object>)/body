{
  if ((organizationId == null) || (applicationName == null)) {
    return null;
  }
  if (properties == null) {
    properties=new HashMap<String,Object>();
  }
  OrganizationInfo organizationInfo=getOrganizationByUuid(organizationId);
  UUID applicationId=emf.createApplication(organizationInfo.getName(),applicationName,properties);
  EntityManager em=emf.getEntityManager(smf.getManagementAppId());
  properties.put("name",buildAppName(applicationName,organizationInfo));
  properties.put("appUuid",applicationId);
  Entity appInfo=em.create(applicationId,APPLICATION_INFO,properties);
  writeUserToken(smf.getManagementAppId(),appInfo,encryptionService.plainTextCredentials(generateOAuthSecretKey(AuthPrincipalType.APPLICATION),null,smf.getManagementAppId()));
  addApplicationToOrganization(organizationId,applicationId,appInfo);
  UserInfo user=null;
  try {
    user=SubjectUtils.getUser();
  }
 catch (  UnavailableSecurityManagerException e) {
  }
  if ((user != null) && user.isAdminUser()) {
    postOrganizationActivity(organizationId,user,"create",appInfo,"Application",applicationName,"<a href=\"mailto:" + user.getEmail() + "\">"+ user.getName()+ " ("+ user.getEmail()+ ")</a> created a new application named "+ applicationName,null);
  }
  return new ApplicationInfo(applicationId,appInfo.getName());
}
