{
  if ((organizationName == null) || (user == null)) {
    return null;
  }
  logger.info("createOrganizationInternal: {}",organizationName);
  EntityManager em=emf.getEntityManager(smf.getManagementAppId());
  Group organizationEntity=new Group();
  organizationEntity.setPath(organizationName);
  organizationEntity=em.create(organizationEntity);
  em.addToCollection(organizationEntity,"users",new SimpleEntityRef(User.ENTITY_TYPE,user.getUuid()));
  em.refreshIndex();
  writeUserToken(smf.getManagementAppId(),organizationEntity,encryptionService.plainTextCredentials(generateOAuthSecretKey(AuthPrincipalType.ORGANIZATION),user.getUuid(),smf.getManagementAppId()));
  OrganizationInfo organization=new OrganizationInfo(organizationEntity.getUuid(),organizationName,properties);
  updateOrganization(organization);
  logger.info("createOrganizationInternal: {}",organizationName);
  postOrganizationActivity(organization.getUuid(),user,"create",organizationEntity,"Organization",organization.getName(),"<a href=\"mailto:" + user.getEmail() + "\">"+ user.getName()+ " ("+ user.getEmail()+ ")</a> created a new organization account named "+ organizationName,null);
  startOrganizationActivationFlow(organization);
  return organization;
}
