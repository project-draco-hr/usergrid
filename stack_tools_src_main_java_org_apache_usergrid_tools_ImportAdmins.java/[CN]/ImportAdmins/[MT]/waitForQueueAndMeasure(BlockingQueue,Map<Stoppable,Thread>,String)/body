{
  double rateAverageSum=0;
  int iterationCounter=0;
  while (!workQueue.isEmpty()) {
    iterationCounter+=1;
    int sizeLast=workQueue.size();
    long lastTime=System.currentTimeMillis();
    logger.info("Queue {} is not empty, remaining size={}, waiting...",identifier,sizeLast);
    Thread.sleep(5000);
    long timeNow=System.currentTimeMillis();
    int sizeNow=workQueue.size();
    int processed=sizeLast - sizeNow;
    long timeDelta=timeNow - lastTime;
    double rateLast=(double)processed / (timeDelta / 1000);
    rateAverageSum+=rateLast;
    long timeRemaining=sizeLast / (long)(rateAverageSum / iterationCounter);
    logger.info(String.format("++PROGRESS (%s): sizeLast=%s nowSize=%s processed=%s rateLast=%s/s rateAvg=%s/s timeRemaining=%s(s)",identifier,sizeLast,sizeNow,processed,rateLast,(rateAverageSum / iterationCounter),timeRemaining));
  }
  for (  Stoppable worker : threadMap.keySet()) {
    worker.setDone(true);
  }
}
