{
  String outputDir=line.getOptionValue("output");
  createDir(outputDir);
  startSpring();
  logger.info("Starting crawl of all admins");
  EntityManager em=emf.getEntityManager(emf.getManagementAppId());
  Application app=em.getApplication();
  Query query=new Query();
  query.setLimit(PAGE_SIZE);
  Results r=null;
  Multimap<String,UUID> orgs=HashMultimap.create();
  do {
    r=em.searchCollection(app,"groups",query);
    for (    Entity entity : r.getEntities()) {
      String name=entity.getProperty("path").toString().toLowerCase();
      orgs.put(name,entity.getUuid());
    }
    query.setCursor(r.getCursor());
    logger.info("Searching next page");
  }
 while (r != null && r.size() == PAGE_SIZE);
  for (  String name : orgs.keySet()) {
    Collection<UUID> ids=orgs.get(name);
    if (ids.size() > 1) {
      logger.warn("Found multiple orgs with the name {}",name);
      OrganizationInfo orgInfo=managementService.getOrganizationByName(name);
      UUID targetOrgId=orgInfo.getUuid();
      ids.remove(targetOrgId);
      for (      UUID sourceId : ids) {
        mergeOrganizations(outputDir,sourceId,targetOrgId);
      }
    }
  }
  logger.info("Merge complete");
}
