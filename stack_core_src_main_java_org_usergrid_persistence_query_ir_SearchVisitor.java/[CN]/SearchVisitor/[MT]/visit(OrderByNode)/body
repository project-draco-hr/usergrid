{
  QuerySlice slice=orderByNode.getFirstPredicate().getAllSlices().iterator().next();
  QuerySlice primarySlice=slice;
  queryProcessor.applyCursorAndSort(slice);
  if (orderByNode.hasSecondarySorts()) {
    primarySlice=new QuerySlice(slice.getPropertyName(),Integer.MIN_VALUE);
  }
  IndexScanner scanner;
  if (slice.isComplete()) {
    scanner=new NoOpIndexScanner();
  }
 else {
    scanner=secondaryIndexScan(orderByNode,primarySlice);
  }
  ResultIterator orderIterator;
  if (!orderByNode.hasSecondarySorts()) {
    orderIterator=new SliceIterator<DynamicComposite>(slice,scanner,COLLECTION_PARSER,slice.hasCursor());
  }
 else {
    orderIterator=new OrderByIterator(slice,scanner,COLLECTION_PARSER,orderByNode.getSecondarySorts(),em,queryProcessor.getPageSizeHint(orderByNode));
  }
  results.push(orderIterator);
}
