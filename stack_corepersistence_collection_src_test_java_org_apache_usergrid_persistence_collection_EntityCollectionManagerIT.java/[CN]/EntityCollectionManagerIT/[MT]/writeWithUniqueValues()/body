{
  CollectionScope context=new CollectionScopeImpl(new SimpleId("organization"),new SimpleId("test"),"test");
  EntityCollectionManager manager=factory.createCollectionManager(context);
{
    Entity newEntity=new Entity(new SimpleId("test"));
    newEntity.setField(new IntegerField("count",5,true));
    Observable<Entity> observable=manager.write(newEntity);
    Entity returned=observable.toBlockingObservable().lastOrDefault(null);
  }
{
    boolean dupPrevented=false;
    try {
      Entity newEntity=new Entity(new SimpleId("test"));
      newEntity.setField(new IntegerField("count",5,true));
      Observable<Entity> observable=manager.write(newEntity);
      Entity returned=observable.toBlockingObservable().lastOrDefault(null);
    }
 catch (    CollectionRuntimeException cre) {
      dupPrevented=true;
    }
    Assert.assertTrue(dupPrevented);
  }
}
