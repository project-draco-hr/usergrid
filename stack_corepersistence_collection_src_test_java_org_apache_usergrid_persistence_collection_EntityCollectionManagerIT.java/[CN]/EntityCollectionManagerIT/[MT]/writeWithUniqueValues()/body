{
  ApplicationScope context=new ApplicationScopeImpl(new SimpleId("organization"));
  EntityCollectionManager manager=factory.createCollectionManager(context);
  Entity entity=new Entity(new SimpleId("test"));
  entity.setField(new IntegerField("count",5,true));
  Observable<Entity> firstWrite=manager.write(entity);
  Entity newEntity=null;
  Entity firstReturned=null;
  for (int i=0; i < 500; i++) {
    firstReturned=firstWrite.toBlocking().lastOrDefault(null);
  }
  assertEquals(entity.getId().getUuid(),firstReturned.getId().getUuid());
  assertEquals(entity.getVersion(),firstReturned.getVersion());
}
