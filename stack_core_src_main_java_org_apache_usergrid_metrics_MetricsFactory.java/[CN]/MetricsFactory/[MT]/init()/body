{
  properties=new Properties();
  try {
    properties.load(Thread.currentThread().getContextClassLoader().getResourceAsStream("usergrid.properties"));
  }
 catch (  Exception e) {
    LOG.error("Could not load props","");
  }
  registry=new MetricRegistry();
  String badHost="badhost";
  String metricsHost=properties.getProperty("usergrid.metrics.graphite.host",badHost);
  Graphite graphite=new Graphite(new InetSocketAddress(metricsHost,2003));
  graphiteReporter=GraphiteReporter.forRegistry(registry).prefixedWith("notifications").convertRatesTo(TimeUnit.SECONDS).convertDurationsTo(TimeUnit.MILLISECONDS).filter(MetricFilter.ALL).build(graphite);
  if (metricsHost != badHost) {
    graphiteReporter.start(30,TimeUnit.SECONDS);
  }
 else {
    LOG.warn("MetricsService:Logger not started.");
    graphiteReporter.stop();
  }
  hashMap=new ConcurrentHashMap<String,Metric>();
  jmxReporter=JmxReporter.forRegistry(registry).build();
  jmxReporter.start();
}
