{
  String type=entityClassToType.get(cls);
  if (type != null) {
    return type;
  }
  String className=cls.getName();
  if (className.startsWith(ENTITIES_PACKAGE_PREFIX)) {
    type=className.substring(ENTITIES_PACKAGE_PREFIX.length());
    type=InflectionUtils.underscore(type);
  }
 else {
    type=className;
  }
  typeToEntityClass.put(type,cls);
  entityClassToType.put(cls,type);
  return type;
}
