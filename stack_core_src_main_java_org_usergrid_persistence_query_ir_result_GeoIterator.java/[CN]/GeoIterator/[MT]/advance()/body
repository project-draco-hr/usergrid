{
  if (done || toReturn != null) {
    return;
  }
  idOrder.clear();
  SearchResults results;
  try {
    results=searcher.proximitySearch(last,lastCellsSearched,resultSize);
  }
 catch (  Exception e) {
    throw new RuntimeException("Unable to search geo locations",e);
  }
  List<EntityLocationRef> locations=results.entityLocations;
  lastCellsSearched=results.lastSearchedGeoCells;
  for (int i=0; i < locations.size(); i++) {
    EntityLocationRef location=locations.get(i);
    UUID id=location.getUuid();
    idOrder.put(id,location);
    last=location;
  }
  if (locations.size() < resultSize) {
    done=true;
  }
  if (idOrder.size() > 0) {
    toReturn=idOrder.keySet();
  }
}
