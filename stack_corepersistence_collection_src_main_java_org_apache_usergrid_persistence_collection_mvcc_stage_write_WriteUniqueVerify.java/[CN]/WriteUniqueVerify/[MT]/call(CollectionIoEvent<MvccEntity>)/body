{
  ValidationUtils.verifyMvccEntityWithEntity(ioevent.getEvent());
  Entity entity=ioevent.getEvent().getEntity().get();
  for (  Field field : entity.getFields()) {
    if (field.isUnique()) {
      UniqueValue written=new UniqueValueImpl(ioevent.getEntityCollection(),field,entity.getId(),entity.getVersion());
      MutationBatch mb=uniqueValueSerializiationStrategy.write(written);
      try {
        mb.execute();
      }
 catch (      ConnectionException ex) {
        throw new CollectionRuntimeException("Error writing unique value " + field.toString(),ex);
      }
      UniqueValue loaded;
      try {
        loaded=uniqueValueSerializiationStrategy.load(ioevent.getEntityCollection(),field);
      }
 catch (      ConnectionException ex) {
        throw new CollectionRuntimeException(ex);
      }
      if (!loaded.equals(written)) {
        throw new CollectionRuntimeException("Duplicate field value " + field.toString());
      }
    }
  }
  return ioevent;
}
