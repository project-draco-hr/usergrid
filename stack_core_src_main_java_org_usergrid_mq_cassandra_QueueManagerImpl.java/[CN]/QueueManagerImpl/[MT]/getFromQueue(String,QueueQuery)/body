{
  if (query == null) {
    query=new QueueQuery();
  }
  Keyspace ko=cass.getApplicationKeyspace(applicationId);
  QueueSearch search=null;
  if (query.getPosition() == LAST || query.getPosition() == CONSUMER) {
    if (!query.hasFilterPredicates()) {
      if (query.getTimeout() > 0) {
        search=new ConsumerTransaction(applicationId,ko,lockManager,cass);
      }
 else {
        search=new NoTransactionSearch(ko,cass);
      }
    }
 else {
      search=new BooleanSearch();
    }
  }
 else   if (query.getPosition() == START) {
    search=new StartSearch(ko,cass);
  }
 else   if (query.getPosition() == END) {
    search=new EndSearch(ko,cass);
  }
 else {
    throw new IllegalArgumentException("You must specify a valid position");
  }
  return search.getResults(queuePath,query);
}
