{
  if (startDatabaseWithServer) {
    startCassandra();
  }
  httpServer=HttpServer.createSimpleServer(".",port);
  ServletHandler handler=new ServletHandler();
  handler.addContextParameter(SpringServlet.CONTEXT_CONFIG_LOCATION,"classpath:/usergrid-standalone-context.xml");
  handler.addServletListener(ContextLoaderListener.class.getName());
  handler.addServletListener(RequestContextListener.class.getName());
  com.sun.jersey.api.json.JSONConfiguration.badgerFish();
  handler.addInitParameter(PackagesResourceConfig.PROPERTY_PACKAGES,"org.usergrid");
  handler.addInitParameter(JSONConfiguration.FEATURE_POJO_MAPPING,"true");
  handler.addInitParameter(ResourceConfig.PROPERTY_CONTAINER_REQUEST_FILTERS,"org.usergrid.rest.filters.MeteringFilter,org.usergrid.rest.filters.JSONPCallbackFilter,org.usergrid.rest.security.shiro.filters.OAuth2AccessTokenSecurityFilter,org.usergrid.rest.security.shiro.filters.BasicAuthSecurityFilter,org.usergrid.rest.security.shiro.filters.ClientCredentialsSecurityFilter");
  handler.addInitParameter(ResourceConfig.PROPERTY_CONTAINER_RESPONSE_FILTERS,"org.usergrid.rest.security.CrossOriginRequestFilter,org.usergrid.rest.filters.MeteringFilter");
  handler.addInitParameter(ResourceConfig.PROPERTY_RESOURCE_FILTER_FACTORIES,"org.usergrid.rest.security.SecuredResourceFilterFactory,com.sun.jersey.api.container.filter.RolesAllowedResourceFilterFactory");
  handler.addInitParameter(ResourceConfig.FEATURE_DISABLE_WADL,"true");
  handler.addInitParameter(ServletContainer.JSP_TEMPLATES_BASE_PATH,"/WEB-INF/jsp");
  handler.addInitParameter(ServletContainer.PROPERTY_WEB_PAGE_CONTENT_REGEX,"/(((images|css|js|jsp|WEB-INF/jsp)/.*)|(favicon\\.ico))");
  handler.setServletInstance(new SpringServlet());
  handler.setProperty("load-on-startup",1);
  Map<String,String> initParameters=new HashMap<String,String>();
  initParameters.put("targetFilterLifecycle","true");
  handler.addFilter(new ContentTypeFilter(),"contentTypeFilter",Collections.EMPTY_MAP);
  handler.addFilter(new DelegatingFilterProxy(),"shiroFilter",initParameters);
  handler.addFilter(new SwaggerServlet(),"swagger",null);
  setupJspMappings();
  httpServer.getServerConfiguration().addHttpHandler(handler,"/*");
  ClasspathStaticHttpHandler static_handler=new ClasspathStaticHttpHandler("/html/css/");
  httpServer.getServerConfiguration().addHttpHandler(static_handler,"/css/*");
  httpServer.getServerConfiguration().setJmxEnabled(true);
  try {
    httpServer.start();
  }
 catch (  IOException e) {
    e.printStackTrace();
  }
  if (daemon) {
    while (true) {
      try {
        Thread.sleep(Long.MAX_VALUE);
      }
 catch (      InterruptedException e) {
        logger.warn("Interrupted");
      }
    }
  }
}
