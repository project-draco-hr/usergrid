{
  TestAdminUser testAdmin=new TestAdminUser("queueresourcetest.transactionPageConsistent","queueresourcetest.transactionPageConsistent@usergrid.com","queueresourcetest.transactionPageConsistent@usergrid.com");
  TestContext context=TestContext.create(this).withOrg("queueresourcetest.transactionPageConsistent").withApp("transactionPageConsistent").withUser(testAdmin).initAll();
  Queue queue=context.application().queues().queue("test");
  final int count=1000;
  @SuppressWarnings("unchecked") Map<String,?>[] data=new Map[count];
  for (int i=0; i < count; i++) {
    data[i]=MapUtils.hashMap("id",i);
  }
  queue.post(data);
  final long timeout=20000;
  queue=queue.withTimeout(timeout).withNext(120);
  IncrementHandler incrementHandler=new IncrementHandler(count);
  testMessages(queue,incrementHandler,new NoLastCommand());
  incrementHandler.assertResults();
}
