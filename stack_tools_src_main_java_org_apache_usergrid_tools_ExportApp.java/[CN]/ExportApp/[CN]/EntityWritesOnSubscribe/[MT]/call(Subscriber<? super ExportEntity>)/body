{
  int count=0;
  while (true) {
    ExportEntity entity=null;
    try {
      activePollers.getAndIncrement();
      entity=queue.poll(pollTimeoutSeconds,TimeUnit.SECONDS);
    }
 catch (    InterruptedException e) {
      logger.error("Entity poll interrupted",e);
      continue;
    }
 finally {
      activePollers.getAndDecrement();
    }
    if (entity == null) {
      break;
    }
    subscriber.onNext(entity);
    count++;
  }
  logger.info("Done. De-queued {} entities",count);
  if (count > 0) {
    subscriber.onCompleted();
  }
 else {
    subscriber.unsubscribe();
  }
}
