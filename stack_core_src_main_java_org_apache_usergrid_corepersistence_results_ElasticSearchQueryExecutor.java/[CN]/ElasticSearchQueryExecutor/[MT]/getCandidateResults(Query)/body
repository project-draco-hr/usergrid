{
  final Optional<Integer> cursor=query.getOffset();
  final String queryToExecute=query.getQl().or("select *");
  CandidateResults results=cursor.isPresent() ? entityIndex.search(indexScope,types,queryToExecute,query.getLimit(),cursor.get()) : entityIndex.search(indexScope,types,queryToExecute,query.getLimit());
  if (results.getOffset().isPresent()) {
    query.setOffset(results.getOffset().get());
  }
 else {
    query.clearOffset();
  }
  return results;
}
