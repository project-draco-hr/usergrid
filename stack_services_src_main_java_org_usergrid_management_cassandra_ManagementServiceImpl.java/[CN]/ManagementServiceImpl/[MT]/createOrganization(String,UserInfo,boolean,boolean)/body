{
  if ((organizationName == null) || (user == null)) {
    return null;
  }
  EntityManager em=emf.getEntityManager(MANAGEMENT_APPLICATION_ID);
  if (!em.isPropertyValueUniqueForEntity("group","path",organizationName)) {
    throw new DuplicateUniquePropertyExistsException("group","path",organizationName);
  }
  Group organizationEntity=new Group();
  organizationEntity.setPath(organizationName);
  organizationEntity=em.create(organizationEntity);
  em.addToCollection(organizationEntity,"users",new SimpleEntityRef(User.ENTITY_TYPE,user.getUuid()));
  Map<String,CredentialsInfo> credentials=new HashMap<String,CredentialsInfo>();
  credentials.put(USER_TOKEN,plainTextCredentials(generateOAuthSecretKey(AuthPrincipalType.ORGANIZATION)));
  em.addMapToDictionary(organizationEntity,DICTIONARY_CREDENTIALS,credentials);
  OrganizationInfo organization=new OrganizationInfo(organizationEntity.getUuid(),organizationName);
  postOrganizationActivity(organization.getUuid(),user,"create",organizationEntity,"Organization",organization.getName(),"<a mailto=\"" + user.getEmail() + "\">"+ user.getName()+ " ("+ user.getEmail()+ ")</a> created a new organization account named "+ organizationName,null);
  if (sendEmail) {
    startOrganizationActivationFlow(organization);
  }
  return organization;
}
