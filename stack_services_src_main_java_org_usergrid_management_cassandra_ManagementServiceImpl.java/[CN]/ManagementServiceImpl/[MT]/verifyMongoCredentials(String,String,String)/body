{
  UserInfo userInfo=null;
  Entity user=findUserEntity(MANAGEMENT_APPLICATION_ID,name);
  if (user == null) {
    return null;
  }
  String mongo_pwd=(String)user.getProperty(MONGO_PASSWORD);
  if (mongo_pwd == null) {
    userInfo=new UserInfo(MANAGEMENT_APPLICATION_ID,user.getProperties());
  }
  if (userInfo == null) {
    String expected_key=DigestUtils.md5Hex(nonce + user.getProperty("username") + mongo_pwd);
    if (expected_key.equalsIgnoreCase(key)) {
      userInfo=new UserInfo(MANAGEMENT_APPLICATION_ID,user.getProperties());
    }
  }
  if (userInfo != null) {
    if (!userInfo.isActivated()) {
      throw new UnactivatedAdminUserException();
    }
    if (userInfo.isDisabled()) {
      throw new DisabledAdminUserException();
    }
  }
  return userInfo;
}
