{
  if ((organizationName == null) || (user == null)) {
    return null;
  }
  logger.info("createOrganizationInternal: {}",organizationName);
  EntityManager em=emf.getEntityManager(MANAGEMENT_APPLICATION_ID);
  Group organizationEntity=new Group();
  organizationEntity.setPath(organizationName);
  organizationEntity=em.create(organizationEntity);
  if (customProperties != null) {
    for (    Map.Entry<String,Object> entry : customProperties.entrySet()) {
      em.addToDictionary(organizationEntity,CUSTOM_PROPERTIES_DICTIONARY,entry.getKey(),entry.getValue());
    }
  }
  em.addToCollection(organizationEntity,"users",new SimpleEntityRef(User.ENTITY_TYPE,user.getUuid()));
  writeUserToken(MANAGEMENT_APPLICATION_ID,organizationEntity,encryptionService.plainTextCredentials(generateOAuthSecretKey(AuthPrincipalType.ORGANIZATION),user.getUuid(),MANAGEMENT_APPLICATION_ID));
  OrganizationInfo organization=new OrganizationInfo(organizationEntity.getUuid(),organizationName,customProperties);
  logger.info("createOrganizationInternal: {}",organizationName);
  postOrganizationActivity(organization.getUuid(),user,"create",organizationEntity,"Organization",organization.getName(),"<a href=\"mailto:" + user.getEmail() + "\">"+ user.getName()+ " ("+ user.getEmail()+ ")</a> created a new organization account named "+ organizationName,null);
  startOrganizationActivationFlow(organization);
  return organization;
}
