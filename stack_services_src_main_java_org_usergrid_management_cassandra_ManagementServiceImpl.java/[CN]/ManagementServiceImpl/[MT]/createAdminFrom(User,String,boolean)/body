{
  EntityManager em=emf.getEntityManager(MANAGEMENT_APPLICATION_ID);
  Map<String,CredentialsInfo> credentials=new HashMap<String,CredentialsInfo>();
  credentials.put("password",passwordCredentials(password));
  credentials.put("mongo_pwd",mongoPasswordCredentials(user.getUsername(),password));
  credentials.put("secret",plainTextCredentials(generateOAuthSecretKey(AuthPrincipalType.ADMIN_USER)));
  em.addMapToDictionary(user,DICTIONARY_CREDENTIALS,credentials);
  UserInfo userInfo=new UserInfo(MANAGEMENT_APPLICATION_ID,user.getUuid(),user.getUsername(),user.getName(),user.getEmail(),user.getActivated(),user.getDisabled());
  if (sendEmail && !user.getActivated()) {
    sendAdminUserActivationEmail(userInfo);
  }
  return userInfo;
}
