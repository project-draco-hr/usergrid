{
  Map<String,CredentialsInfo> credentials=new HashMap<String,CredentialsInfo>();
  credentials.put(USER_TOKEN,plainTextCredentials(generateOAuthSecretKey(AuthPrincipalType.ADMIN_USER)));
  EntityManager em=emf.getEntityManager(MANAGEMENT_APPLICATION_ID);
  em.addMapToDictionary(user,DICTIONARY_CREDENTIALS,credentials);
  setAdminCreds(user,userPassword,mongoPassword);
  UserInfo userInfo=new UserInfo(MANAGEMENT_APPLICATION_ID,user.getUuid(),user.getUsername(),user.getName(),user.getEmail(),user.getActivated(),user.getDisabled());
  if (sendEmail && !user.getActivated()) {
    this.startAdminUserActivationFlow(userInfo);
  }
  return userInfo;
}
