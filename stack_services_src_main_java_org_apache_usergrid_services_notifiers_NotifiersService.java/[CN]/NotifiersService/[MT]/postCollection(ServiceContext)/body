{
  ServicePayload payload=context.getPayload();
  NotificationsService ns=(NotificationsService)sm.getService("notifications");
  String provider=payload.getStringProperty("provider");
  ServiceResults results=super.postCollection(context);
  Notifier notifier=(Notifier)results.getEntity();
  if (notifier != null) {
    try {
      ProviderAdapter providerAdapter=ProviderAdapterFactory.getProviderAdapter(notifier,em);
      if (providerAdapter == null) {
        throw new IllegalArgumentException("provider must be one of: " + Arrays.toString(ProviderAdapterFactory.getValidProviders()));
      }
      providerAdapter.validateCreateNotifier(payload);
      ns.testConnection(notifier);
    }
 catch (    Exception e) {
      logger.info("notifier testConnection() failed",e);
      em.delete(notifier);
      throw e;
    }
  }
  return results;
}
