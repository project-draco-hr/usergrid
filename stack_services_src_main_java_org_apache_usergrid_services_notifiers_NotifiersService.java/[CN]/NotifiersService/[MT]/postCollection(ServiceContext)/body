{
  ServicePayload payload=context.getPayload();
  NotificationsService ns=(NotificationsService)sm.getService("notifications");
  Set<String> providers=ns.getProviders();
  String provider=payload.getStringProperty("provider");
  if (!providers.contains(provider)) {
    throw new IllegalArgumentException("provider must be one of: " + Arrays.toString(providers.toArray()));
  }
  ProviderAdapter providerAdapter=ns.providerAdapters.get(provider);
  providerAdapter.validateCreateNotifier(payload);
  ServiceResults results=super.postCollection(context);
  DynamicEntity entity=(DynamicEntity)results.getEntity();
  Notifier notifier1=new Notifier();
  notifier1.setProperties(entity.getProperties());
  if (entity != null) {
    try {
      ns.testConnection(notifier1);
    }
 catch (    Exception e) {
      logger.info("notifier testConnection() failed",e);
      em.delete(entity);
      throw e;
    }
  }
  return results;
}
