{
  if (entityRef == null) {
    return null;
  }
  Id id=new SimpleId(entityRef.getUuid(),entityRef.getType());
  CollectionScope collectionScope=getCollectionScopeNameFromEntityType(getApplicationScope().getApplication(),entityRef.getType());
  org.apache.usergrid.persistence.model.entity.Entity cpEntity=load(new EntityScope(collectionScope,id));
  if (cpEntity == null) {
    if (logger.isDebugEnabled()) {
      logger.debug("FAILED to load entity {}:{} from scope\n   app {}\n   owner {}\n   name {}",new Object[]{id.getType(),id.getUuid(),collectionScope.getApplication(),collectionScope.getOwner(),collectionScope.getName()});
    }
    return null;
  }
  Class clazz=Schema.getDefaultSchema().getEntityClass(entityRef.getType());
  Entity entity=EntityFactory.newEntity(entityRef.getUuid(),entityRef.getType(),clazz);
  entity.setProperties(CpEntityMapUtils.toMap(cpEntity));
  return entity;
}
