{
  EntityIndex ei=managerCache.getEntityIndex(organizationScope,applicationScope);
  RelationManager rm=getRelationManager(entity);
  Map<String,Map<UUID,Set<String>>> owners=rm.getOwners();
  logger.debug("Updating indexes of all {} collections owning the entity",owners.keySet().size());
  for (  String ownerType : owners.keySet()) {
    Map<UUID,Set<String>> collectionsByUuid=owners.get(ownerType);
    for (    UUID uuid : collectionsByUuid.keySet()) {
      Set<String> collections=collectionsByUuid.get(uuid);
      for (      String coll : collections) {
        CollectionScope ownerScope=new CollectionScopeImpl(applicationScope.getOrganization(),applicationScope.getOwner(),Schema.defaultCollectionName(ownerType));
        EntityCollectionManager ownerEcm=managerCache.getEntityCollectionManager(ownerScope);
        org.apache.usergrid.persistence.model.entity.Entity cpOwner=ownerEcm.load(new SimpleId(uuid,ownerType)).toBlockingObservable().last();
        ei.indexConnection(cpOwner,coll + CpRelationManager.COLLECTION_SUFFIX,cpEntity,collectionScope);
      }
    }
  }
}
