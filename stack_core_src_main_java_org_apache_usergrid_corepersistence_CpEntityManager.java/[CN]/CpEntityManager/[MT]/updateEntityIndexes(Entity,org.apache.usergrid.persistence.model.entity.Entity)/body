{
  RelationManager rm=getRelationManager(entity);
  Map<String,Map<UUID,Set<String>>> owners=rm.getOwners();
  logger.debug("Updating indexes of all {} collections owning the entity",owners.keySet().size());
  for (  String ownerType : owners.keySet()) {
    Map<UUID,Set<String>> collectionsByUuid=owners.get(ownerType);
    for (    UUID uuid : collectionsByUuid.keySet()) {
      Set<String> collections=collectionsByUuid.get(uuid);
      for (      String coll : collections) {
        if (coll == null || coll.trim().isEmpty()) {
          logger.warn("Ignoring empty collection name for owner {}:{}",uuid,ownerType);
          break;
        }
        IndexScope indexScope=new IndexScopeImpl(appScope.getApplication(),new SimpleId(uuid,ownerType),getCollectionScopeNameFromCollectionName(coll));
        EntityIndex ei=managerCache.getEntityIndex(indexScope);
        ei.index(cpEntity);
      }
    }
  }
}
