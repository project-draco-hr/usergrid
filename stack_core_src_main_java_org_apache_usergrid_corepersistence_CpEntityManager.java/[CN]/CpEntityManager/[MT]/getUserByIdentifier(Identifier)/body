{
  if (identifier == null) {
    logger.debug("getUserByIdentifier: returning null for null identifier");
    return null;
  }
  logger.debug("getUserByIdentifier {}:{}",identifier.getType(),identifier.toString());
  if (identifier.isUUID()) {
    return new SimpleEntityRef("user",identifier.getUUID());
  }
  if (identifier.isName()) {
    return this.getAlias(new SimpleEntityRef(Application.ENTITY_TYPE,applicationId),"user",identifier.getName());
  }
  if (identifier.isEmail()) {
    Query query=new Query();
    query.setEntityType("user");
    query.addEqualityFilter("email",identifier.getEmail());
    query.setLimit(1);
    query.setResultsLevel(REFS);
    Results r=getRelationManager(ref(Application.ENTITY_TYPE,applicationId)).searchCollection("users",query);
    if (r != null && r.getRef() != null) {
      logger.debug("Got entity ref!");
      return r.getRef();
    }
 else {
      logger.debug("return alias");
      return this.getAlias(new SimpleEntityRef(Application.ENTITY_TYPE,applicationId),"user",identifier.getEmail());
    }
  }
  return null;
}
