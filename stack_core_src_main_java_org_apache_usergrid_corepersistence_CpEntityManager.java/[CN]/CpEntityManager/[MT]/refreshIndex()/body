{
  try {
    long start=System.currentTimeMillis();
    Map<String,Object> map=new org.apache.usergrid.persistence.index.utils.MapUtils.HashMapBuilder<>();
    map.put("some prop","test");
    boolean hasFinished=false;
    Entity refreshEntity=create("refresh",map);
    try {
      for (int i=0; i < 10; i++) {
        if (searchCollection(new SimpleEntityRef(org.apache.usergrid.persistence.entities.Application.ENTITY_TYPE,getApplicationId()),InflectionUtils.pluralize("refresh"),Query.fromQL("select * where uuid='" + refreshEntity.getUuid() + "'")).size() > 0) {
          hasFinished=true;
          break;
        }
        Thread.sleep(250);
        return managerCache.getEntityIndex(applicationScope).refreshAsync().toBlocking().first();
      }
    }
  finally {
      delete(refreshEntity);
    }
    return new IndexRefreshCommand.IndexRefreshCommandInfo(hasFinished,System.currentTimeMillis() - start);
  }
 catch (  Exception e) {
    throw new RuntimeException("refresh failed",e);
  }
}
