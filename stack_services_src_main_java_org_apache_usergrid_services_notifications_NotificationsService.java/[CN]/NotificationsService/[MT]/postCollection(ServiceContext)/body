{
  LOG.info("NotificationService: start request.");
  Timer.Context timer=postTimer.time();
  postMeter.mark();
  try {
    validate(null,context.getPayload());
    PathQuery<Device> pathQuery=TEST_PATH_QUERY != null ? TEST_PATH_QUERY : getPathQuery(context.getRequest().getOriginalParameters());
    context.getProperties().put("state",Notification.State.CREATED);
    context.getProperties().put("pathQuery",pathQuery);
    context.setOwner(sm.getApplication());
    ServiceResults results=super.postCollection(context);
    Notification notification=(Notification)results.getEntity();
    LOG.info("NotificationService: notification {} pre queue ",notification.getUuid());
    if (!notificationQueueManager.scheduleQueueJob(notification)) {
      notificationQueueManager.queueNotification(notification,null);
    }
    outstandingQueue.inc();
    LOG.info("NotificationService: notification {} post queue ",notification.getUuid());
    return results;
  }
  finally {
    timer.stop();
  }
}
