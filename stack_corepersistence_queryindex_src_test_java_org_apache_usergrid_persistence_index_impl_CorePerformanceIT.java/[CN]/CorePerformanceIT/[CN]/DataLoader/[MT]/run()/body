{
  EntityCollectionManager ecm=ecmf.createCollectionManager(scope);
  EntityCollectionIndex eci=ecif.createCollectionIndex(scope);
  FileReader fr;
  try {
    fr=new FileReader("../../resources/finefoods.txt");
  }
 catch (  FileNotFoundException ex) {
    throw new RuntimeException("Error opening file",ex);
  }
  BufferedReader br=new BufferedReader(fr);
  String s=null;
  Entity current=new Entity(new SimpleId(UUIDGenerator.newTimeUUID(),"review"));
  Id orgId=scope.getOrganization();
  Id appId=scope.getOwner();
  int count=0;
  try {
    while ((s=br.readLine()) != null && count < maxEntities) {
      try {
        if (s.trim().equals("")) {
          ecm.write(current).toBlockingObservable().last();
          eci.index(current);
          if (maxEntities < 20) {
            log.info("Index written for {}",current.getId());
            log.info("---");
          }
          current=new Entity(new SimpleId(UUIDGenerator.newTimeUUID(),"review"));
          count++;
          if (count % 100000 == 0) {
            log.info("Indexed {} reviews in {} / {} ",count,orgId,appId);
          }
          continue;
        }
        String name=s.substring(0,s.indexOf(":")).replace("/","_").toLowerCase();
        String value=s.substring(s.indexOf(":") + 1).trim();
        if (maxEntities < 20) {
          log.info("Indexing {} = {}",name,value);
        }
        if (NumberUtils.isNumber(value) && value.contains(".")) {
          current.setField(new DoubleField(name,Double.parseDouble(value)));
        }
 else         if (NumberUtils.isNumber(value)) {
          current.setField(new LongField(name,Long.parseLong(value)));
        }
 else {
          current.setField(new StringField(name,value.toString()));
        }
      }
 catch (      Exception e) {
        log.info("Error on line " + count);
      }
    }
  }
 catch (  IOException ex) {
    throw new RuntimeException("Error reading file",ex);
  }
  eci.refresh();
}
