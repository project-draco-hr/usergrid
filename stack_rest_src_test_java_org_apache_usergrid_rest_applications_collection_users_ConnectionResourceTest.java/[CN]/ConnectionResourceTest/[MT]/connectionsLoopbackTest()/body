{
  CollectionEndpoint things=this.app().collection("things");
  UUID thing1Id=things.post(new Entity().chainPut("name","thing1")).getUuid();
  UUID thing2Id=things.post(new Entity().chainPut("name","thing2")).getUuid();
  refreshIndex();
  things.entity(thing1Id).connection("likes").entity(thing2Id).post();
  refreshIndex();
  Entity response=things.entity("thing1").get();
  String url=((Map)((Map)response.get("metadata")).get("connections")).get("likes").toString();
  assertNotNull("Connection url returned in entity",url);
  url=url.substring(1);
  Collection collection=this.app().collection(url).get();
  Entity entity=collection.next();
  UUID returnedUUID=entity.getUuid();
  assertEquals(thing2Id,returnedUUID);
  url=((Map)((Map)entity.get("metadata")).get("connections")).get("likes").toString();
  assertNotNull("Incoming edge URL provited",url);
  url=url.substring(1);
  collection=this.app().collection(url).get();
  UUID returned=collection.next().getUuid();
  assertEquals("Should point to thing1 as an incoming entity connection",thing1Id,returned);
}
