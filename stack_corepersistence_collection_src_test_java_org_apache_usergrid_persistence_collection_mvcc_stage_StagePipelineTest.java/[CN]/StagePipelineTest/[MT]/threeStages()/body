{
  Stage first=mock(Stage.class);
  Stage second=mock(Stage.class);
  Stage third=mock(Stage.class);
  StagePipeline pipeline=StagePipelineImpl.fromStages(first,second,third);
  assertSame("Correct stage returned",first,pipeline.first());
  Stage next=pipeline.nextStage(first);
  assertSame("Correct stage returned",second,next);
  next=pipeline.nextStage(next);
  assertSame("Correct stage returned",third,next);
  next=pipeline.nextStage(next);
  assertNull("No next stage",next);
}
