{
  ExecutionStage first=mock(ExecutionStage.class);
  ExecutionStage second=mock(ExecutionStage.class);
  ExecutionStage third=mock(ExecutionStage.class);
  StagePipeline pipeline=StagePipelineImpl.fromStages(first,second,third);
  assertSame("Correct stage returned",first,pipeline.first());
  ExecutionStage next=pipeline.nextStage(first);
  assertSame("Correct stage returned",second,next);
  next=pipeline.nextStage(next);
  assertSame("Correct stage returned",third,next);
  next=pipeline.nextStage(next);
  assertNull("No next stage",next);
}
