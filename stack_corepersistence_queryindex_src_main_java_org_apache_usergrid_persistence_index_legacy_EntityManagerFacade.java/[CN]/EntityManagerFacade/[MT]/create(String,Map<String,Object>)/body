{
  CollectionScope scope=new CollectionScopeImpl(appId,orgId,type);
  EntityCollectionManager ecm=getManager(scope);
  EntityCollectionIndex eci=getIndex(scope);
  final String collectionName;
  if (type.endsWith("y")) {
    collectionName=type.substring(0,type.length() - 1) + "ies";
  }
 else {
    collectionName=type + "s";
  }
  typesByCollectionNames.put(collectionName,type);
  Entity entity=new Entity(new SimpleId(UUIDGenerator.newTimeUUID(),type));
  entity=EntityMapUtils.fromMap(entity,properties);
  entity.setField(new LongField("created",entity.getId().getUuid().timestamp()));
  entity.setField(new LongField("modified",entity.getId().getUuid().timestamp()));
  entity=ecm.write(entity).toBlockingObservable().last();
  eci.index(entity);
  return entity;
}
