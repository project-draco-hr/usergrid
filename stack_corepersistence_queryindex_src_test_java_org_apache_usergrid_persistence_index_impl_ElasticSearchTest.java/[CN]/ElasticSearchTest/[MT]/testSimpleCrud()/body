{
  String indexName=RandomStringUtils.randomAlphanumeric(20).toLowerCase();
  String collectionName="testtype1";
  String id=RandomStringUtils.randomAlphanumeric(20);
  Client client=elasticSearchRule.getClient();
  Map<String,Object> json=new HashMap<String,Object>();
  json.put("user","edward");
  json.put("postDate",new Date());
  json.put("message","who knows if the moon???s a baloon");
  IndexResponse indexResponse=client.prepareIndex(indexName,collectionName,id).setSource(json).execute().actionGet();
  assertTrue(indexResponse.isCreated());
  GetResponse getResponse=client.prepareGet(indexName,collectionName,id).get();
  assertEquals("edward",getResponse.getSource().get("user"));
  json.put("message","If freckles were lovely, and day was night");
  client.prepareUpdate(indexName,collectionName,id).setDoc(json).execute().actionGet();
  getResponse=client.prepareGet(indexName,collectionName,id).get();
  assertEquals("If freckles were lovely, and day was night",getResponse.getSource().get("message"));
  client.prepareUpdate(indexName,collectionName,id).setScript("ctx._source.message = \"coming out of a keen city in the sky\"").execute().actionGet();
  getResponse=client.prepareGet(indexName,collectionName,id).get();
  assertEquals("coming out of a keen city in the sky",getResponse.getSource().get("message"));
  client.prepareDelete(indexName,collectionName,id).execute().actionGet();
  getResponse=client.prepareGet(indexName,collectionName,id).get();
  assertFalse(getResponse.isExists());
  client.close();
}
