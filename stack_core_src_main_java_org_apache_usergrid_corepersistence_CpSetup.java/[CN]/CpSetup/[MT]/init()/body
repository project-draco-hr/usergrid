{
  cass.init();
  try {
    logger.info("Loading Core Persistence properties");
    ConfigurationManager.loadCascadedPropertiesFromResources("usergrid-default");
    String hostsString="";
    CassandraHost[] hosts=cass.getCassandraHostConfigurator().buildCassandraHosts();
    if (hosts.length == 0) {
      throw new RuntimeException("Fatal error: no Cassandra hosts configured");
    }
    String sep="";
    for (    CassandraHost host : hosts) {
      hostsString=sep + host.getHost();
      sep=",";
    }
    Properties cpProps=new Properties();
    cpProps.put("cassandra.hosts",hostsString);
    cpProps.put("cassandra.port",hosts[0].getPort());
    ConfigurationManager.loadProperties(cpProps);
    logger.debug("Set Cassandra properties for Core Persistence: " + cpProps.toString());
  }
 catch (  IOException e) {
    throw new RuntimeException("Fatal error loading configuration.",e);
  }
  Injector injector=CpSetup.getInjector();
  MigrationManager m=injector.getInstance(MigrationManager.class);
  try {
    m.migrate();
  }
 catch (  MigrationException ex) {
    throw new RuntimeException("Error migrating Core Persistence",ex);
  }
  setupSystemKeyspace();
  setupStaticKeyspace();
  createDefaultApplications();
}
