{
synchronized (lock) {
    if (instance != null) {
      return instance;
    }
    int rpcPort=AvailablePortFinder.getNextAvailable(CassandraResource.DEFAULT_RPC_PORT + RandomUtils.nextInt(1000));
    int storagePort=AvailablePortFinder.getNextAvailable(CassandraResource.DEFAULT_STORAGE_PORT + RandomUtils.nextInt(1000));
    int sslStoragePort=AvailablePortFinder.getNextAvailable(CassandraResource.DEFAULT_SSL_STORAGE_PORT + RandomUtils.nextInt(1000));
    int nativeTransportPort=AvailablePortFinder.getNextAvailable(CassandraResource.DEFAULT_NATIVE_TRANSPORT_PORT + RandomUtils.nextInt(1000));
    if (rpcPort == storagePort) {
      storagePort++;
      storagePort=AvailablePortFinder.getNextAvailable(storagePort);
    }
    if (sslStoragePort == storagePort) {
      sslStoragePort++;
      sslStoragePort=AvailablePortFinder.getNextAvailable(sslStoragePort);
    }
    instance=new CassandraResource(schemaManagerName,rpcPort,storagePort,sslStoragePort,nativeTransportPort);
    LOG.info("Created a new instance of CassandraResource: {}",instance);
    LOG.info("Cassandra using ports {} and {}",storagePort,sslStoragePort);
    return instance;
  }
}
