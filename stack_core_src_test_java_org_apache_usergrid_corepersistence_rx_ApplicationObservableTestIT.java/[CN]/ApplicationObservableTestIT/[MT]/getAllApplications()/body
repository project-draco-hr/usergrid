{
  final Application createdApplication=app.getEntityManager().getApplication();
  ApplicationObservable applicationObservable=SpringResource.getInstance().getBean(Injector.class).getInstance(ApplicationObservable.class);
  final Set<UUID> applicationIds=new HashSet<UUID>(){
{
      add(CpNamingUtils.DEFAULT_APPLICATION_ID);
      add(CpNamingUtils.MANAGEMENT_APPLICATION_ID);
      add(CpNamingUtils.SYSTEM_APP_ID);
      add(createdApplication.getUuid());
    }
  }
;
  ManagerCache managerCache=SpringResource.getInstance().getBean(Injector.class).getInstance(ManagerCache.class);
  Observable<Id> appObservable=applicationObservable.getAllApplicationIds();
  appObservable.doOnNext(new Action1<Id>(){
    @Override public void call(    final Id id){
      applicationIds.remove(id.getUuid());
      assertEquals("Correct application type expected",Application.ENTITY_TYPE,id.getType());
    }
  }
).toBlocking().lastOrDefault(null);
  assertEquals("Every element should have been encountered",0,applicationIds.size());
}
