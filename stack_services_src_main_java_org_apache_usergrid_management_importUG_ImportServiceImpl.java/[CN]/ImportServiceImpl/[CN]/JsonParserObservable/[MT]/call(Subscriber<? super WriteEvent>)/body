{
  WriteEvent entityWrapper=null;
  EntityRef ownerEntityRef=null;
  String entityUuid="";
  String entityType="";
  try {
    while (!subscriber.isUnsubscribed() && jp.nextToken() != JsonToken.END_OBJECT) {
      String collectionName=jp.getCurrentName();
      if (collectionName.equals("connections")) {
        jp.nextToken();
        while (jp.nextToken() != JsonToken.END_OBJECT) {
          String connectionType=jp.getCurrentName();
          jp.nextToken();
          while (jp.nextToken() != JsonToken.END_ARRAY) {
            String entryId=jp.getText();
            EntityRef entryRef=new SimpleEntityRef(UUID.fromString(entryId));
            entityWrapper=new ConnectionEvent(ownerEntityRef,connectionType,entryRef);
            subscriber.onNext(entityWrapper);
          }
        }
      }
 else       if (collectionName.equals("dictionaries")) {
        jp.nextToken();
        while (jp.nextToken() != JsonToken.END_OBJECT) {
          String dictionaryName=jp.getCurrentName();
          jp.nextToken();
          Map<String,Object> dictionary=jp.readValueAs(HashMap.class);
          entityWrapper=new DictionaryEvent(ownerEntityRef,dictionaryName,dictionary);
          subscriber.onNext(entityWrapper);
        }
        subscriber.onCompleted();
      }
 else {
        jp.nextToken();
        Map<String,Object> properties=new HashMap<String,Object>();
        JsonToken token=jp.nextToken();
        while (token != JsonToken.END_OBJECT) {
          if (token == JsonToken.VALUE_STRING || token == JsonToken.VALUE_NUMBER_INT) {
            String key=jp.getCurrentName();
            if (key.equals("uuid")) {
              entityUuid=jp.getText();
            }
 else             if (key.equals("type")) {
              entityType=jp.getText();
            }
 else             if (key.length() != 0 && jp.getText().length() != 0) {
              String value=jp.getText();
              properties.put(key,value);
            }
          }
          token=jp.nextToken();
        }
        ownerEntityRef=new SimpleEntityRef(entityType,UUID.fromString(entityUuid));
        entityWrapper=new EntityEvent(UUID.fromString(entityUuid),entityType,properties);
        subscriber.onNext(entityWrapper);
      }
    }
  }
 catch (  Exception e) {
    fileImport.setErrorMessage(e.getMessage());
    try {
      rootEm.update(fileImport);
    }
 catch (    Exception ex) {
    }
    subscriber.onError(e);
  }
}
