{
  FileImport fileImport=getFileImportEntity(jobExecution);
  File file=new File(jobExecution.getJobData().getProperty("File").toString());
  EntityManager rootEm=emf.getEntityManager(MANAGEMENT_APPLICATION_ID);
  rootEm.update(fileImport);
  boolean completed=fileImport.getCompleted();
  if (!completed) {
    if (isValidJSON(file,rootEm,fileImport)) {
      fileImport.setState(FileImport.State.STARTED);
      rootEm.update(fileImport);
      String applicationName=file.getPath().split("\\.")[0];
      ApplicationInfo application=managementService.getApplicationInfo(applicationName);
      JsonParser jp=getJsonParserForFile(file);
      String lastUpdatedUUID=fileImport.getLastUpdatedUUID();
      if (!lastUpdatedUUID.equals(" ")) {
        while (!jp.getText().equals(lastUpdatedUUID)) {
          jp.nextToken();
        }
        while (!(jp.getCurrentToken() == JsonToken.END_OBJECT && jp.nextToken() == JsonToken.START_OBJECT)) {
          jp.nextToken();
        }
      }
      while (jp.getCurrentToken() != JsonToken.START_OBJECT) {
        jp.nextToken();
      }
      EntityManager em=emf.getEntityManager(application.getId());
      try {
        String uuid=" ";
        while (jp.nextToken() != JsonToken.END_ARRAY) {
          uuid=importEntityStuff(jp,em,rootEm,fileImport,jobExecution);
        }
        if (!uuid.equals(" ")) {
          fileImport.setLastUpdatedUUID(uuid);
          rootEm.update(fileImport);
        }
        jp.close();
      }
 catch (      OrganizationNotFoundException e) {
        fileImport.setErrorMessage(e.getMessage());
        fileImport.setState(FileImport.State.FINISHED);
        rootEm.update(fileImport);
        return;
      }
catch (      ApplicationNotFoundException e) {
        fileImport.setErrorMessage(e.getMessage());
        fileImport.setState(FileImport.State.FINISHED);
        rootEm.update(fileImport);
        return;
      }
      if (!fileImport.getState().equals("FAILED")) {
        fileImport.setCompleted(true);
        fileImport.setState(FileImport.State.FINISHED);
        rootEm.update(fileImport);
        Results ImportJobResults=rootEm.getConnectingEntities(fileImport.getUuid(),"includes",null,Results.Level.ALL_PROPERTIES);
        List<Entity> importEntity=ImportJobResults.getEntities();
        UUID importId=importEntity.get(0).getUuid();
        Import importUG=rootEm.get(importId,Import.class);
        Results entities=rootEm.getConnectedEntities(importId,"includes",null,Results.Level.ALL_PROPERTIES);
        List<Entity> importFile=entities.getEntities();
        int count=0;
        for (        Entity eachEntity : importFile) {
          FileImport fi=rootEm.get(eachEntity.getUuid(),FileImport.class);
          if (fi.getState().toString().equals("FINISHED")) {
            count++;
          }
 else           if (fi.getState().toString().equals("FAILED")) {
            importUG.setState(Import.State.FAILED);
            rootEm.update(importUG);
            break;
          }
        }
        if (count == importFile.size()) {
          importUG.setState(Import.State.FINISHED);
          rootEm.update(importUG);
        }
      }
    }
  }
}
