{
  FileImport fileImport=getFileImportEntity(jobExecution);
  File file=(File)jobExecution.getJobData().getProperty("file");
  EntityManager rootEm=emf.getEntityManager(MANAGEMENT_APPLICATION_ID);
  boolean completed=fileImport.getCompleted();
  if (!completed) {
    if (isValidJSON(file,rootEm,fileImport)) {
      String applicationName=file.getPath().split("\\.")[0];
      ApplicationInfo application=managementService.getApplicationInfo(applicationName);
      JsonParser jp=getJsonParserForFile(file);
      String lastUpdatedUUID=fileImport.getLastUpdatedUUID();
      if (!lastUpdatedUUID.equals("")) {
        while (!jp.getText().equals(lastUpdatedUUID)) {
          jp.nextToken();
        }
        while (!(jp.getCurrentToken() == JsonToken.END_OBJECT && jp.nextToken() == JsonToken.START_OBJECT)) {
          jp.nextToken();
        }
      }
      while (jp.getCurrentToken() != JsonToken.START_OBJECT) {
        jp.nextToken();
      }
      EntityManager em=emf.getEntityManager(application.getId());
      try {
        while (jp.nextToken() != JsonToken.END_ARRAY) {
          importEntityStuff(jp,em,rootEm,fileImport);
        }
        jp.close();
      }
 catch (      OrganizationNotFoundException e) {
        fileImport.setErrorMessage(e.getMessage());
        fileImport.setState(FileImport.State.FINISHED);
        em.update(fileImport);
        return;
      }
catch (      ApplicationNotFoundException e) {
        fileImport.setErrorMessage(e.getMessage());
        fileImport.setState(FileImport.State.FINISHED);
        em.update(fileImport);
        return;
      }
catch (      Exception e) {
        fileImport.setErrorMessage(e.getMessage());
        em.update(fileImport);
        throw e;
      }
      if (!fileImport.getState().equals("FAILED")) {
        fileImport.setCompleted(true);
        fileImport.setState(FileImport.State.FINISHED);
        rootEm.update(fileImport);
        UUID importId=UUID.fromString(jobExecution.getJobData().getProperty("importUUID").toString());
        Import importUG=rootEm.get(importId,Import.class);
        List<Entity> entities=importUG.getConnections("includes");
        int count=0;
        for (        Entity eachEntity : entities) {
          FileImport fi=em.get(eachEntity.getUuid(),FileImport.class);
          if (fi.getState().equals("FINISHED")) {
            count++;
          }
 else           if (fi.getState().equals("FAILED")) {
            importUG.setState(Import.State.FAILED);
            rootEm.update(importUG);
            break;
          }
        }
        if (count == entities.size()) {
          importUG.setState(Import.State.FINISHED);
          rootEm.update(importUG);
        }
      }
    }
  }
}
