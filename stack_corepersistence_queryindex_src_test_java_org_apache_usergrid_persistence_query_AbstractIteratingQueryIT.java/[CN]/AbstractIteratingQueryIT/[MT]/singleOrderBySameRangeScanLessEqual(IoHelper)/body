{
  io.doSetup();
  int size=TEST_SIZE;
  int queryLimit=TEST_SIZE / 10;
  int startValue=TEST_SIZE / 20;
  long start=System.currentTimeMillis();
  em.refreshIndex();
  LOG.info("Writing {} entities.",size);
  List<String> expected=new ArrayList<String>(size);
  for (int i=0; i < size; i++) {
    String name=String.valueOf(i);
    Map<String,Object> entity=new HashMap<String,Object>();
    entity.put("name",name);
    entity.put("index",i);
    io.writeEntity(entity);
    expected.add(name);
  }
  long stop=System.currentTimeMillis();
  em.refreshIndex();
  LOG.info("Writes took {} ms",stop - start);
  Query query=new Query();
  query.addSort("index desc");
  query.addLessThanFilter("index",startValue);
  query.setLimit(queryLimit);
  int count=0;
  int delta=size - startValue;
  start=System.currentTimeMillis();
  Results results;
  do {
    results=io.getResults(query);
    for (int i=0; i < results.size(); i++) {
      assertEquals(expected.get(size - delta - count- 1),results.getEntities().get(i).getField("name").getValue());
      count++;
    }
    query.setCursor(results.getCursor());
  }
 while (results.hasCursor());
  assertEquals(expected.size() - delta,count);
  stop=System.currentTimeMillis();
  LOG.info("Query took {} ms to return {} entities",stop - start,count);
}
