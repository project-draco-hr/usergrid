{
  final long now=timeService.getCurrentTime();
  final long newTimeout=now + timeout;
  List<TimeoutEvent<T>> results=new ArrayList<TimeoutEvent<T>>(maxSize);
  for (int i=0; i < maxSize; i++) {
    TimeoutEvent<T> queuedEvent=queue.peek();
    if (queuedEvent == null) {
      break;
    }
    if (queuedEvent.getTimeout() > now) {
      break;
    }
    final TimeoutEvent<T> newEvent=new SimpleTimeoutEvent<T>(queuedEvent.getEvent(),newTimeout);
    queue.add(newEvent);
    queue.poll();
    results.add(newEvent);
  }
  return results;
}
