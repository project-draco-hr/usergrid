{
  final long now=timeService.getCurrentTime();
  final long newTimeout=now + timeout;
  List<AsynchronousEvent<T>> results=new ArrayList<AsynchronousEvent<T>>(maxSize);
  for (int i=0; i < maxSize; i++) {
    AsynchronousEvent<T> queuedEvent=queue.peek();
    if (queuedEvent == null) {
      break;
    }
    if (queuedEvent.getTimeout() > now) {
      break;
    }
    final AsynchronousEvent<T> newEvent=new SimpleAsynchronousEvent<T>(queuedEvent.getEvent(),newTimeout);
    queue.add(newEvent);
    queue.poll();
    results.add(newEvent);
  }
  return results;
}
