{
  final long now=timeService.getCurrentTime();
  final long newTimeout=now + timeout;
  List<AsynchonrousEvent<T>> results=new ArrayList<AsynchonrousEvent<T>>(maxSize);
  for (int i=0; i < maxSize; i++) {
    AsynchonrousEvent<T> queuedEvent=queue.peek();
    if (queuedEvent == null) {
      break;
    }
    if (queuedEvent.getTimeout() > now) {
      break;
    }
    final AsynchonrousEvent<T> newEvent=new SimpleAsynchonrousEvent<T>(queuedEvent.getEvent(),newTimeout);
    queue.add(newEvent);
    queue.poll();
    results.add(newEvent);
  }
  return results;
}
