{
  Object jsonEntity=jsonWithPadding.getJsonSource();
  Type entityGenericType=jsonEntity.getClass();
  Class<?> entityType=jsonEntity.getClass();
  final boolean genericEntityUsed=jsonEntity instanceof GenericEntity;
  if (genericEntityUsed) {
    GenericEntity ge=(GenericEntity)jsonEntity;
    jsonEntity=ge.getEntity();
    entityGenericType=ge.getType();
    entityType=ge.getRawType();
  }
  httpHeaders.remove(HttpHeaders.CONTENT_TYPE);
  httpHeaders.putSingle(HttpHeaders.CONTENT_TYPE,JSON_MEDIA_TYPE);
  MessageBodyWriter bw=bodyWorker.getMessageBodyWriter(entityType,entityGenericType,annotations,JSON_MEDIA_TYPE);
  if (bw == null) {
    throw new RuntimeException("Couldn't find the serailziation writer for json type");
  }
  bw.writeTo(jsonEntity,entityType,entityGenericType,annotations,JSON_MEDIA_TYPE,httpHeaders,entityStream);
}
