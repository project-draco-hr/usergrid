{
  long sleepTime=Long.parseLong(props.getProperty(TIMEOUT_PROP));
  long runLoop=Long.parseLong(props.getProperty(RUNNLOOP_PROP));
  long customRetry=sleepTime * 2;
  int numberOfRuns=2;
  OnlyOnceUnlockOnFailExceution job=CassandraRunner.getBean("onlyOnceUnlockOnFailExceution",OnlyOnceUnlockOnFailExceution.class);
  job.setTimeout(customRetry);
  job.setLatch(numberOfRuns);
  job.setDelay(sleepTime);
  JobData returned=scheduler.createJob("onlyOnceUnlockOnFailExceution",System.currentTimeMillis(),new JobData());
  boolean waited=job.waitForException(runLoop * numberOfRuns * 2,TimeUnit.MILLISECONDS);
  assertTrue("Job threw exception",waited);
  boolean bothAttempted=job.waitForCount(runLoop * numberOfRuns * 2,TimeUnit.MILLISECONDS);
  assertTrue("Both jobs tried to run",bothAttempted);
  boolean completed=job.waitForCompletion(runLoop * numberOfRuns * 2,TimeUnit.MILLISECONDS);
  assertTrue("One completed",completed);
  JobStat stat=scheduler.getStatsForJob(returned.getJobName(),returned.getUuid());
  stat=scheduler.getStatsForJob(returned.getJobName(),returned.getUuid());
  assertEquals(numberOfRuns,stat.getTotalAttempts());
  assertEquals(numberOfRuns,stat.getRunCount());
  assertEquals(0,stat.getDelayCount());
}
