{
  if (query == null) {
    query=new Query();
    query.setCollection(collectionName);
  }
  headEntity=em.validate(headEntity);
  CollectionInfo collection=getDefaultSchema().getCollection(headEntity.getType(),collectionName);
  if (collection == null) {
    throw new RuntimeException("Cannot find collection-info for '" + collectionName + "' of "+ headEntity.getType()+ ":"+ headEntity.getUuid());
  }
  query.setEntityType(collection.getType());
  query=adjustQuery(query);
  final IdBuilder pipelineBuilder=pipelineBuilderFactory.create(applicationScope).withCursor(query.getCursor()).withLimit(query.getLimit()).fromId(cpHeadEntity.getId());
  final EntityBuilder results;
  if (query.isGraphSearch()) {
    results=pipelineBuilder.traverseCollection(collectionName).loadEntities();
  }
 else {
    final String entityType=collection.getType();
    results=pipelineBuilder.searchCollection(collectionName,entityType,query.getQl().get()).loadEntities();
  }
  return new ObservableQueryExecutor(results.build()).next();
}
