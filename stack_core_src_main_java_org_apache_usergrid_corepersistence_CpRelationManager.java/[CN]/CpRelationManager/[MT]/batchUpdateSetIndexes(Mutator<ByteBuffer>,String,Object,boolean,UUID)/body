{
  Entity entity=getHeadEntity();
  elementValue=getDefaultSchema().validateEntitySetValue(entity.getType(),setName,elementValue);
  IndexUpdate indexUpdate=batchStartIndexUpdate(batch,entity,setName,elementValue,timestampUuid,true,true,removeFromSet,false);
  Map<String,Set<CollectionInfo>> containers=getDefaultSchema().getContainersIndexingDictionary(entity.getType(),setName);
  if (containers != null) {
    Map<EntityRef,Set<String>> containerEntities=getContainers();
    for (    EntityRef containerEntity : containerEntities.keySet()) {
      if (containerEntity.getType().equals(TYPE_APPLICATION) && Schema.isAssociatedEntityType(entity.getType())) {
        logger.debug("Extended properties for {} not indexed by application",entity.getType());
        continue;
      }
      Set<String> collectionNames=containerEntities.get(containerEntity);
      Set<CollectionInfo> collections=containers.get(containerEntity.getType());
      if (collections != null) {
        for (        CollectionInfo collection : collections) {
          if (collectionNames.contains(collection.getName())) {
            batchUpdateCollectionIndex(indexUpdate,containerEntity,collection.getName());
          }
        }
      }
    }
  }
  batchUpdateBackwardConnectionsDictionaryIndexes(indexUpdate);
}
