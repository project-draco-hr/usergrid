{
  if (headEntity.getUuid().equals(applicationId)) {
    if (itemType.equals(TYPE_ENTITY)) {
      itemType=singularize(collName);
    }
    if (itemType.equals(TYPE_ROLE)) {
      Long inactivity=(Long)properties.get(PROPERTY_INACTIVITY);
      if (inactivity == null) {
        inactivity=0L;
      }
      return em.createRole((String)properties.get(PROPERTY_NAME),(String)properties.get(PROPERTY_TITLE),inactivity);
    }
    return em.create(itemType,properties);
  }
 else   if (headEntity.getType().equals(Group.ENTITY_TYPE) && (collName.equals(COLLECTION_ROLES))) {
    UUID groupId=headEntity.getUuid();
    String roleName=(String)properties.get(PROPERTY_NAME);
    return em.createGroupRole(groupId,roleName,(Long)properties.get(PROPERTY_INACTIVITY));
  }
  CollectionInfo collection=getDefaultSchema().getCollection(headEntity.getType(),collName);
  if ((collection != null) && !collection.getType().equals(itemType)) {
    return null;
  }
  properties=getDefaultSchema().cleanUpdatedProperties(itemType,properties,true);
  Entity itemEntity=em.create(itemType,properties);
  if (itemEntity != null) {
    addToCollection(collName,itemEntity);
    if (collection.getLinkedCollection() != null) {
      getRelationManager(getHeadEntity()).addToCollection(collection.getLinkedCollection(),itemEntity);
    }
  }
  return itemEntity;
}
