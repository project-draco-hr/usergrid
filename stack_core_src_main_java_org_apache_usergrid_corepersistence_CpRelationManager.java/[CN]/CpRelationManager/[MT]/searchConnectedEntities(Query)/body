{
  Preconditions.checkNotNull(query,"query cannot be null");
  final String connection=query.getConnectionType();
  Preconditions.checkNotNull(connection,"connection must be specified");
  headEntity=em.validate(headEntity);
  query=adjustQuery(query);
  final String entityType=query.getEntityType();
  final ReadPipelineBuilder readPipelineBuilder=pipelineBuilderFactory.createReadPipelineBuilder(applicationScope);
  readPipelineBuilder.withCursor(query.getOffsetCursor());
  readPipelineBuilder.withLimit(query.getLimit());
  readPipelineBuilder.setStartId(cpHeadEntity.getId());
  if (query.isGraphSearch()) {
    readPipelineBuilder.getConnection(connection);
  }
 else   if (entityType != null) {
    readPipelineBuilder.connectionWithQuery(connection,query.getQl().get(),entityType);
  }
 else {
    readPipelineBuilder.connectionWithQuery(connection,query.getQl().get());
  }
  final Observable<Results> resultsObservable=readPipelineBuilder.build();
  return new ObservableQueryExecutor(resultsObservable).next();
}
