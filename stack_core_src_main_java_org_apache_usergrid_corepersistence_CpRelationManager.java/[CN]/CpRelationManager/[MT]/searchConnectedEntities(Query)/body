{
  Preconditions.checkNotNull(query,"query cannot be null");
  final String connection=query.getConnectionType();
  Preconditions.checkNotNull(connection,"connection must be specified");
  headEntity=em.validate(headEntity);
  query=adjustQuery(query);
  final String entityType=query.getEntityType();
  final ReadPipelineBuilder readPipelineBuilder=pipelineBuilderFactory.createReadPipelineBuilder(applicationScope);
  readPipelineBuilder.withCursor(query.getCursor());
  readPipelineBuilder.withLimit(query.getLimit());
  readPipelineBuilder.setStartId(cpHeadEntity.getId());
  if (query.isGraphSearch()) {
    readPipelineBuilder.getConnection(connection);
  }
 else {
    readPipelineBuilder.getConnectionWithQuery(connection,Optional.fromNullable(entityType),query.getQl().get());
  }
  final Observable<ResultsPage> resultsObservable=readPipelineBuilder.execute();
  return new ObservableQueryExecutor(resultsObservable).next();
}
