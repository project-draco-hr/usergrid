{
  Results results=null;
  if (query.getLevel().equals(Level.IDS)) {
    List<UUID> ids=new ArrayList<UUID>();
    Iterator<CandidateResult> iter=crs.iterator();
    while (iter.hasNext()) {
      ids.add(iter.next().getId().getUuid());
    }
    results=Results.fromIdList(ids);
  }
 else   if (query.getLevel().equals(Level.REFS)) {
    List<EntityRef> entityRefs=new ArrayList<EntityRef>();
    Iterator<CandidateResult> iter=crs.iterator();
    while (iter.hasNext()) {
      Id id=iter.next().getId();
      entityRefs.add(new SimpleEntityRef(id.getType(),id.getUuid()));
    }
    results=Results.fromRefList(entityRefs);
  }
 else {
    CollectionScope collScope=new CollectionScopeImpl(applicationScope.getApplication(),applicationScope.getApplication(),collName);
    EntityCollectionManager ecm=managerCache.getEntityCollectionManager(collScope);
    List<Entity> entities=new ArrayList<Entity>();
    Iterator<CandidateResult> iter=crs.iterator();
    while (iter.hasNext()) {
      org.apache.usergrid.persistence.model.entity.Entity e=ecm.load(iter.next().getId()).toBlockingObservable().last();
      Entity entity=EntityFactory.newEntity(e.getId().getUuid(),e.getField("type").getValue().toString());
      Map<String,Object> entityMap=CpEntityMapUtils.toMap(e);
      entity.addProperties(entityMap);
      entities.add(entity);
    }
    results=Results.fromEntities(entities);
  }
  results.setCursor(crs.getCursor());
  results.setQueryProcessor(new CpQueryProcessor(em,headEntity,collName));
  return results;
}
