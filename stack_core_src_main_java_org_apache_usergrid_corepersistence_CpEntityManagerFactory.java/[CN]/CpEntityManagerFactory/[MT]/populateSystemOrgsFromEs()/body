{
  logger.info("Migrating system orgs");
  EntityCollectionManager ecm=getManagerCache().getEntityCollectionManager(SYSTEM_ORGS_SCOPE);
  EntityIndex ei=getManagerCache().getEntityIndex(SYSTEM_ORGS_INDEX_SCOPE);
  EntityManager systemAppEm=getEntityManager(SYSTEM_APP_ID);
  String cursor=null;
  boolean done=false;
  while (!done) {
    Query q=Query.fromQL("select *");
    q.setCursor(cursor);
    CandidateResults results=ei.search(q);
    cursor=results.getCursor();
    Iterator<CandidateResult> iter=results.iterator();
    while (iter.hasNext()) {
      CandidateResult cr=iter.next();
      Entity e=ecm.load(cr.getId()).toBlockingObservable().last();
      if (cr.getVersion().compareTo(e.getVersion()) < 0) {
        logger.debug("Stale version of Entity uuid:{} type:{}, stale v:{}, latest v:{}",new Object[]{cr.getId().getUuid(),cr.getId().getType(),cr.getVersion(),e.getVersion()});
        continue;
      }
      Map<String,Object> entityMap=CpEntityMapUtils.toMap(e);
      systemAppEm.create("organization",entityMap);
    }
    if (cursor == null) {
      done=true;
    }
  }
}
