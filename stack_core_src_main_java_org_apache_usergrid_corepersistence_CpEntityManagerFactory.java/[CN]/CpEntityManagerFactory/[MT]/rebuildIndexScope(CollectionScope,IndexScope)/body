{
  logger.info("Rebuild index scope for {}:{}:{}",new Object[]{cs.getOwner(),cs.getApplication(),cs.getName()});
  EntityCollectionManager ecm=managerCache.getEntityCollectionManager(cs);
  EntityIndex ei=managerCache.getEntityIndex(is);
  Query q=Query.fromQL("select *");
  CandidateResults results=ei.search(q);
  Map<String,UUID> appMap=new HashMap<String,UUID>();
  Iterator<CandidateResult> iter=results.iterator();
  while (iter.hasNext()) {
    CandidateResult cr=iter.next();
    Entity entity=ecm.load(cr.getId()).toBlockingObservable().last();
    if (cr.getVersion().compareTo(entity.getVersion()) < 0) {
      logger.warn("    Ignoring stale version uuid:{} type:{} version:{} latest version:{}",new Object[]{cr.getId().getUuid(),cr.getId().getType(),cr.getVersion(),entity.getVersion()});
      continue;
    }
    logger.info("    Updating CP Entity type: {} with id: {} for app id: {}",new Object[]{cr.getId().getType(),cr.getId().getUuid(),CpEntityManagerFactory.SYSTEM_APPS_SCOPE.getApplication().getUuid()});
    ei.index(entity);
  }
}
