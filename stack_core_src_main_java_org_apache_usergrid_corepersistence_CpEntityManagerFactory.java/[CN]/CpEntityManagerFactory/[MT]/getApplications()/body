{
  EntityCollectionManager em=getManagerCache().getEntityCollectionManager(SYSTEM_APPS_SCOPE);
  EntityIndex ei=getManagerCache().getEntityIndex(SYSTEM_APPS_INDEX_SCOPE);
  Map<String,UUID> appMap=new HashMap<String,UUID>();
  String cursor=null;
  boolean done=false;
  while (!done) {
    Query q=Query.fromQL("select *");
    q.setCursor(cursor);
    CandidateResults results=ei.search(SYSTEM_APPS_INDEX_SCOPE,q);
    cursor=results.getCursor();
    Iterator<CandidateResult> iter=results.iterator();
    while (iter.hasNext()) {
      CandidateResult cr=iter.next();
      Entity e=em.load(cr.getId()).toBlockingObservable().last();
      if (cr.getVersion().compareTo(e.getVersion()) < 0) {
        logger.debug("Stale version of Entity uuid:{} type:{}, stale v:{}, latest v:{}",new Object[]{cr.getId().getUuid(),cr.getId().getType(),cr.getVersion(),e.getVersion()});
        continue;
      }
      appMap.put((String)e.getField(PROPERTY_NAME).getValue(),(UUID)e.getField("applicationUuid").getValue());
    }
    if (cursor == null) {
      done=true;
    }
  }
  return appMap;
}
