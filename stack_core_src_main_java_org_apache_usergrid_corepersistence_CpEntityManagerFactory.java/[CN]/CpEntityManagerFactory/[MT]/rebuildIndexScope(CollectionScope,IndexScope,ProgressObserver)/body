{
  logger.info("Rebuild index scope for {}:{}:{}",new Object[]{cs.getOwner(),cs.getApplication(),cs.getName()});
  EntityCollectionManager ecm=managerCache.getEntityCollectionManager(cs);
  EntityIndex ei=managerCache.getEntityIndex(is);
  Query q=Query.fromQL("select *");
  CandidateResults results=ei.search(q);
  Iterator<CandidateResult> iter=results.iterator();
  while (iter.hasNext()) {
    CandidateResult cr=iter.next();
    Entity entity=ecm.load(cr.getId()).toBlockingObservable().last();
    if (cr.getVersion().compareTo(entity.getVersion()) < 0) {
      logger.warn("   Ignoring stale version uuid:{} type:{} state v:{} latest v:{}",new Object[]{cr.getId().getUuid(),cr.getId().getType(),cr.getVersion(),entity.getVersion()});
    }
 else {
      logger.info("   Updating entity type {} with id {} for app {}/{}",new Object[]{cr.getId().getType(),cr.getId().getUuid(),cs.getApplication().getUuid()});
      ei.index(entity);
      if (po != null) {
        po.onProgress();
      }
    }
  }
}
