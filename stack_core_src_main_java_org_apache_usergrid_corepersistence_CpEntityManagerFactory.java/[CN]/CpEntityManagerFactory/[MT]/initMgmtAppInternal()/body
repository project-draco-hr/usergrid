{
  Properties properties=cassandraService.getProperties();
  Integer maxRetries;
  try {
    Object maxRetriesObject=properties.get(MANAGEMENT_APP_MAX_RETRIES).toString();
    maxRetries=Integer.parseInt(maxRetriesObject.toString());
  }
 catch (  NumberFormatException nfe) {
    maxRetries=20;
  }
  EntityManager em=getEntityManager(getManagementAppId());
  int retryCount=0;
  while (managementApp != null && retryCount++ <= maxRetries) {
    try {
      managementApp=em.getApplication();
      if (managementApp == null) {
        logger.warn("Management application not found, attempting creation");
        Map mgmtAppProps=new HashMap<String,Object>();
        mgmtAppProps.put(PROPERTY_NAME,CassandraService.MANAGEMENT_APPLICATION);
        em.create(getManagementAppId(),TYPE_APPLICATION,mgmtAppProps);
        managementApp=em.getApplication();
      }
    }
 catch (    Throwable t) {
      logger.warn("Error getting or creating management application after " + retryCount + " retries",t);
    }
  }
  indexService.queueInitializeApplicationIndex(CpNamingUtils.getApplicationScope(getManagementAppId()));
  if (managementApp == null) {
    throw new RuntimeException("FATAL ERROR: Failed to get or create management app");
  }
}
