{
  String username=usernameField.getValue();
  String password=passwordField.getValue();
  if (StringUtils.isEmpty(username) || StringUtils.isEmpty(password)) {
    Notification.show("Error","Please enter username and password",Notification.Type.ERROR_MESSAGE);
    return;
  }
  try {
    if (UserListWindow.createClicked) {
      userDao.update(new User(username,password));
      BasicProviderParams newProviderParams=new BasicProviderParams(username,instanceTypeField.getValue(),accessKeyField.getValue(),secretKeyField.getValue(),imageField.getValue(),keyPairNameField.getValue());
      ProviderParams oldProviderParams=providerParamsDao.getByUser(username);
      Map<String,String> keys=oldProviderParams != null ? oldProviderParams.getKeys() : new HashMap<String,String>();
      newProviderParams.setKeys(keys);
      providerParamsDao.update(newProviderParams);
      close();
      Notification.show("Success","User updated successfully",Notification.Type.HUMANIZED_MESSAGE);
      UserListWindow.createClicked=false;
    }
 else {
      doSaveUser(username,password);
    }
  }
 catch (  Exception e) {
    Notification.show("Error","Error to save user: " + e.getMessage(),Notification.Type.ERROR_MESSAGE);
  }
}
