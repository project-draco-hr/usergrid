{
  UUID applicationId=emf.lookupApplication(appName);
  EntityManager em=emf.getEntityManager(applicationId);
  int total_count=em.getRelationManager(em.getApplicationRef()).getCollectionSize("users");
  if (total_count == 0) {
    logger.info("No results found, probably offline");
    return;
  }
  logger.info("Total count: " + total_count);
  int sample_interval=total_count / sample_count;
  logger.info("Skip count: " + sample_interval);
  int retrieve_count=((10000 / sample_interval) + 1) * sample_interval;
  logger.info("Retrieve count count: " + retrieve_count);
  List<UUID> users=new ArrayList<UUID>(sample_count);
  int i=0;
  Results r=null;
  do {
    r=em.getCollection(em.getApplicationRef(),"users",r != null ? r.getNextResult() : null,retrieve_count,Results.Level.IDS,false);
    for (int j=0; j < r.size(); j+=sample_interval) {
      UUID uuid=r.getIds().get(j);
      if (i < sample_count) {
        logger.info(i + ":" + uuid);
        users.add(uuid);
        i++;
      }
    }
  }
 while (r.hasMoreResults());
  String group_name="random_" + sample_count + "_"+ System.currentTimeMillis();
  logger.info("Group: " + group_name);
  Entity group=em.create("group",hashMap("path",(Object)group_name));
  for (  UUID uuid : users) {
    em.addToCollection(group,"users",new SimpleEntityRef(User.ENTITY_TYPE,uuid));
  }
}
