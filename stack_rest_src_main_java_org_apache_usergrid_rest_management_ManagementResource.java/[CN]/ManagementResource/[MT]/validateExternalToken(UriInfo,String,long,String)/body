{
  if (StringUtils.isEmpty(properties.getProperty(USERGRID_CENTRAL_URL))) {
    throw new NotImplementedException("External Token Validation Service is not configured");
  }
  if (extAccessToken == null) {
    throw new IllegalArgumentException("ext_access_token must be specified");
  }
  if (ttl == -1) {
    throw new IllegalArgumentException("ttl must be specified");
  }
  JsonNode accessInfoNode=getMeFromUgCentral(extAccessToken);
  JsonNode userNode=accessInfoNode.get("user");
  String username=userNode.get("username").getTextValue();
  UUID userId=null;
  final OrganizationInfo organizationInfo=management.getOrganizationByName(username);
  if (organizationInfo == null) {
    String name=userNode.get("name").getTextValue();
    String email=userNode.get("email").getTextValue();
    String dummyPassword=RandomStringUtils.randomAlphanumeric(40);
    JsonNode orgsNode=userNode.get("organizations");
    final Iterator<String> fieldNames=orgsNode.getFieldNames();
    UserInfo userInfo=null;
    while (fieldNames.hasNext()) {
      String orgName=fieldNames.next();
      if (userId == null) {
        OrganizationOwnerInfo ownerOrgInfo=management.createOwnerAndOrganization(orgName,username,name,email,dummyPassword,true,true);
        management.activateOrganization(ownerOrgInfo.getOrganization());
        applicationCreator.createSampleFor(ownerOrgInfo.getOrganization());
        userId=ownerOrgInfo.getOwner().getUuid();
        userInfo=ownerOrgInfo.getOwner();
      }
 else {
        final OrganizationInfo organization=management.createOrganization(orgName,userInfo,true);
        management.activateOrganization(organization);
        applicationCreator.createSampleFor(organization);
      }
    }
  }
 else {
    userId=management.getAdminUserByUsername(username).getUuid();
  }
  management.importTokenForAdminUser(userId,extAccessToken,ttl);
  AccessInfo accessInfo=new AccessInfo().withExpiresIn(tokens.getMaxTokenAgeInSeconds(extAccessToken)).withAccessToken(extAccessToken);
  return Response.status(SC_OK).type(jsonMediaType(callback)).entity(accessInfo).build();
}
