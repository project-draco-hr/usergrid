{
  Map<String,String> originalProperties=getRemoteTestProperties();
  try {
    setTestProperty(PROPERTIES_SYSADMIN_APPROVES_ADMIN_USERS,"false");
    setTestProperty(PROPERTIES_SYSADMIN_APPROVES_ORGANIZATIONS,"false");
    setTestProperty(PROPERTIES_ADMIN_USERS_REQUIRE_CONFIRMATION,"false");
    setTestProperty(PROPERTIES_SYSADMIN_EMAIL,"sysadmin-1@mockserver.com");
    final String username="registrationUser" + UUIDGenerator.newTimeUUID();
    final String email=username + "@usergrid.com";
    final String password="password";
    final TestUser user1=new TestAppUser(username,password,email);
    context.withOrg("org" + UUIDGenerator.newTimeUUID()).withApp("app" + UUIDGenerator.newTimeUUID()).withUser(user1).createNewOrgAndUser();
    context.createAppForOrg();
    final UUID owner_uuid=context.getActiveUser().getUuid();
    List<Message> inbox=org.jvnet.mock_javamail.Mailbox.get("test-user-1@mockserver.com");
    assertFalse(inbox.isEmpty());
    Message account_confirmation_message=inbox.get(0);
    assertEquals("User Account Confirmation: " + email,account_confirmation_message.getSubject());
    String token=getTokenFromMessage(account_confirmation_message);
    logger.info(token);
    setup.getMgmtSvc().disableAdminUser(owner_uuid);
    refreshIndex(context.getOrgName(),context.getAppName());
    try {
      resource().path("/management/token").queryParam("grant_type","password").queryParam("username",username).queryParam("password",password).accept(MediaType.APPLICATION_JSON).type(MediaType.APPLICATION_JSON_TYPE).get(String.class);
      fail("request for disabled user should fail");
    }
 catch (    UniformInterfaceException uie) {
      ClientResponse.Status status=uie.getResponse().getClientResponseStatus();
      JsonNode body=mapper.readTree(uie.getResponse().getEntity(String.class));
      assertEquals("user disabled",body.findPath("error_description").textValue());
    }
    setup.getMgmtSvc().deactivateUser(setup.getEmf().getManagementAppId(),owner_uuid);
    try {
      resource().path("/management/token").queryParam("grant_type","password").queryParam("username",username).queryParam("password",password).accept(MediaType.APPLICATION_JSON).type(MediaType.APPLICATION_JSON_TYPE).get(String.class);
      fail("request for deactivated user should fail");
    }
 catch (    UniformInterfaceException uie) {
      ClientResponse.Status status=uie.getResponse().getClientResponseStatus();
      JsonNode body=mapper.readTree(uie.getResponse().getEntity(String.class));
      assertEquals("user not activated",body.findPath("error_description").textValue());
    }
  }
  finally {
    setTestProperties(originalProperties);
  }
}
