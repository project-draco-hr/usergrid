{
  Id orgId=new SimpleId("organization");
  OrganizationScope orgScope=new OrganizationScopeImpl(orgId);
  Id appId=new SimpleId("application");
  CollectionScope appScope=new CollectionScopeImpl(orgId,appId,"test-app");
  EntityManagerFacade em=new EntityManagerFacade(orgScope,appScope,cmf,cif);
  String middleName="middleName" + UUIDUtils.newTimeUUID();
  Map<String,Object> properties=new LinkedHashMap<String,Object>();
  properties.put("username","edanuff");
  properties.put("email","ed@anuff.com");
  properties.put("middlename",middleName);
  Entity user=em.create("user",properties);
  user.setField(new StringField("address1","1782 address st"));
  em.update(user);
  user.setField(new StringField("address2","apt 508"));
  em.update(user);
  user.setField(new StringField("address3","apt 508"));
  em.update(user);
  em.refreshIndex();
  CollectionScope scope=new CollectionScopeImpl(orgScope.getOrganization(),appScope.getOwner(),"user");
  EntityIndex ei=cif.createEntityIndex(orgScope,appScope);
  ei.getEntityVersions(user.getId(),scope);
}
