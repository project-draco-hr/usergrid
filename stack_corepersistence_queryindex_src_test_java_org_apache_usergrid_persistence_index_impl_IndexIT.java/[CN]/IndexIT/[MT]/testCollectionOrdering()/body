{
  LOG.info("testCollectionOrdering");
  Id appId=new SimpleId("application");
  Id orgId=new SimpleId("testCollectionOrdering");
  EntityManagerFacade em=new EntityManagerFacade(orgId,appId,collectionManagerFactory,collectionIndexFactory);
  for (int i=alphabet.length - 1; i >= 0; i--) {
    String name=alphabet[i];
    Map<String,Object> properties=new LinkedHashMap<String,Object>();
    properties.put("name",name);
    em.create("item",properties);
  }
  int i=0;
  Query query=Query.fromQL("order by name");
  Results r=em.searchCollection(em.getApplicationRef(),"items",query);
  for (  Entity entity : r.getEntities()) {
    assertEquals(alphabet[i],entity.getField("name").getValue());
    i++;
  }
  query=Query.fromQL("order by name").withCursor(r.getCursor());
  r=em.searchCollection(em.getApplicationRef(),"items",query);
  for (  Entity entity : r.getEntities()) {
    assertEquals(alphabet[i],entity.getField("name").getValue());
    i++;
  }
  query=Query.fromQL("order by name").withCursor(r.getCursor());
  r=em.searchCollection(em.getApplicationRef(),"items",query);
  for (  Entity entity : r.getEntities()) {
    assertEquals(alphabet[i],entity.getField("name").getValue());
    i++;
  }
  assertEquals(alphabet.length,i);
  i=alphabet.length;
  query=Query.fromQL("order by name desc");
  r=em.searchCollection(em.getApplicationRef(),"items",query);
  for (  Entity entity : r.getEntities()) {
    i--;
    assertEquals(alphabet[i],entity.getField("name").getValue());
  }
  query=Query.fromQL("order by name desc").withCursor(r.getCursor());
  r=em.searchCollection(em.getApplicationRef(),"items",query);
  for (  Entity entity : r.getEntities()) {
    i--;
    assertEquals(alphabet[i],entity.getField("name").getValue());
  }
  query=Query.fromQL("order by name desc").withCursor(r.getCursor());
  r=em.searchCollection(em.getApplicationRef(),"items",query);
  for (  Entity entity : r.getEntities()) {
    i--;
    assertEquals(alphabet[i],entity.getField("name").getValue());
  }
  assertEquals(0,i);
}
