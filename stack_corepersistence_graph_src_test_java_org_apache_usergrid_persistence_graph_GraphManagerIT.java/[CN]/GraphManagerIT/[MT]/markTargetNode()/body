{
  final GraphManager gm=emf.createEdgeManager(scope);
  Id sourceId1=new SimpleId("source");
  Id sourceId2=new SimpleId("source2");
  Id targetId=new SimpleId("target");
  Edge edge1=createEdge(sourceId1,"test",targetId,System.currentTimeMillis());
  gm.writeEdge(edge1).toBlocking().singleOrDefault(null);
  Edge edge2=createEdge(sourceId2,"test",targetId,System.currentTimeMillis());
  gm.writeEdge(edge2).toBlocking().singleOrDefault(null);
  final long maxVersion=System.currentTimeMillis();
  Iterator<Edge> results=gm.loadEdgesToTarget(createSearchByEdge(targetId,edge1.getType(),maxVersion,null)).toBlocking().getIterator();
  assertEquals("Edge found",edge2,results.next());
  assertEquals("Edge found",edge1,results.next());
  assertFalse("No more edges",results.hasNext());
  results=gm.loadEdgesToTargetByType(createSearchByEdgeAndId(targetId,edge1.getType(),maxVersion,sourceId1.getType(),null)).toBlocking().getIterator();
  assertEquals("Edges correct",edge1,results.next());
  assertFalse("No more edges",results.hasNext());
  results=gm.loadEdgesToTargetByType(createSearchByEdgeAndId(targetId,edge2.getType(),maxVersion,sourceId2.getType(),null)).toBlocking().getIterator();
  assertEquals("Edges correct",edge2,results.next());
  assertFalse("No more edges",results.hasNext());
  gm.markNode(targetId,edge2.getTimestamp()).toBlocking().last();
  results=gm.loadEdgesToTarget(createSearchByEdge(targetId,edge1.getType(),maxVersion,null)).toBlocking().getIterator();
  assertFalse("No more edges",results.hasNext());
  results=gm.loadEdgesToTargetByType(createSearchByEdgeAndId(targetId,edge1.getType(),maxVersion,sourceId1.getType(),null)).toBlocking().getIterator();
  assertFalse("No more edges",results.hasNext());
  results=gm.loadEdgesToTargetByType(createSearchByEdgeAndId(targetId,edge2.getType(),maxVersion,sourceId2.getType(),null)).toBlocking().getIterator();
  assertFalse("No more edges",results.hasNext());
  results=gm.loadEdgesToTarget(createSearchByEdgeUnfiltered(targetId,edge1.getType(),maxVersion,null)).toBlocking().getIterator();
  assertEquals("Edge found",edge2,results.next());
  assertEquals("Edge found",edge1,results.next());
  assertFalse("No more edges",results.hasNext());
  results=gm.loadEdgesToTargetByType(createSearchByEdgeAndIdUnfiltered(targetId,edge1.getType(),maxVersion,sourceId1.getType(),null)).toBlocking().getIterator();
  assertEquals("Edges correct",edge1,results.next());
  assertFalse("No more edges",results.hasNext());
  results=gm.loadEdgesToTargetByType(createSearchByEdgeAndIdUnfiltered(targetId,edge2.getType(),maxVersion,sourceId2.getType(),null)).toBlocking().getIterator();
  assertEquals("Edges correct",edge2,results.next());
  assertFalse("No more edges",results.hasNext());
  gm.compactNode(targetId).toBlocking().last();
  results=gm.loadEdgesToTarget(createSearchByEdgeUnfiltered(targetId,edge1.getType(),maxVersion,null)).toBlocking().getIterator();
  assertFalse("No more edges",results.hasNext());
  results=gm.loadEdgesToTargetByType(createSearchByEdgeAndIdUnfiltered(targetId,edge1.getType(),maxVersion,sourceId1.getType(),null)).toBlocking().getIterator();
  assertFalse("No more edges",results.hasNext());
  results=gm.loadEdgesToTargetByType(createSearchByEdgeAndIdUnfiltered(targetId,edge2.getType(),maxVersion,sourceId2.getType(),null)).toBlocking().getIterator();
  assertFalse("No more edges",results.hasNext());
}
