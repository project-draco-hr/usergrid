{
  AdminClient admin=client.admin();
  if (!admin.indices().exists(new IndicesExistsRequest(index)).actionGet().isExists()) {
    admin.indices().prepareCreate(index).execute().actionGet();
  }
  String[] indices=new String[]{index};
  if (!admin.indices().typesExists(new TypesExistsRequest(indices,scope.getName())).actionGet().isExists()) {
    try {
      XContentBuilder mxcb=ElasticSearchUtils.createDoubleStringIndexMapping(jsonBuilder(),scope.getName());
      PutMappingResponse pmr=admin.indices().preparePutMapping(index).setType(scope.getName()).setSource(mxcb).execute().actionGet();
    }
 catch (    IOException ex) {
      throw new RuntimeException("Error adding mapping for type " + scope.getName(),ex);
    }
  }
  Map<String,Object> entityAsMap=EntityUtils.entityToMap(entity);
  IndexResponse ir=client.prepareIndex(index,scope.getName(),entity.getId().toString()).setSource(entityAsMap).setRefresh(true).execute().actionGet();
}
