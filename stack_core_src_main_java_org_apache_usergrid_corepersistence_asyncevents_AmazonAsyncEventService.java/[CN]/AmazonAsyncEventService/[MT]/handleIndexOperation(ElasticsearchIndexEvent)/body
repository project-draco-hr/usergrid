{
  Preconditions.checkNotNull(elasticsearchIndexEvent,"elasticsearchIndexEvent cannot be null");
  final UUID messageId=elasticsearchIndexEvent.getIndexBatchId();
  Preconditions.checkNotNull(messageId,"messageId must not be null");
  final String message=esMapPersistence.getString(messageId.toString());
  String highConsistency=null;
  if (message == null) {
    logger.error("Received message with id {} to process, unable to find it, reading with higher consistency level");
    highConsistency=esMapPersistence.getStringHighConsistency(messageId.toString());
  }
  final IndexOperationMessage indexOperationMessage;
  if (message != null) {
    indexOperationMessage=ObjectJsonSerializer.INSTANCE.fromString(message,IndexOperationMessage.class);
  }
 else   if (highConsistency != null) {
    indexOperationMessage=ObjectJsonSerializer.INSTANCE.fromString(highConsistency,IndexOperationMessage.class);
  }
 else {
    logger.error("Unable to find the ES batch with id {} to process at a higher consistency level");
    throw new RuntimeException("Unable to find the ES batch to process with message id " + messageId);
  }
  indexProducer.put(indexOperationMessage).toBlocking().last();
}
