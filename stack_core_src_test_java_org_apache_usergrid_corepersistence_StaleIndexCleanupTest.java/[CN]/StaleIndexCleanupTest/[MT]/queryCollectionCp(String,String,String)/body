{
  EntityManager em=app.getEntityManager();
  EntityIndexFactory eif=SpringResource.getInstance().getBean(Injector.class).getInstance(EntityIndexFactory.class);
  ApplicationScope as=new ApplicationScopeImpl(new SimpleId(em.getApplicationId(),TYPE_APPLICATION));
  ApplicationEntityIndex ei=eif.createApplicationEntityIndex(as);
  IndexScope is=new IndexScopeImpl(new SimpleId(em.getApplicationId(),TYPE_APPLICATION),CpNamingUtils.getCollectionScopeNameFromCollectionName(collName));
  Query rcq=Query.fromQL(query);
  rcq.setLimit(10000);
  return ei.search(is,SearchTypes.fromTypes(type),rcq);
}
