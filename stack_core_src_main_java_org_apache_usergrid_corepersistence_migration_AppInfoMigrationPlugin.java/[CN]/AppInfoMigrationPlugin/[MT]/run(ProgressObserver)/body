{
  final int version=migrationInfoSerialization.getVersion(getName());
  if (version == getMaxVersion()) {
    logger.debug("Skipping Migration Plugin: " + getName());
    return;
  }
  observer.start();
  final Iterator<org.apache.usergrid.persistence.model.entity.Entity> iterator=getOldAppInfos().toBlocking().getIterator();
  if (iterator.hasNext()) {
    final EntityManager em=emf.getEntityManager(emf.getManagementAppId());
    String currentAppName=null;
    try {
      logger.info("Migrating old appinfos");
      while (iterator.hasNext()) {
        Map oldAppInfo=CpEntityMapUtils.toMap(iterator.next());
        currentAppName=(String)oldAppInfo.get(PROPERTY_NAME);
        migragrateOneAppInfo(em,oldAppInfo,observer);
      }
      migrationInfoSerialization.setVersion(getName(),getMaxVersion());
    }
 catch (    Exception e) {
      String msg="Exception writing application_info for " + currentAppName;
      logger.error(msg,e);
      observer.failed(getMaxVersion(),msg);
    }
  }
 else {
    logger.info("No old appinfos found, no need for migration");
  }
  observer.complete();
}
