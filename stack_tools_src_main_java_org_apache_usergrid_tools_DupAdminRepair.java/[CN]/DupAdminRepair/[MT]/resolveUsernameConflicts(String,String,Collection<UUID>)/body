{
  UserInfo existing=managementService.getAdminUserByUsername(userName);
  if (existing == null) {
    logger.warn("Could not determine an admin for colliding username '{}'.  Skipping",userName);
    return;
  }
  ids.remove(existing.getUuid());
  boolean collision=false;
  EntityManager em=emf.getEntityManager(emf.getManagementAppId());
  for (  UUID id : ids) {
    UserInfo other=managementService.getAdminUserByUuid(id);
    if (other != null && other.getEmail() != null && other.getEmail().equals(existing.getEmail())) {
      logger.info("Users with the same username '{}' have the same email '{}'. This will be resolved later in " + "the process, skipping",userName,existing.getEmail());
      continue;
    }
    collision=true;
    setUserName(em,other,other.getEmail());
  }
  if (collision) {
    setUserName(em,existing,existing.getEmail());
  }
}
