{
  Query query=new Query();
  query.setResultsLevel(level);
  query.setLimit(count);
  final ConnectionRefImpl connectionRef=new ConnectionRefImpl(new SimpleEntityRef(connectedEntityType,null),connectionType,targetEntity);
  final ConnectionResultsLoaderFactory factory=new ConnectionResultsLoaderFactory(connectionRef);
  QueryProcessor qp=new QueryProcessor(em,executorService,query,null,factory);
  ConnectionSearchVisitorFactory collectionSearchVisitorFactory=new ConnectionSearchVisitorFactory(cass,indexBucketLocator,qp,applicationId,headEntity,connectionRef,false,"");
  return qp.getResults(collectionSearchVisitorFactory);
}
