{
  UUID timestampUuid=newTimeUUID();
  Mutator<ByteBuffer> batch=CountingMutator.createFlushingMutator(cass.getApplicationKeyspace(applicationId),Serializers.be);
  batchUpdateEntityConnection(batch,disconnect,connection,timestampUuid);
  ConnectionRefImpl loopback=connection.getConnectionToConnectionEntity();
  if (!disconnect) {
    em.insertEntity(new SimpleEntityRef(CONNECTION_ENTITY_CONNECTION_TYPE,loopback.getConnectedEntityId()));
  }
  batchUpdateEntityConnection(batch,disconnect,loopback,timestampUuid);
  batchExecute(batch,CassandraService.RETRY_COUNT);
}
