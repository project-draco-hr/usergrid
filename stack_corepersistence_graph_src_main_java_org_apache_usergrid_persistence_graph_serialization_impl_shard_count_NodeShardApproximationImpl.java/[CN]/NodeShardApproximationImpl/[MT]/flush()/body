{
  writeLockLock.lock();
  try {
    flushPending=currentCounter;
    currentCounter=new Counter();
  }
  finally {
    writeLockLock.unlock();
  }
  final MutationBatch batch=nodeShardCounterSerialization.flush(flushPending);
  new HystrixCommand(HystrixCassandra.ASYNC_GROUP){
    @Override protected Void run() throws Exception {
      batch.execute();
      return null;
    }
    @Override protected Object getFallback(){
      currentCounter.merge(flushPending);
      return null;
    }
  }
.execute();
  writeLockLock.lock();
  try {
    flushPending=null;
  }
  finally {
    writeLockLock.unlock();
  }
}
