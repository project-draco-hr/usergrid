{
  UUID exportId=(UUID)jobExecution.getJobData().getProperty(EXPORT_ID);
  EntityManager em=emf.getEntityManager(config.getApplicationId());
  Export export=em.get(exportId,Export.class);
  export.setState(Export.State.STARTED);
  em.update(export);
  if (config.getCollection() == null) {
    Map<UUID,String> organizations=getOrgs();
    for (    Map.Entry<UUID,String> organization : organizations.entrySet()) {
      try {
        exportApplicationsForOrg(organization,config,jobExecution);
      }
 catch (      Exception e) {
        export.setState(Export.State.FAILED);
        em.update(export);
        return;
      }
    }
  }
 else {
    try {
      exportApplicationForOrg(config.getOrganizationId(),config,jobExecution);
    }
 catch (    Exception e) {
      export.setState(Export.State.FAILED);
      em.update(export);
      return;
    }
  }
  export.setState(Export.State.FINISHED);
  em.update(export);
}
