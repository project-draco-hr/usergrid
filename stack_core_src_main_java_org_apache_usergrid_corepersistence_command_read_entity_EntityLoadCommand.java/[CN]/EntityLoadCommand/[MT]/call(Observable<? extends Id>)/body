{
  return observable.buffer(resultSize).flatMap(new Func1<List<? extends Id>,Observable<Results>>(){
    @Override public Observable<Results> call(    final List<? extends Id> ids){
      return Observable.from(ids).groupBy(new Func1<Id,String>(){
        @Override public String call(        final Id id){
          return id.getType();
        }
      }
).flatMap(new Func1<GroupedObservable<String,Id>,Observable<EntitySet>>(){
        @Override public Observable<EntitySet> call(        final GroupedObservable<String,Id> stringIdGroupedObservable){
          final String entityType=stringIdGroupedObservable.getKey();
          final CollectionScope collectionScope=getCollectionScopeNameFromEntityType(applicationScope.getApplication(),entityType);
          return stringIdGroupedObservable.toList().flatMap(new Func1<List<Id>,Observable<EntitySet>>(){
            @Override public Observable<EntitySet> call(            final List<Id> ids){
              final EntityCollectionManager ecm=entityCollectionManagerFactory.createCollectionManager(collectionScope);
              return ecm.load(ids);
            }
          }
);
        }
      }
).flatMap(new Func1<EntitySet,Observable<org.apache.usergrid.persistence.Entity>>(){
        @Override public Observable<org.apache.usergrid.persistence.Entity> call(        final EntitySet entitySet){
          return Observable.from(entitySet.getEntities()).map(new Func1<MvccEntity,org.apache.usergrid.persistence.Entity>(){
            @Override public org.apache.usergrid.persistence.Entity call(            final MvccEntity mvccEntity){
              return mapEntity(mvccEntity);
            }
          }
).filter(new Func1<org.apache.usergrid.persistence.Entity,Boolean>(){
            @Override public Boolean call(            final org.apache.usergrid.persistence.Entity entity){
              return entity == null;
            }
          }
);
        }
      }
).toList().map(new Func1<List<org.apache.usergrid.persistence.Entity>,Results>(){
        @Override public Results call(        final List<org.apache.usergrid.persistence.Entity> entities){
          final Results results=Results.fromEntities(entities);
          results.setCursor(generateCursor());
          return results;
        }
      }
);
    }
  }
);
}
