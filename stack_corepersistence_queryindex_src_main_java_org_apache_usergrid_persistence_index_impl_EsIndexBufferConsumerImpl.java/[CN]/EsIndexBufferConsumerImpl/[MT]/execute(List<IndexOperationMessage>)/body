{
  if (operationMessages == null || operationMessages.size() == 0) {
    return;
  }
  Observable.from(operationMessages).flatMap(new Func1<IndexOperationMessage,Observable<BatchRequest>>(){
    @Override public Observable<BatchRequest> call(    final IndexOperationMessage indexOperationMessage){
      final Observable<IndexRequest> index=Observable.from(indexOperationMessage.getIndexRequests());
      final Observable<DeIndexRequest> deIndex=Observable.from(indexOperationMessage.getDeIndexRequests());
      indexSizeCounter.dec(indexOperationMessage.getDeIndexRequests().size());
      indexSizeCounter.dec(indexOperationMessage.getIndexRequests().size());
      return Observable.merge(index,deIndex);
    }
  }
).reduce(initRequest(),new Func2<BulkRequestBuilder,BatchRequest,BulkRequestBuilder>(){
    @Override public BulkRequestBuilder call(    final BulkRequestBuilder bulkRequestBuilder,    final BatchRequest batchRequest){
      batchRequest.doOperation(client,bulkRequestBuilder);
      return bulkRequestBuilder;
    }
  }
).doOnNext(new Action1<BulkRequestBuilder>(){
    @Override public void call(    final BulkRequestBuilder bulkRequestBuilder){
      sendRequest(bulkRequestBuilder);
    }
  }
).toBlocking().lastOrDefault(null);
  Observable.from(operationMessages).doOnNext(new Action1<IndexOperationMessage>(){
    @Override public void call(    IndexOperationMessage operationMessage){
      operationMessage.getFuture().done();
    }
  }
).toBlocking().lastOrDefault(null);
}
