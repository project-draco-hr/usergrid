{
  if (bulkRequest.numberOfActions() == 0) {
    return;
  }
  final BulkResponse responses;
  try {
    responses=bulkRequest.execute().actionGet();
  }
 catch (  Throwable t) {
    log.error("Unable to communicate with elasticsearch");
    failureMonitor.fail("Unable to execute batch",t);
    throw t;
  }
  failureMonitor.success();
  for (  BulkItemResponse response : responses) {
    if (response.isFailed()) {
      final BulkItemResponse.Failure failure=response.getFailure();
      final String message;
      if (failure != null) {
        message="Unable to index documents.  Errors are :" + response.getFailure().getMessage();
      }
 else {
        message="Unable to index documents.  Response is :" + response.getResponse();
      }
      throw new RuntimeException(message);
    }
  }
}
