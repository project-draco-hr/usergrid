{
  Map<String,String> payload=hashMap("foo","bar");
  JsonNode node=mapper.readTree(resource().path("/test-organization/test-app/foos").queryParam("access_token",access_token).accept(MediaType.APPLICATION_JSON).type(MediaType.APPLICATION_JSON_TYPE).post(String.class,payload));
  JsonNode idNode=node.get("entities").get(0).get("uuid");
  String uuid=idNode.textValue();
  assertNotNull(uuid);
  byte[] data=IOUtils.toByteArray(this.getClass().getResourceAsStream("/cassandra_eye.jpg"));
  FormDataMultiPart form=new FormDataMultiPart().field("foo","bar2").field("file",data,MediaType.MULTIPART_FORM_DATA_TYPE);
  long created=System.currentTimeMillis();
  node=mapper.readTree(resource().path("/test-organization/test-app/foos/" + uuid).queryParam("access_token",access_token).accept(MediaType.APPLICATION_JSON).type(MediaType.MULTIPART_FORM_DATA).put(String.class,form));
  node=mapper.readTree(resource().path("/test-organization/test-app/foos/" + uuid).queryParam("access_token",access_token).accept(MediaType.APPLICATION_JSON_TYPE).get(String.class));
  assertEquals("image/jpeg",node.findValue(AssetUtils.CONTENT_TYPE).textValue());
  assertEquals(7979,node.findValue(AssetUtils.CONTENT_LENGTH).intValue());
  idNode=node.get("entities").get(0).get("uuid");
  assertEquals(uuid,idNode.textValue());
  JsonNode nameNode=node.get("entities").get(0).get("foo");
  assertEquals("bar2",nameNode.textValue());
  long lastModified=node.findValue(AssetUtils.LAST_MODIFIED).longValue();
  Assert.assertEquals(created,lastModified,500);
  InputStream is=resource().path("/test-organization/test-app/foos/" + uuid).queryParam("access_token",access_token).accept("image/jpeg").get(InputStream.class);
  byte[] foundData=IOUtils.toByteArray(is);
  assertEquals(7979,foundData.length);
  node=mapper.readTree(resource().path("/test-organization/test-app/foos/" + uuid).queryParam("access_token",access_token).accept(MediaType.APPLICATION_JSON).type(MediaType.MULTIPART_FORM_DATA).put(String.class,form));
  Assert.assertTrue(lastModified != node.findValue(AssetUtils.LAST_MODIFIED).longValue());
}
