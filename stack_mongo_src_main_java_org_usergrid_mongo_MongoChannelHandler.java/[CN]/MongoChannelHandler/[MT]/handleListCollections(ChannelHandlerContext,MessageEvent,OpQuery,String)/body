{
  logger.info("Handling list collections for database " + databaseName + "... ");
  ApplicationInfo application=SubjectUtils.getApplication(Identifier.fromName(databaseName));
  if (application == null) {
    OpReply reply=new OpReply(opQuery);
    return reply;
  }
  EntityManager em=emf.getEntityManager(application.getId());
  OpReply reply=new OpReply(opQuery);
  try {
    Set<String> collections=em.getApplicationCollections();
    for (    String colName : collections) {
      if (Schema.isAssociatedEntityType(colName)) {
        continue;
      }
      reply.addDocument(map("name",databaseName + "." + colName));
      reply.addDocument(map("name",databaseName + "." + colName+ ".$_id_"));
    }
  }
 catch (  Exception ex) {
    logger.error("Unable to retrieve collections",ex);
  }
  return reply;
}
