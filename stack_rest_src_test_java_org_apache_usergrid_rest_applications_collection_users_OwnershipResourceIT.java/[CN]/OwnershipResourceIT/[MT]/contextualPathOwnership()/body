{
  context.clearUser();
  refreshIndex(context.getOrgName(),context.getAppName());
  TestUser user1=new TestAppUser("testuser1@usergrid.org","password","testuser1@usergrid.org").create(context);
  refreshIndex(context.getOrgName(),context.getAppName());
  user1.login(context);
  user1.makeActive(context);
  refreshIndex(context.getOrgName(),context.getAppName());
  context.application().users().user("me").devices().create(MapUtils.hashMap("name","device1").map("number","5551112222"));
  context.clearUser();
  refreshIndex(context.getOrgName(),context.getAppName());
  TestUser user2=new TestAppUser("testuser2@usergrid.org","password","testuser2@usergrid.org").create(context);
  refreshIndex(context.getOrgName(),context.getAppName());
  user2.login(context);
  user2.makeActive(context);
  refreshIndex(context.getOrgName(),context.getAppName());
  context.application().users().user("me").devices().create(MapUtils.hashMap("name","device2").map("number","5552223333"));
  refreshIndex(context.getOrgName(),context.getAppName());
  DevicesCollection devices=context.withUser(user1).application().users().user("me").devices();
  JsonNode data=devices.device("device1").get();
  assertNotNull(data);
  assertEquals("device1",getEntity(data,0).get("name").asText());
  data=devices.device("device2").get();
  assertNull(data);
  data=devices.get();
  assertEquals("device1",getEntity(data,0).get("name").asText());
  assertNull(getEntity(data,1));
  devices=context.withUser(user2).application().users().user("me").devices();
  data=devices.device("device2").get();
  assertNotNull(data);
  assertEquals("device2",getEntity(data,0).get("name").asText());
  data=devices.device("device1").get();
  assertNull(data);
  data=devices.get();
  assertEquals("device2",getEntity(data,0).get("name").asText());
  assertNull(getEntity(data,1));
  devices=context.withUser(user1).application().devices();
  data=devices.device("device1").get();
  assertNotNull(data);
  assertEquals("device1",getEntity(data,0).get("name").asText());
  data=devices.device("device2").get();
  assertNotNull(data);
  assertEquals("device2",getEntity(data,0).get("name").asText());
  data=context.withUser(user2).application().devices().device("device1").get();
  assertNotNull(data);
  assertEquals("device1",getEntity(data,0).get("name").asText());
  data=devices.device("device2").get();
  assertNotNull(data);
  assertEquals("device2",getEntity(data,0).get("name").asText());
}
