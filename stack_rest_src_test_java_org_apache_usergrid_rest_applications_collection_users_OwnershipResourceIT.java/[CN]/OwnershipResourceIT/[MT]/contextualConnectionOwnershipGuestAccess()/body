{
  context.application().customCollection("roles").entity("guest").collection("permissions").create(MapUtils.hashMap("permission","get,put,post,delete:/**"));
  context.clearUser();
  JsonNode city=context.application().customCollection("cities").create(MapUtils.hashMap("name","tempe"));
  refreshIndex(context.getOrgName(),context.getAppName());
  String cityId=getEntity(city,0).get("uuid").asText();
  JsonNode data=context.application().customCollection("cities").entity("tempe").connection("likes").collection("restaurants").create(MapUtils.hashMap("name","4peaks"));
  String peaksId=getEntity(data,0).get("uuid").asText();
  data=context.application().customCollection("cities").entity("tempe").connection("likes").collection("restaurants").create(MapUtils.hashMap("name","arrogantbutcher"));
  String arrogantButcherId=getEntity(data,0).get("uuid").asText();
  Connection likeRestaurants=context.application().customCollection("cities").entity("tempe").connection("likes");
  refreshIndex(context.getOrgName(),context.getAppName());
  data=likeRestaurants.entity(peaksId).get();
  assertNotNull(data);
  assertEquals("4peaks",getEntity(data,0).get("name").asText());
  data=likeRestaurants.entity(arrogantButcherId).get();
  assertEquals("arrogantbutcher",getEntity(data,0).get("name").asText());
  data=likeRestaurants.collection("restaurants").entity(peaksId).get();
  assertNotNull(data);
  assertEquals("4peaks",getEntity(data,0).get("name").asText());
  data=likeRestaurants.collection("restaurants").entity(arrogantButcherId).get();
  assertEquals("arrogantbutcher",getEntity(data,0).get("name").asText());
  data=likeRestaurants.collection("restaurants").entity(peaksId).delete();
  assertNotNull(data);
  assertEquals("4peaks",getEntity(data,0).get("name").asText());
  data=likeRestaurants.collection("restaurants").entity(arrogantButcherId).delete();
  assertNotNull(data);
  assertEquals("arrogantbutcher",getEntity(data,0).get("name").asText());
}
