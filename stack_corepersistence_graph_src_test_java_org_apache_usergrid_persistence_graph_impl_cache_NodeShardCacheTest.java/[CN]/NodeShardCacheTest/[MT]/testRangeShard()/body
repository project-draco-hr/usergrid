{
  final GraphFig graphFig=getFigMock();
  final NodeShardAllocation allocation=mock(NodeShardAllocation.class);
  final Id id=createId("test");
  final String edgeType="edge";
  final String otherIdType="type";
  final UUID min=new UUID(0,1);
  final UUID mid=new UUID(0,100);
  final UUID max=new UUID(0,200);
  NodeShardCache cache=new NodeShardCacheImpl(allocation,graphFig);
  when(allocation.getShards(same(scope),same(id),same(edgeType),same(otherIdType))).thenReturn(Arrays.asList(min,mid,max));
  UUID slice=cache.getSlice(scope,id,new UUID(min.getMostSignificantBits(),min.getLeastSignificantBits()),edgeType,otherIdType);
  assertEquals(min,slice);
  slice=cache.getSlice(scope,id,new UUID(mid.getMostSignificantBits(),mid.getLeastSignificantBits()),edgeType,otherIdType);
  assertEquals(mid,slice);
  slice=cache.getSlice(scope,id,new UUID(max.getMostSignificantBits(),max.getLeastSignificantBits()),edgeType,otherIdType);
  assertEquals(max,slice);
  slice=cache.getSlice(scope,id,new UUID(0,1),edgeType,otherIdType);
  assertEquals(min,slice);
  slice=cache.getSlice(scope,id,new UUID(0,99),edgeType,otherIdType);
  assertEquals(min,slice);
  slice=cache.getSlice(scope,id,new UUID(0,101),edgeType,otherIdType);
  assertEquals(mid,slice);
  slice=cache.getSlice(scope,id,new UUID(0,199),edgeType,otherIdType);
  assertEquals(mid,slice);
  slice=cache.getSlice(scope,id,new UUID(0,201),edgeType,otherIdType);
  assertEquals(max,slice);
  verify(allocation).auditMaxShard(scope,id,edgeType,otherIdType);
}
