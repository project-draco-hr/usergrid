{
  UUID uuid=UUIDUtils.newTimeUUID();
  long timestamp=getTimestampInMillis(uuid);
  if (type == null) {
    type=TOKEN_TYPE_ACCESS;
  }
  TokenInfo tokenInfo=new TokenInfo(uuid,type,timestamp,timestamp,timestamp,principal,state);
  putTokenInfo(tokenInfo);
  return getTokenForUUID(tokenCategory,uuid);
}
