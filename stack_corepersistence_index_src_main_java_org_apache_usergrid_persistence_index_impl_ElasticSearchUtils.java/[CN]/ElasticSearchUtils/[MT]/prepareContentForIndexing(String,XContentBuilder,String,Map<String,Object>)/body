{
  if (name != null) {
    builder=builder.startObject(name);
  }
 else {
    builder=builder.startObject();
  }
  for (  String key : data.keySet()) {
    Object value=data.get(key);
    logger.info("value class = " + value.getClass().getName());
    try {
      if (value instanceof Map) {
        builder=prepareContentForIndexing(key,builder,type,(Map<String,Object>)data.get(key));
      }
 else       if (value instanceof List) {
        builder=prepareContentForIndexing(key,builder,type,(List)value);
      }
 else       if (value instanceof String) {
        builder=builder.field(key + "_ug_analyzed",value).field(key,value);
      }
 else {
        builder=builder.field(key,value);
      }
    }
 catch (    Exception e) {
      logger.error("Error processing {} : {}",key,value,e);
      throw new RuntimeException(e);
    }
  }
  builder=builder.endObject();
  return builder;
}
