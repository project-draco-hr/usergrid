{
  final SearchHits searchHits=searchResponse.getHits();
  final SearchHit[] hits=searchHits.getHits();
  final int length=hits.length;
  logger.debug("   Hit count: {} Total hits: {}",length,searchHits.getTotalHits());
  List<CandidateResult> candidates=new ArrayList<>(length);
  for (  SearchHit hit : hits) {
    final CandidateResult candidateResult=parseIndexDocId(hit.getId());
    candidates.add(candidateResult);
  }
  final String esScrollCursor=searchResponse.getScrollId();
  final CandidateResults candidateResults=new CandidateResults(candidates,query.getSelectFieldMappings(),esScrollCursor);
  if (esScrollCursor != null && length >= limit) {
    final String cursor=candidateResults.initializeCursor();
    final int minutes=indexFig.getQueryCursorTimeout();
    final int storageSeconds=(int)TimeUnit.MINUTES.toSeconds(minutes);
    final QueryState state=new QueryState(query.getOriginalQuery(),limit,esScrollCursor);
    final String queryStateSerialized=state.serialize();
    mapManager.putString(cursor,queryStateSerialized,storageSeconds);
    logger.debug(" User cursor = {},  Cursor = {} ",cursor,esScrollCursor);
  }
  return candidateResults;
}
