{
  Preconditions.checkNotNull(cursor,"cursor is a required argument");
  SearchResponse searchResponse;
  String userCursorString=cursor;
  if (userCursorString.startsWith("\"")) {
    userCursorString=userCursorString.substring(1);
  }
  if (userCursorString.endsWith("\"")) {
    userCursorString=userCursorString.substring(0,userCursorString.length() - 1);
  }
  final String queryStateString=mapManager.getString(userCursorString);
  if (queryStateString == null) {
    throw new QueryException(String.format("Could not find a cursor for the value '%s' ",userCursorString));
  }
  final QueryState queryState=QueryState.fromSerialized(queryStateString);
  final ParsedQuery parsedQuery=ParsedQueryBuilder.build(queryState.ql);
  logger.debug("Executing query with cursor: {} ",queryState.esCursor);
  SearchScrollRequestBuilder ssrb=esProvider.getClient().prepareSearchScroll(queryState.esCursor).setScroll(cursorTimeout + "m");
  try {
    Timer.Context timeSearchCursor=cursorTimer.time();
    searchResponse=ssrb.execute().actionGet();
    timeSearchCursor.stop();
  }
 catch (  Throwable t) {
    logger.error("Unable to communicate with elasticsearch",t);
    failureMonitor.fail("Unable to execute batch",t);
    throw t;
  }
  failureMonitor.success();
  return parseResults(searchResponse,parsedQuery,queryState.limit);
}
