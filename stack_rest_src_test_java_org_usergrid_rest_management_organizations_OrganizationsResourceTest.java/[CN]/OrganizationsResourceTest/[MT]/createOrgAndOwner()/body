{
  properties.setProperty(PROPERTIES_SYSADMIN_APPROVES_ADMIN_USERS,"false");
  properties.setProperty(PROPERTIES_SYSADMIN_APPROVES_ORGANIZATIONS,"false");
  properties.setProperty(PROPERTIES_ADMIN_USERS_REQUIRE_CONFIRMATION,"false");
  properties.setProperty(PROPERTIES_SYSADMIN_EMAIL,"sysadmin-1@mockserver.com");
  Map<String,Object> organizationProperties=new HashMap<String,Object>();
  organizationProperties.put("securityLevel",5);
  Map payload=hashMap("email","test-user-1@mockserver.com").map("username","test-user-1").map("name","Test User").map("password","password").map("organization","test-org-1").map("company","Apigee");
  payload.put(OrganizationsResource.ORGANIZATION_PROPERTIES,organizationProperties);
  JsonNode node=resource().path("/management/organizations").accept(MediaType.APPLICATION_JSON).type(MediaType.APPLICATION_JSON_TYPE).post(JsonNode.class,payload);
  assertNotNull(node);
  ApplicationInfo applicationInfo=managementService.getApplicationInfo("test-org-1/sandbox");
  assertNotNull(applicationInfo);
  Set<String> rolePerms=setup.getEmf().getEntityManager(applicationInfo.getId()).getRolePermissions("guest");
  assertNotNull(rolePerms);
  assertTrue(rolePerms.contains("get,post,put,delete:/**"));
  logNode(node);
  UserInfo ui=managementService.getAdminUserByEmail("test-user-1@mockserver.com");
  EntityManager em=setup.getEmf().getEntityManager(CassandraService.MANAGEMENT_APPLICATION_ID);
  User user=em.get(ui.getUuid(),User.class);
  assertEquals("Test User",user.getName());
  assertEquals("Apigee",(String)user.getProperty("company"));
  OrganizationInfo orgInfo=managementService.getOrganizationByName("test-org-1");
  assertEquals(5L,orgInfo.getProperties().get("securityLevel"));
  node=resource().path("/management/organizations/test-org-1").queryParam("access_token",superAdminToken()).accept(MediaType.APPLICATION_JSON).type(MediaType.APPLICATION_JSON_TYPE).get(JsonNode.class);
  logNode(node);
  Assert.assertEquals(5,node.get("organization").get(OrganizationsResource.ORGANIZATION_PROPERTIES).get("securityLevel").asInt());
  node=resource().path("/management/organizations/test-org-1").queryParam("access_token",superAdminToken()).accept(MediaType.APPLICATION_JSON).type(MediaType.APPLICATION_JSON_TYPE).get(JsonNode.class);
  Assert.assertEquals(5,node.get("organization").get(OrganizationsResource.ORGANIZATION_PROPERTIES).get("securityLevel").asInt());
}
