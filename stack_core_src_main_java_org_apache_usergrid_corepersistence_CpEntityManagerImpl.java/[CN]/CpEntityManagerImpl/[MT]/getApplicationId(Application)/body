{
  Id defaultOrgId=new SimpleId("zzz_default_zzz");
  Id defaultAppId=new SimpleId("zzz_default_zzz");
  CollectionScope defaultScope=new CollectionScopeImpl(defaultOrgId,defaultAppId,"organizations");
  EntityCollectionManager ecm=getManager(defaultScope);
  EntityCollectionIndex eci=getIndex(defaultScope);
  String orgName=(app == null) ? "zzz_default_zzz" : app.getOrganizationName();
  org.apache.usergrid.persistence.index.query.Query q=org.apache.usergrid.persistence.index.query.Query.fromQL("name = '" + orgName + "'");
  org.apache.usergrid.persistence.index.query.Results execute=eci.execute(q);
  if (execute.isEmpty()) {
    org.apache.usergrid.persistence.model.entity.Entity entity=new org.apache.usergrid.persistence.model.entity.Entity(new SimpleId(UUIDGenerator.newTimeUUID(),"organization"));
    entity.setField(new StringField("name",orgName));
    entity=ecm.write(entity).toBlockingObservable().last();
    Id orgId=entity.getId();
    return orgId;
  }
  org.apache.usergrid.persistence.model.entity.Entity entity=execute.getEntities().get(0);
  Id orgId=entity.getId();
  return orgId;
}
