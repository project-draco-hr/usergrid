{
  final CollectionScope collectionScope=mock(CollectionScope.class);
  final Entity entity=generateEntity();
  final MvccEntity mvccEntity=fromEntity(entity);
  WriteOptimisticVerify newStage=new WriteOptimisticVerify(null,logEntryStrat);
  CollectionIoEvent<MvccEntity> result=newStage.call(new CollectionIoEvent<MvccEntity>(collectionScope,mvccEntity));
  assertSame("Context was correct",collectionScope,result.getEntityCollection());
  MvccEntity entry=result.getEvent();
  assertSame("id correct",entity.getId(),entry.getId());
  assertSame("version did not not match entityId",entity.getVersion(),entry.getVersion());
  assertSame("Entity correct",entity,entry.getEntity().get());
}
