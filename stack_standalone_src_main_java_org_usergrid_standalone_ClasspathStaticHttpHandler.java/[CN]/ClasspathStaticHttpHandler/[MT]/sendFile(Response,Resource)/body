{
  final String path=file.getFilename();
  final InputStream fis=file.getInputStream();
  try {
    response.setStatus(HttpStatus.OK_200);
    String substr;
    int dot=path.lastIndexOf('.');
    if (dot < 0) {
      substr=file.toString();
      dot=substr.lastIndexOf('.');
    }
 else {
      substr=path;
    }
    if (dot > 0) {
      String ext=substr.substring(dot + 1);
      String ct=MimeType.get(ext);
      if (ct != null) {
        response.setContentType(ct);
      }
    }
 else {
      response.setContentType(MimeType.get("html"));
    }
    final long length=file.contentLength();
    response.setContentLengthLong(length);
    final OutputBuffer outputBuffer=response.getOutputBuffer();
    byte b[]=new byte[8192];
    int rd;
    while ((rd=fis.read(b)) > 0) {
      outputBuffer.write(b,0,rd);
    }
  }
  finally {
    try {
      fis.close();
    }
 catch (    IOException ignore) {
    }
  }
}
