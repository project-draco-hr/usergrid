{
  LOG.info("EntityDaoTest.testCreateAndDelete");
  UUID applicationId=setup.createApplication("testOrganization","testCreateAndList" + RandomStringUtils.randomAlphabetic(20));
  EntityManager em=setup.getEmf().getEntityManager(applicationId);
  String name="test.thing" + UUIDUtils.newTimeUUID() + 1;
  Map<String,Object> properties=new LinkedHashMap<String,Object>();
  properties.put("name",name);
  properties.put("foo","bar");
  LOG.info("Starting entity create");
  Entity thing1=em.create("thing",properties);
  LOG.info("Entity created");
  String name2="test.thing" + UUIDUtils.newTimeUUID() + 2;
  properties=new LinkedHashMap<String,Object>();
  properties.put("name",name2);
  properties.put("foo","bar");
  LOG.info("Starting entity create");
  Entity thing2=em.create("thing",properties);
  LOG.info("Entity created");
  EntityRef appRef=em.get(new SimpleEntityRef("application",applicationId));
  em.refreshIndex();
  Results r=em.getCollection(appRef,"things",null,10,Level.ALL_PROPERTIES,false);
  assertEquals(2,r.size());
  assertEquals(thing1.getUuid(),r.getEntities().get(0).getUuid());
  assertEquals(thing2.getUuid(),r.getEntities().get(1).getUuid());
}
