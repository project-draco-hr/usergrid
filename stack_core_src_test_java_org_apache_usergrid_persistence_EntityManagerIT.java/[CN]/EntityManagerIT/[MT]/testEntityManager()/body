{
  LOG.info("EntityManagerIT.testEntityManagerTest");
  EntityManager em=app.getEntityManager();
  assertNotNull(em);
  final UUID applicationId=app.getId();
  Map<String,Object> properties=new LinkedHashMap<String,Object>();
  properties.put("username","edanuff");
  properties.put("email","ed@anuff.com");
  Entity user=em.create("user",properties);
  assertNotNull(user);
  user=em.get(user);
  assertNotNull(user);
  assertEquals("user.username not expected value","edanuff",user.getProperty("username"));
  assertEquals("user.email not expected value","ed@anuff.com",user.getProperty("email"));
  app.refreshIndex();
  EntityRef userRef=em.getAlias(new SimpleEntityRef("application",applicationId),"users","edanuff");
  assertNotNull(userRef);
  assertEquals("userRef.id not expected value",user.getUuid(),userRef.getUuid());
  assertEquals("userRef.type not expected value","user",userRef.getType());
  LOG.info("user.username: " + user.getProperty("username"));
  LOG.info("user.email: " + user.getProperty("email"));
  final Query query=Query.fromQL("username = 'edanuff'");
  Results results=em.searchCollection(em.getApplicationRef(),"users",query);
  assertNotNull(results);
  assertEquals(1,results.size());
  user=results.getEntity();
  assertNotNull(user);
  assertEquals("user.username not expected value","edanuff",user.getProperty("username"));
  assertEquals("user.email not expected value","ed@anuff.com",user.getProperty("email"));
  LOG.info("user.username: " + user.getProperty("username"));
  LOG.info("user.email: " + user.getProperty("email"));
  final Query emailQuery=Query.fromQL("email = 'ed@anuff.com'");
  results=em.searchCollection(em.getApplicationRef(),"users",emailQuery);
  assertNotNull(results);
  assertEquals(1,results.size());
  user=results.getEntity();
  assertNotNull(user);
  assertEquals("user.username not expected value","edanuff",user.getProperty("username"));
  assertEquals("user.email not expected value","ed@anuff.com",user.getProperty("email"));
  LOG.info("user.username: " + user.getProperty("username"));
  LOG.info("user.email: " + user.getProperty("email"));
}
