{
  if (contextHolder != null) {
    return;
  }
  contextHolder=new ContextHolder();
  loadSpringContext();
  deleteRecursive(new File("tmp/saved_caches"));
  deleteRecursive(new File("tmp/data"));
  deleteRecursive(new File("tmp/commitlog"));
  System.setProperty("cassandra-foreground","true");
  System.setProperty("log4j.defaultInitOverride","true");
  System.setProperty("log4j.configuration","log4j.properties");
  System.setProperty("cassandra.ring_delay_ms","100");
  executor.execute(new Runnable(){
    public void run(){
      contextHolder.cassandraDaemon=new CassandraDaemon();
      contextHolder.cassandraDaemon.activate();
    }
  }
);
  try {
    TimeUnit.SECONDS.sleep(3);
  }
 catch (  InterruptedException e) {
    throw new AssertionError(e);
  }
  Runtime.getRuntime().addShutdownHook(new Thread(){
    @Override public void run(){
      try {
        logger.error("In shutdownHook");
        stopCassandra();
      }
 catch (      Exception ex) {
        ex.printStackTrace();
      }
    }
  }
);
}
