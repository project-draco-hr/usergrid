{
  Map<String,String> originalProperties=getRemoteTestProperties();
  try {
    setTestProperty(PROPERTIES_SYSADMIN_APPROVES_ADMIN_USERS,"false");
    setTestProperty(PROPERTIES_SYSADMIN_APPROVES_ORGANIZATIONS,"false");
    setTestProperty(PROPERTIES_ADMIN_USERS_REQUIRE_CONFIRMATION,"true");
    assertTrue(setup.getMgmtSvc().newAdminUsersRequireConfirmation());
    assertFalse(setup.getMgmtSvc().newAdminUsersNeedSysAdminApproval());
    String testUserUsername=(String)setup.getMgmtSvc().getProperties().get(AccountCreationProps.PROPERTIES_TEST_ACCOUNT_ADMIN_USER_EMAIL);
    String testUserPassword=(String)setup.getMgmtSvc().getProperties().get(AccountCreationProps.PROPERTIES_TEST_ACCOUNT_ADMIN_USER_PASSWORD);
    JsonNode node;
    try {
      node=mapper.readTree(resource().path("/management/token").queryParam("grant_type","password").queryParam("username",testUserUsername).queryParam("password",testUserPassword).accept(MediaType.APPLICATION_JSON).get(String.class));
    }
 catch (    UniformInterfaceException e) {
      fail("Test User should need no confirmation");
    }
  }
  finally {
    setTestProperties(originalProperties);
  }
}
