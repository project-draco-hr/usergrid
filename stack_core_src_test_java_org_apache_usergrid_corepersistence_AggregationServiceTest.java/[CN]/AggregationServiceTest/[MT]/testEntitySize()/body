{
  ApplicationScope applicationScope=CpNamingUtils.getApplicationScope(this.app.getId());
  Injector injector=SpringResource.getInstance().getBean(Injector.class);
  AggregationServiceFactory factory=injector.getInstance(AggregationServiceFactory.class);
  AggregationService aggregationService=factory.getAggregationService();
  Map<String,Object> props=new HashMap<>();
  props.put("test",1234);
  props.put("name","myname");
  Entity entity1=this.app.getEntityManager().create("test",props);
  Entity entity2=this.app.getEntityManager().create("test2",props);
  this.app.refreshIndex();
  Thread.sleep(500);
  long sum=aggregationService.sumAllCollections(applicationScope);
  Assert.assertTrue(sum >= 0);
  Assert.assertEquals(sum,entity1.getSize() + entity2.getSize());
  long sum1=aggregationService.sum(applicationScope,CpNamingUtils.createCollectionSearchEdge(applicationScope.getApplication(),"test"));
  Assert.assertEquals(sum1,entity1.getSize());
  long sum2=aggregationService.sum(applicationScope,CpNamingUtils.createCollectionSearchEdge(applicationScope.getApplication(),"test2"));
  Assert.assertEquals(sum2,entity2.getSize());
}
