{
  EntityManager em=emf.getEntityManager(MANAGEMENT_APPLICATION_ID);
  Group organizationEntity=new Group();
  organizationEntity.setPath("tst-counter");
  organizationEntity.setProperty("name","test counter");
  organizationEntity=em.create(organizationEntity);
  UUID applicationId=emf.createApplication("testEntityCounters");
  Map<String,Object> properties=new LinkedHashMap<String,Object>();
  properties.put("name","testEntityCounters");
  Entity applicationEntity=em.create(applicationId,"application_info",properties);
  em.createConnection(new SimpleEntityRef("group",organizationEntity.getUuid()),"owns",new SimpleEntityRef("application_info",applicationId));
  Event event=new Event();
  event.setTimestamp(System.currentTimeMillis());
  event.addCounter("admin_logins",1);
  event.setGroup(organizationEntity.getUuid());
  em.create(event);
  event=new Event();
  event.setTimestamp(System.currentTimeMillis());
  event.addCounter("admin_logins",1);
  em.create(event);
  Map<String,Long> counts=em.getApplicationCounters();
  logger.info(JsonUtils.mapToJsonString(counts));
  assertNotNull(counts.get("admin_logins"));
  assertEquals(2,counts.get("admin_logins").longValue());
  Results r=em.getAggregateCounters(null,null,null,"admin_logins",CounterResolution.ALL,ts,System.currentTimeMillis(),false);
  logger.info(JsonUtils.mapToJsonString(r.getCounters()));
  assertEquals(1,r.getCounters().get(0).getValues().get(0).getValue());
  Query query=new Query();
  query.addCounterFilter("admin_logins:*:*:*");
  query.setStartTime(ts);
  query.setFinishTime(System.currentTimeMillis());
  query.setResolution(CounterResolution.SIX_HOUR);
  r=em.getAggregateCounters(query);
  logger.info(JsonUtils.mapToJsonString(r.getCounters()));
  assertEquals(1,r.getCounters().get(0).getValues().get(0).getValue());
}
