{
  String orgName=clientSetup.getOrganizationName().toLowerCase();
  String appName=clientSetup.getAppName().toLowerCase();
  String username="username";
  String name="name";
  User user=new User(username,name,username + "@usergrid.org","password");
  Entity entity=this.app().collection("users").post(user);
  assertNotNull(entity);
  ApiResponse apiResponse=resource().path(String.format("/%s/%s/token",orgName,appName)).queryParam("grant_type","password").queryParam("username",username).queryParam("password","password").accept(MediaType.APPLICATION_JSON).type(MediaType.APPLICATION_JSON_TYPE).get(ApiResponse.class);
  long startTime=System.currentTimeMillis();
  String token=apiResponse.getAccessToken();
  assertNotNull(token);
  long expires_in=Long.parseLong(apiResponse.getProperties().get("expires_in").toString());
  assertEquals(604800,expires_in);
  entity=this.app().collection("users").entity(entity).get(new QueryParameters().addParam("access_token",token),false);
  assertEquals(username + "@usergrid.org",(String)entity.get("email"));
  apiResponse=resource().path(String.format("/%s/%s",orgName,appName)).queryParam("access_token",this.getAdminToken().getAccessToken()).accept(MediaType.APPLICATION_JSON).type(MediaType.APPLICATION_JSON_TYPE).put(ApiResponse.class,new MapUtils.HashMapBuilder<String,String>().map("accesstokenttl","31536000000"));
  apiResponse=resource().path(String.format("/%s/%s/token",orgName,appName)).queryParam("grant_type","password").queryParam("username",username).queryParam("password","password").accept(MediaType.APPLICATION_JSON).type(MediaType.APPLICATION_JSON_TYPE).get(ApiResponse.class);
  assertEquals(31536000,Long.parseLong(apiResponse.getProperties().get("expires_in").toString()));
}
