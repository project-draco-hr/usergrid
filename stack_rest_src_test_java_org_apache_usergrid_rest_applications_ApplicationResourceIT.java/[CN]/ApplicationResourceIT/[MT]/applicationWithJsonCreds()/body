{
  ApplicationInfo appInfo=setup.getMgmtSvc().getApplicationInfo("test-organization/test-app");
  String clientId=setup.getMgmtSvc().getClientIdForApplication(appInfo.getId());
  String clientSecret=setup.getMgmtSvc().getClientSecretForApplication(appInfo.getId());
  Map<String,String> payload=hashMap("email","applicationWithJsonCreds@usergrid.org").map("username","applicationWithJsonCreds").map("name","applicationWithJsonCreds").map("password","applicationWithJsonCreds").map("pin","1234");
  JsonNode node=mapper.readTree(resource().path("/test-organization/test-app/users").queryParam("client_id",clientId).queryParam("client_secret",clientSecret).accept(MediaType.APPLICATION_JSON).type(MediaType.APPLICATION_JSON_TYPE).post(String.class,payload));
  assertNotNull(getEntity(node,0));
  payload=hashMap("username","applicationWithJsonCreds").map("password","applicationWithJsonCreds").map("grant_type","password");
  node=mapper.readTree(resource().path("/test-organization/test-app/token").accept(MediaType.APPLICATION_JSON).type(MediaType.APPLICATION_JSON_TYPE).post(String.class,payload));
  JsonNode token=node.get("access_token");
  assertNotNull(token);
}
