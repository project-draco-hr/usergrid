{
  final Id sourceId=createId("source");
  final String edgeType="test";
  final Id targetId=createId("target");
  final long timestamp=1000l;
  MarkedEdge edgeV1=createEdge(sourceId,edgeType,targetId,timestamp);
  MarkedEdge edgeV2=createEdge(sourceId,edgeType,targetId,timestamp + 1);
  MarkedEdge edgeV3=createEdge(sourceId,edgeType,targetId,timestamp + 2);
  commitLogEdgeSerialization.writeEdge(scope,edgeV1,UUIDGenerator.newTimeUUID()).execute();
  commitLogEdgeSerialization.writeEdge(scope,edgeV2,UUIDGenerator.newTimeUUID()).execute();
  commitLogEdgeSerialization.writeEdge(scope,edgeV3,UUIDGenerator.newTimeUUID()).execute();
  int returned=edgeWriteCompact.compact(scope,edgeV3,UUIDGenerator.newTimeUUID()).toBlockingObservable().single();
  assertEquals(3,returned);
  long now=System.currentTimeMillis();
  Iterator<MarkedEdge> edges=commitLogEdgeSerialization.getEdgeVersions(scope,createGetByEdge(sourceId,edgeType,targetId,now,null));
  assertFalse("No edges exist",edges.hasNext());
  edges=commitLogEdgeSerialization.getEdgesFromSource(scope,createSearchByEdge(sourceId,edgeType,now,null));
  assertFalse("No edges exist",edges.hasNext());
  edges=commitLogEdgeSerialization.getEdgesFromSourceByTargetType(scope,createSearchByEdgeAndId(sourceId,edgeType,now,targetId.getType(),null));
  assertFalse("No edges exist",edges.hasNext());
  edges=commitLogEdgeSerialization.getEdgesToTarget(scope,createSearchByEdge(targetId,edgeType,now,null));
  assertFalse("No edges exist",edges.hasNext());
  edges=commitLogEdgeSerialization.getEdgesToTargetBySourceType(scope,createSearchByEdgeAndId(targetId,edgeType,now,sourceId.getType(),null));
  assertFalse("No edges exist",edges.hasNext());
  edges=storageEdgeSerialization.getEdgeVersions(scope,createGetByEdge(sourceId,edgeType,targetId,now,null));
  assertEquals(edgeV3,edges.next());
  assertEquals(edgeV2,edges.next());
  assertEquals(edgeV1,edges.next());
  assertFalse(edges.hasNext());
  edges=storageEdgeSerialization.getEdgesFromSource(scope,createSearchByEdge(sourceId,edgeType,now,null));
  assertEquals(edgeV3,edges.next());
  assertEquals(edgeV2,edges.next());
  assertEquals(edgeV1,edges.next());
  assertFalse(edges.hasNext());
  edges=storageEdgeSerialization.getEdgesFromSourceByTargetType(scope,createSearchByEdgeAndId(sourceId,edgeType,now,targetId.getType(),null));
  assertEquals(edgeV3,edges.next());
  assertEquals(edgeV2,edges.next());
  assertEquals(edgeV1,edges.next());
  assertFalse(edges.hasNext());
  edges=storageEdgeSerialization.getEdgesToTarget(scope,createSearchByEdge(targetId,edgeType,now,null));
  assertEquals(edgeV3,edges.next());
  assertEquals(edgeV2,edges.next());
  assertEquals(edgeV1,edges.next());
  assertFalse(edges.hasNext());
  edges=storageEdgeSerialization.getEdgesToTargetBySourceType(scope,createSearchByEdgeAndId(targetId,edgeType,now,sourceId.getType(),null));
  assertEquals(edgeV3,edges.next());
  assertEquals(edgeV2,edges.next());
  assertEquals(edgeV1,edges.next());
  assertFalse(edges.hasNext());
}
