{
  invocationCounter.inc();
  final TimerContext context=addTimer.time();
  batch.add(count);
  if (shouldSubmit(batch)) {
synchronized (batch) {
      if (submit.compareAndSet(false,true)) {
        Batch copy=batch;
        batch=new Batch();
        submit(copy);
        submit.set(false);
      }
    }
  }
  context.stop();
}
