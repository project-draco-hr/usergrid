{
  invocationCounter.inc();
  final TimerContext context=addTimer.time();
  batch.add(count);
  if (shouldSubmit(batch) && submitLock.tryLock()) {
    try {
      Batch copy=batch;
      batch=new Batch();
      submit(copy);
    }
  finally {
      submitLock.unlock();
    }
  }
  context.stop();
}
