{
  this.token=token;
  if ((password1 != null) || (password2 != null)) {
    if (management.checkPasswordResetTokenForAppUser(getApplicationId(),getUser().getUuid(),token)) {
      if ((password1 != null) && password1.equals(password2)) {
        management.setAppUserPassword(getApplicationId(),getUser().getUuid(),password1);
        return new Viewable("resetpw_set_success",this);
      }
 else {
        errorMsg="Passwords didn't match, let's try again...";
        return new Viewable("resetpw_set_form",this);
      }
    }
 else {
      errorMsg="Something odd happened, let's try again...";
      return new Viewable("resetpw_email_form",this);
    }
  }
  ReCaptchaImpl reCaptcha=new ReCaptchaImpl();
  reCaptcha.setPrivateKey(properties.getProperty("usergrid.recaptcha.private"));
  ReCaptchaResponse reCaptchaResponse=reCaptcha.checkAnswer(httpServletRequest.getRemoteAddr(),challenge,uresponse);
  if (reCaptchaResponse.isValid()) {
    management.sendAppUserPasswordReminderEmail(getApplicationId(),user);
    return new Viewable("resetpw_email_success",this);
  }
 else {
    errorMsg="Incorrect Captcha";
    return new Viewable("resetpw_email_form",this);
  }
}
