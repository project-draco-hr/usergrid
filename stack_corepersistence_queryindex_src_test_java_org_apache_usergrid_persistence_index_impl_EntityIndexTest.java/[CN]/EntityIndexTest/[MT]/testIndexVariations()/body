{
  Id appId=new SimpleId("application");
  ApplicationScope applicationScope=new ApplicationScopeImpl(appId);
  EntityIndex entityIndex=eif.createEntityIndex(applicationScope);
  entityIndex.initializeIndex();
  final String entityType="thing";
  IndexScope indexScope=new IndexScopeImpl(appId,"things");
  final SearchTypes searchTypes=SearchTypes.fromTypes(entityType);
  EntityIndexBatch batch=entityIndex.createBatch();
  Entity entity=new Entity(entityType);
  EntityUtils.setVersion(entity,UUIDGenerator.newTimeUUID());
  entity.setField(new UUIDField(IndexingUtils.ENTITYID_ID_FIELDNAME,UUID.randomUUID()));
  entity.setField(new StringField("testfield","test"));
  batch.index(indexScope,entity);
  batch.execute().get();
  EntityUtils.setVersion(entity,UUIDGenerator.newTimeUUID());
  List<String> list=new ArrayList<>();
  list.add("test");
  entity.setField(new ArrayField<String>("testfield",list));
  batch.index(indexScope,entity);
  batch.execute().get();
  EntityUtils.setVersion(entity,UUIDGenerator.newTimeUUID());
  EntityObject testObj=new EntityObject();
  testObj.setField(new StringField("test","testFiedl"));
  entity.setField(new EntityObjectField("testfield",testObj));
  batch.index(indexScope,entity);
  batch.execute().get();
  entityIndex.refresh();
  testQueries(indexScope,searchTypes,entityIndex);
}
