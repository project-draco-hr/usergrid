{
  Id appId=new SimpleId("application");
  ApplicationScope applicationScope=new ApplicationScopeImpl(appId);
  ApplicationEntityIndex entityIndex=eif.createApplicationEntityIndex(applicationScope);
  final String entityType="thing";
  IndexScope indexScope=new IndexScopeImpl(appId,"things");
  final SearchTypes searchTypes=SearchTypes.fromTypes(entityType);
  insertJsonBlob(entityIndex,entityType,indexScope,"/sample-large.json",1,0);
  ei.refresh();
  ei.addIndex("v2",1,0,"one");
  insertJsonBlob(entityIndex,entityType,indexScope,"/sample-large.json",1,0);
  ei.refresh();
  CandidateResults crs=testQuery(indexScope,searchTypes,entityIndex,"name = 'Bowers Oneil'",2);
  EntityIndexBatch entityIndexBatch=entityIndex.createBatch();
  entityIndexBatch.deindex(indexScope,crs.get(0));
  entityIndexBatch.deindex(indexScope,crs.get(1));
  entityIndexBatch.execute().get();
  ei.refresh();
  testQuery(indexScope,searchTypes,entityIndex,"name = 'Bowers Oneil'",0);
}
