{
  Id appId=new SimpleId("application");
  Id ownerId=new SimpleId("owner");
  ApplicationScope applicationScope=new ApplicationScopeImpl(appId);
  ApplicationEntityIndex entityIndex=eif.createApplicationEntityIndex(applicationScope);
  final Entity first=new Entity("search");
  first.setField(new StringField("string","alpha long string"));
  EntityUtils.setVersion(first,UUIDGenerator.newTimeUUID());
  final Entity second=new Entity("search");
  second.setField(new StringField("string","bravo long string"));
  EntityUtils.setVersion(second,UUIDGenerator.newTimeUUID());
  EntityIndexBatch batch=entityIndex.createBatch();
  IndexEdge indexScope1=new IndexEdgeImpl(ownerId,"searches",SearchEdge.NodeType.SOURCE,10);
  batch.index(indexScope1,first);
  IndexEdge indexScope2=new IndexEdgeImpl(ownerId,"searches",SearchEdge.NodeType.SOURCE,11);
  batch.index(indexScope2,second);
  batch.execute().toBlocking().last();
  ei.refreshAsync().toBlocking().first();
  final String singleMatchQuery="string contains 'alpha' OR string contains 'foo'";
  final CandidateResults singleResults=entityIndex.search(indexScope1,SearchTypes.fromTypes(first.getId().getType()),singleMatchQuery,10,0);
  assertEquals(1,singleResults.size());
  assertEquals(first.getId(),singleResults.get(0).getId());
  final String bothKeywordsMatch="string contains 'alpha' OR string contains 'bravo'";
  final CandidateResults singleKeywordUnion=entityIndex.search(indexScope1,SearchTypes.fromTypes(first.getId().getType()),bothKeywordsMatch,10,0);
  assertEquals(2,singleKeywordUnion.size());
  assertEquals(second.getId(),singleKeywordUnion.get(0).getId());
  assertEquals(first.getId(),singleKeywordUnion.get(1).getId());
  final String twoKeywordMatches="string contains 'alpha' OR string contains 'long'";
  final CandidateResults towMatchResults=entityIndex.search(indexScope1,SearchTypes.fromTypes(first.getId().getType()),twoKeywordMatches,10,0);
  assertEquals(2,towMatchResults.size());
  assertEquals(second.getId(),towMatchResults.get(0).getId());
  assertEquals(first.getId(),towMatchResults.get(1).getId());
}
