{
  Id appId=new SimpleId("application");
  ApplicationScope applicationScope=new ApplicationScopeImpl(appId);
  IndexScope indexScope=new IndexScopeImpl(appId,"fastcars");
  ApplicationEntityIndex entityIndex=eif.createApplicationEntityIndex(applicationScope);
  ei.initializeIndex();
  Map entityMap=new HashMap(){
{
      put("name","Ferrari 212 Inter");
      put("introduced",1952);
      put("topspeed",215);
    }
  }
;
  Entity entity=EntityIndexMapUtils.fromMap(entityMap);
  EntityUtils.setId(entity,new SimpleId("fastcar"));
  EntityUtils.setVersion(entity,UUIDGenerator.newTimeUUID());
  entity.setField(new UUIDField(IndexingUtils.ENTITYID_ID_FIELDNAME,UUID.randomUUID()));
  entityIndex.createBatch().index(indexScope,entity).execute().get();
  ei.refresh();
  CandidateResults candidateResults=entityIndex.search(indexScope,SearchTypes.fromTypes(entity.getId().getType()),Query.fromQL("name contains 'Ferrari*'"));
  assertEquals(1,candidateResults.size());
  EntityIndexBatch batch=entityIndex.createBatch();
  batch.deindex(indexScope,entity).execute().get();
  batch.execute().get();
  ei.refresh();
  candidateResults=entityIndex.search(indexScope,SearchTypes.fromTypes(entity.getId().getType()),Query.fromQL("name contains 'Ferrari*'"));
  assertEquals(0,candidateResults.size());
}
