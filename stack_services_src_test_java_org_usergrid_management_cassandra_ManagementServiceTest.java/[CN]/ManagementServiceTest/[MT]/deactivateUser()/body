{
  UUID uuid=UUIDUtils.newTimeUUID();
  Map<String,Object> properties=new LinkedHashMap<String,Object>();
  properties.put("username","test" + uuid);
  properties.put("email",String.format("test%s@anuff.com",uuid));
  EntityManager em=helper.getEntityManagerFactory().getEntityManager(applicationId);
  Entity entity=em.create("user",properties);
  assertNotNull(entity);
  User user=em.get(entity.getUuid(),User.class);
  assertFalse(user.activated());
  assertNull(user.getDeactivated());
  managementService.activateAppUser(applicationId,user.getUuid());
  user=em.get(entity.getUuid(),User.class);
  assertTrue(user.activated());
  assertNull(user.getDeactivated());
  long startTime=System.currentTimeMillis();
  managementService.deactivateUser(applicationId,user.getUuid());
  long endTime=System.currentTimeMillis();
  user=em.get(entity.getUuid(),User.class);
  assertFalse(user.activated());
  assertNotNull(user.getDeactivated());
  assertTrue(startTime <= user.getDeactivated() && user.getDeactivated() <= endTime);
}
