{
  final GraphFig graphFig=getFigMock();
  final NodeShardAllocation allocation=mock(NodeShardAllocation.class);
  final Id id=createId("test");
  final String edgeType="edge";
  final String otherIdType="type";
  UUID newTime=UUIDGenerator.newTimeUUID();
  final UUID min=new UUID(0,1);
  NodeShardCache cache=new NodeShardCacheImpl(allocation,graphFig);
  when(allocation.getShards(same(scope),same(id),same(Constants.MAX_UUID),any(Integer.class),same(edgeType),same(otherIdType))).thenReturn(Collections.singletonList(min).iterator());
  UUID slice=cache.getSlice(scope,id,newTime,edgeType,otherIdType);
  assertEquals(min,slice);
  verify(allocation).auditMaxShard(scope,id,edgeType,otherIdType);
}
