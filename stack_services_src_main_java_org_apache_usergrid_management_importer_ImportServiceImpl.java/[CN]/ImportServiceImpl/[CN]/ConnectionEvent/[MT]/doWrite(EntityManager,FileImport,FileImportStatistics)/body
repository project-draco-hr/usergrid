{
  try {
    if (entityRef.getType() == null) {
      entityRef=em.get(ownerEntityRef.getUuid());
    }
    logger.debug("Creating connection from {}:{} to {}:{}",new Object[]{ownerEntityRef.getType(),ownerEntityRef.getUuid(),entityRef.getType(),entityRef.getUuid()});
    em.createConnection(ownerEntityRef,connectionType,entityRef);
    stats.connectionWritten();
  }
 catch (  Exception e) {
    logger.error("Error writing connection",e);
    stats.connectionFailed(e.getMessage());
  }
}
