{
  Id appId=new SimpleId("AutoSpotterApp");
  Id orgId=new SimpleId("AutoWorldMagazine");
  CollectionScope scope=new CollectionScopeImpl(appId,orgId,"fastcars");
  EntityCollectionIndex entityIndex=collectionIndexFactory.createCollectionIndex(scope);
  EntityCollectionManager entityManager=collectionManagerFactory.createCollectionManager(scope);
  Map entityMap=new HashMap(){
{
      put("name","Ferrari 212 Inter");
      put("introduced",1952);
      put("topspeed",215);
    }
  }
;
  Entity entity=EntityBuilder.fromMap(scope.getName(),entityMap);
  EntityUtils.setId(entity,new SimpleId("fastcar"));
  entity=entityManager.write(entity).toBlockingObservable().last();
  entityIndex.index(entity);
  Results results=entityIndex.execute(Query.fromQL("name contains 'Ferrari*'"));
  assertEquals(1,results.getEntities().size());
  entityManager.delete(entity.getId());
  entityIndex.deindex(entity);
  results=entityIndex.execute(Query.fromQL("name contains 'Ferrari*'"));
  assertEquals(0,results.getEntities().size());
}
