{
  int count=0;
  EntityManager em=emf.getEntityManager(CpNamingUtils.MANAGEMENT_APPLICATION_ID);
  JsonGenerator usersFile=getJsonGenerator(createOutputFile(ADMIN_USERS_PREFIX,em.getApplication().getName()));
  usersFile.writeStartArray();
  JsonGenerator metadataFile=getJsonGenerator(createOutputFile(ADMIN_USER_METADATA_PREFIX,em.getApplication().getName()));
  metadataFile.writeStartObject();
  Query query=new Query();
  query.setLimit(MAX_ENTITY_FETCH);
  query.setResultsLevel(Results.Level.ALL_PROPERTIES);
  Results entities=em.searchCollection(em.getApplicationRef(),"users",query);
  while (entities.size() > 0) {
    for (    Entity entity : entities) {
      usersFile.writeObject(entity);
      echo(entity);
      saveEntityMetadata(metadataFile,em,null,entity);
      logger.debug("Exported user {}",entity.getProperty("email"));
      count++;
      if (count % 1000 == 0) {
        logger.info("Exported {} admin users",count);
      }
    }
    if (entities.getCursor() == null) {
      break;
    }
    query.setCursor(entities.getCursor());
    entities=em.searchCollection(em.getApplicationRef(),"users",query);
  }
  metadataFile.writeEndObject();
  metadataFile.close();
  usersFile.writeEndArray();
  usersFile.close();
  logger.info("Exported total of {} admin users",count);
}
