{
  final Id applicationId=new SimpleId("application");
  final String name="test";
  EntityCollection context=new EntityCollectionImpl(applicationId,name);
  final UUID entityId=UUIDGenerator.newTimeUUID();
  final UUID version=UUIDGenerator.newTimeUUID();
  final String type="test";
  final Id id=new SimpleId(entityId,type);
  Entity entity=new Entity(id);
  EntityUtils.setVersion(entity,version);
  BooleanField boolField=new BooleanField("boolean",false);
  DoubleField doubleField=new DoubleField("double",1d);
  IntegerField intField=new IntegerField("long",1);
  LongField longField=new LongField("int",1l);
  StringField stringField=new StringField("name","test");
  UUIDField uuidField=new UUIDField("uuid",UUIDGenerator.newTimeUUID());
  entity.setField(boolField);
  entity.setField(doubleField);
  entity.setField(intField);
  entity.setField(longField);
  entity.setField(stringField);
  entity.setField(uuidField);
  MvccEntity saved=new MvccEntityImpl(id,version,Optional.of(entity));
  serializationStrategy.write(context,saved).execute();
  MvccEntity returned=serializationStrategy.load(context,id,version);
  assertEquals("Mvcc entities are the same",saved,returned);
  assertEquals(id,entity.getId());
  Field<Boolean> boolFieldReturned=entity.getField(boolField.getName());
  assertSame(boolField,boolFieldReturned);
  Field<Double> doubleFieldReturned=entity.getField(doubleField.getName());
  assertSame(doubleField,doubleFieldReturned);
  Field<Integer> intFieldReturned=entity.getField(intField.getName());
  assertSame(intField,intFieldReturned);
  Field<Long> longFieldReturned=entity.getField(longField.getName());
  assertSame(longField,longFieldReturned);
  Field<String> stringFieldReturned=entity.getField(stringField.getName());
  assertSame(stringField,stringFieldReturned);
  Field<UUID> uuidFieldReturned=entity.getField(uuidField.getName());
  assertSame(uuidField,uuidFieldReturned);
  Set<Field> results=new HashSet<Field>();
  results.addAll(entity.getFields());
  assertTrue(results.contains(boolField));
  assertTrue(results.contains(doubleField));
  assertTrue(results.contains(intField));
  assertTrue(results.contains(longField));
  assertTrue(results.contains(stringField));
  assertTrue(results.contains(uuidField));
  assertEquals(6,results.size());
  assertEquals(id,entity.getId());
  assertEquals(version,entity.getVersion());
  serializationStrategy.delete(context,id,version).execute();
  returned=serializationStrategy.load(context,id,version);
  assertNull(returned);
}
