{
  final EntityManager em;
  try {
    em=getEmf().getEntityManager(app);
  }
 catch (  Throwable ex) {
    log.error("Error getting Entity Manager, aborting",ex);
    return;
  }
  UUID appId=app;
  Query query=Query.fromQL("review_score > 0");
  query.withLimit(maxEntities < 1000 ? maxEntities : 1000);
  Results results;
  try {
    results=em.searchCollection(em.getApplicationRef(),"reviews",query);
  }
 catch (  Exception ex) {
    log.error("Error on search, aborting",ex);
    return;
  }
  results.getEntities();
  int count=results.size();
  while (results.hasCursor() && count < maxEntities) {
    query.setCursor(results.getCursor());
    try {
      results=em.searchCollection(em.getApplicationRef(),"reviews",query);
    }
 catch (    Exception ex) {
      log.error("Error on search, aborting",ex);
      log(String.format("Read %d reviews in %s",count,appId));
      return;
    }
    results.getEntities();
    count+=results.size();
    log(String.format("Read %d reviews in %s",count,appId.toString()));
  }
}
