{
  manager.getOrgs().doOnNext(new Action1<Org>(){
    @Override public void call(    Org org){
      Set<Org> orgs=orgsByName.get(org.getName().toLowerCase());
      if (orgs == null) {
        orgs=new HashSet<Org>();
        orgsByName.put(org.getName().toLowerCase(),orgs);
      }
 else {
        duplicatesByName.put(org.getName().toLowerCase(),orgs);
      }
      orgs.add(org);
      orgsById.put(org.getId(),org);
      try {
        Set<OrgUser> orgUsers=manager.getOrgUsers(org);
        for (        OrgUser user : orgUsers) {
          Set<Org> usersOrgs=orgsByUser.get(user);
          if (usersOrgs == null) {
            usersOrgs=new HashSet<Org>();
            orgsByUser.put(user,usersOrgs);
          }
          usersOrgs.add(org);
        }
      }
 catch (      Exception e) {
        logger.error("Error getting users for org {}:{}",org.getName(),org.getId());
        logger.error("Stack trace is: ",e);
      }
    }
  }
).toBlocking().lastOrDefault(null);
  logger.info("DuplicateOrgRepair tool built org maps");
}
