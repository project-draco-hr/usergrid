{
  UUID uuid=UUIDUtils.newTimeUUID();
  long timestamp=getTimestampInMillis(uuid);
  if (type == null) {
    type=TOKEN_TYPE_ACCESS;
  }
  AccessTokenInfo tokenInfo=new AccessTokenInfo(uuid,type,timestamp,timestamp,principal,state);
  putAccessTokenInfo(tokenInfo);
  return getTokenForUUID(uuid);
}
