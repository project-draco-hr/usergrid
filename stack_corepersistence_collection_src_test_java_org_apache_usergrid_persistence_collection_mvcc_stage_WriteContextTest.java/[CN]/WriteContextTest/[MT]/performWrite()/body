{
  CollectionContext collectionContext=mock(CollectionContext.class);
  StagePipeline pipeline=mock(StagePipeline.class);
  WriteStage stage=mock(WriteStage.class);
  when(pipeline.first()).thenReturn(stage);
  WriteContext writeContext=new WriteContextImpl(pipeline,collectionContext);
  Object test=new Object();
  writeContext.performWrite(test);
  verify(pipeline).first();
  verify(stage).performStage(same(writeContext));
  assertSame(test,writeContext.getMessage(Object.class));
}
