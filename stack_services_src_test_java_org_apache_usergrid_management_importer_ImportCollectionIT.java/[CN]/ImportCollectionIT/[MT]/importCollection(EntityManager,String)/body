{
  logger.debug("\n\nImport into new app {}\n",em.getApplication().getName());
  ImportService importService=setup.getImportService();
  Import importEntity=importService.schedule(em.getApplication().getUuid(),new HashMap<String,Object>(){
{
      put("path",organization.getName() + em.getApplication().getName());
      put("organizationId",organization.getUuid());
      put("applicationId",em.getApplication().getUuid());
      put("collectionName",collectionName);
      put("properties",new HashMap<String,Object>(){
{
          put("storage_provider","s3");
          put("storage_info",new HashMap<String,Object>(){
{
              put("s3_access_id",System.getProperty(SDKGlobalConfiguration.ACCESS_KEY_ENV_VAR));
              put("s3_key",System.getProperty(SDKGlobalConfiguration.SECRET_KEY_ENV_VAR));
              put("bucket_location",bucketName);
            }
          }
);
        }
      }
);
    }
  }
);
  int maxRetries=120;
  int retries=0;
  while ((!importService.getState(importEntity.getUuid()).equals("FINISHED") || !importService.getState(importEntity.getUuid()).equals("FAILED")) && retries++ < maxRetries) {
    logger.debug("Waiting for import...");
    Thread.sleep(1000);
  }
  em.refreshIndex();
}
